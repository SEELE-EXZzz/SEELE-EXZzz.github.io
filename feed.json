{
    "version": "https://jsonfeed.org/version/1",
    "title": "个人博客",
    "subtitle": "",
    "icon": "https://seele-exzzz.github.io/assets/favicon.ico",
    "description": "",
    "home_page_url": "https://seele-exzzz.github.io",
    "items": [
        {
            "id": "https://seele-exzzz.github.io/2024/01/02/r%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/",
            "url": "https://seele-exzzz.github.io/2024/01/02/r%E8%AF%AD%E8%A8%80%E5%AD%A6%E4%B9%A0/",
            "title": "",
            "date_published": "2024-01-02T12:45:36.497Z",
            "content_html": "<h2 id=\"r语言学习\"><a class=\"markdownIt-Anchor\" href=\"#r语言学习\">#</a> r 语言学习</h2>\n<h3 id=\"一-包管理\"><a class=\"markdownIt-Anchor\" href=\"#一-包管理\">#</a> 一、包管理</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.包安装</span><br><span class=\"line\">//相当于nodejs的npm，用于下载第三方库。第一个参数为包名，第二个参数为安装源。</span><br><span class=\"line\">install.packages(&#x27;name&#x27;，repos=&quot;url&quot;)</span><br><span class=\"line\">install.loadedpackages() //可以查看和管理已经加载的包</span><br><span class=\"line\">2.包加载</span><br><span class=\"line\">library(packages) //包加载，引用包</span><br><span class=\"line\">packages::fun() //单独调用包中的某个函数。r语言貌似没有类和对象的概念</span><br><span class=\"line\">3.包卸载</span><br><span class=\"line\">remove.packages(&quot;name&quot;) //移除某个包</span><br><span class=\"line\">4.包更新</span><br><span class=\"line\">update.packages() //更新所有已安装的包</span><br></pre></td></tr></table></figure>\n<h3 id=\"二-数据类型\"><a class=\"markdownIt-Anchor\" href=\"#二-数据类型\">#</a> 二、数据类型</h3>\n<h4 id=\"1基本数据类型\"><a class=\"markdownIt-Anchor\" href=\"#1基本数据类型\">#</a> 1. 基本数据类型</h4>\n<ol>\n<li>数字型（numeric）：3，3.14</li>\n<li>字符串（character）: ‘a’,’abc’</li>\n<li>布尔类型（logical）：TRUE FALSE 简写：T F</li>\n<li>内置向量：pi letters（26 个字母小写） LETTERS（26 个字母大写）</li>\n</ol>\n<h4 id=\"2复杂数据类型\"><a class=\"markdownIt-Anchor\" href=\"#2复杂数据类型\">#</a> 2. 复杂数据类型</h4>\n<ol>\n<li>向量：有点类似于一维数组，用于储存多个数据。值可以是向量，如果是向量则会被展平。向量的值必须是同一种类型，如果类型不一致则会进行类型转化。</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.生成</span><br><span class=\"line\">a = 1:3 //生成1到3的数字</span><br><span class=\"line\">a = c(1,2,3) //c函数用来连接值</span><br><span class=\"line\">b = c(1;3,a,3,4) //值可以是向量，向量会被自动展平。</span><br><span class=\"line\">seq用于生成一段区间的数字向量。from为起始点，to为终点。by(可选参数)为步长，length.out生成的向量个数。生成的第一个数一定是from，但是最后一个数小于等于to。</span><br><span class=\"line\">c = seq(from,to,by,length.out)</span><br><span class=\"line\"></span><br><span class=\"line\">rep函数，生成重复的向量值，each是每个值重复次数，times为向量重复次数，向each后times。</span><br><span class=\"line\">d = rep(1:3,each=2,times=3)//结果为1 1 2 2 3 3 1 1 2 2 3 3 1 1 2 2 3 3。</span><br><span class=\"line\">2.命名以及获取长度</span><br><span class=\"line\">names(a) = name //给向量a命名</span><br><span class=\"line\">length(a) //获取向量a的长度</span><br><span class=\"line\">3.访问向量的值</span><br><span class=\"line\">a[index] //使用索引访问，注意这里的索引从1开始。</span><br><span class=\"line\">a[-index] //加个负号指不包括某个索引而不是从右往左数。</span><br><span class=\"line\">a[c(1:3)] //可以使用向量实现访问向量多个值</span><br><span class=\"line\">a[name] //如果给向量命名可以使用名字访问向量的值，如果要访问多个值可以用c函数连接多个名字。</span><br><span class=\"line\">a[a%%2==1] //可以使用表达式访问。</span><br></pre></td></tr></table></figure>\n<ol start=\"2\">\n<li>矩阵：有点类型于二维数组，可以储存多个向量。</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.生成</span><br><span class=\"line\">dimnames使用列表为矩阵命名,如list(c(&#x27;a&#x27;,&#x27;b&#x27;),c(&#x27;c&#x27;,&#x27;d&#x27;)),byrow默认是false，如果是false就意味着矩阵是按列构建的。nrow为行数，ncol为列数，nrow和ncol写一个即可，data为向量。</span><br><span class=\"line\">a = matrix(data,nrow,ncol,byrow=false,dimnames) </span><br><span class=\"line\"></span><br><span class=\"line\">a = cbind(b,c,d) //将向量按列构建</span><br><span class=\"line\">a = rbind(b,c,d) //将向量按行构建</span><br><span class=\"line\">a = diag(data) //生成对角线矩阵，斜对角线为data值</span><br><span class=\"line\">2.获取维度</span><br><span class=\"line\">nrow(a) //获取矩阵行数</span><br><span class=\"line\">ncol(a) //获取矩阵列数</span><br><span class=\"line\">dim(a) // 获取行列数</span><br><span class=\"line\">3.访问矩阵的值</span><br><span class=\"line\">a[row,col] //访问row行col列的值</span><br><span class=\"line\">a[row,] //访问row行的值</span><br><span class=\"line\">a[,col] //访问col列的值</span><br><span class=\"line\">a[-row,-col] //负号代表不访问某行或者某列</span><br><span class=\"line\">a[name,name] //如果给矩阵命名了可以使用名字访问。</span><br><span class=\"line\">a[1:2,c(1:3)] //可以使用向量访问。</span><br><span class=\"line\"></span><br><span class=\"line\">as.vector(a) //可以将矩阵按列转化为向量</span><br></pre></td></tr></table></figure>\n<ol start=\"3\">\n<li>列表：有点类似于对象，以键值对储存数据，数据的类型可以不一致。</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.生成</span><br><span class=\"line\">a = list(a=&quot;1&quot;,b=1:3,c=c(1,2)) //可以储存不同的数据，数据储存以键值对的方式储存。</span><br><span class=\"line\">2.获取长度</span><br><span class=\"line\">length(a)</span><br><span class=\"line\">3.获取键</span><br><span class=\"line\">names(a)</span><br><span class=\"line\">4.获取值</span><br><span class=\"line\">a$a //与其他语言的对象不同的是，这里列表使用$访问属性</span><br><span class=\"line\">a[[&#x27;a&#x27;]] //可以使用[[]]访问值,键要写成字符串的形式。</span><br><span class=\"line\">a[&#x27;a&#x27;] //如果是[]，则返回键与值。</span><br><span class=\"line\">a[[&#x27;index&#x27;]] //可以使用下标访问列表的值。</span><br><span class=\"line\"></span><br><span class=\"line\">a$b = 1:3 //新增一个键值对</span><br></pre></td></tr></table></figure>\n<ol start=\"4\">\n<li>数据框：类似于二维列表或者说是可以储存不同类型值的矩阵，同样以键值对储存数据，数据的类型也可以不一样。</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.生成</span><br><span class=\"line\">a = data.frame(</span><br><span class=\"line\">\ta = 1:3</span><br><span class=\"line\">\tb = c(2,3,4)</span><br><span class=\"line\">) //与列表相同同样以键值对按列储存数据，每一个值的长度需相同但类型可以不一样。</span><br><span class=\"line\">以下操作与矩阵或者列表一致</span><br><span class=\"line\">2.获取维度</span><br><span class=\"line\">dim(a)</span><br><span class=\"line\">ncol(a)</span><br><span class=\"line\">nrow(a)</span><br><span class=\"line\">3.获取键</span><br><span class=\"line\">dimnames(a)</span><br><span class=\"line\">names(a)</span><br><span class=\"line\">colnames(a) //列名为键</span><br><span class=\"line\">rownames(a)</span><br><span class=\"line\">4.获取值</span><br><span class=\"line\">a[row,col] //访问row行col列的值</span><br><span class=\"line\">a[row,] //访问row行的值</span><br><span class=\"line\">a[,col] //访问col列的值</span><br><span class=\"line\">a[-row,-col] //负号代表不访问某行或者某列</span><br><span class=\"line\">a[name,name] //通过键访问。</span><br><span class=\"line\">a[1:2,c(1:3)] //可以使用向量访问。</span><br><span class=\"line\">a[[index]] //用下标访问某一列</span><br><span class=\"line\">a[[&#x27;key&#x27;]] //用键访问某一列</span><br><span class=\"line\">a$key //用键访问某一列</span><br><span class=\"line\"></span><br><span class=\"line\">head(a,n) //获取前n行的数据</span><br><span class=\"line\">tail(a,n) //获取最后n行的数据</span><br><span class=\"line\"></span><br><span class=\"line\">a$b = 1:3 //新增一列</span><br></pre></td></tr></table></figure>\n<h4 id=\"3数据类型转化\"><a class=\"markdownIt-Anchor\" href=\"#3数据类型转化\">#</a> 3. 数据类型转化</h4>\n<p>type 取值范围：</p>\n<ol>\n<li>类型判断：is（a,type）返回结果为布尔值。</li>\n<li>类型转化：as.type () 转化的过程中，如果失败就会返回 NA，数字转化为字符串时，有可能会丢失部分小数四舍五入。我猜是用双精度浮点数储存小数然后再转化为字符串，因为双精度所存储的数据大小有限，导致部分小数无法储存。除了零以外的数字转化为布尔值的时候都是 T.T 转为数字类型为 1，F 转为数字类型为 0</li>\n</ol>\n<h3 id=\"三-运算相关函数\"><a class=\"markdownIt-Anchor\" href=\"#三-运算相关函数\">#</a> 三、运算相关函数</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">c(1:3)+c(2:4) //不只是数字之间，向量之间也可以直接运算，如果长度不一致会循环运算</span><br><span class=\"line\">c(1:3)/c(1:5) //1.00 1.00 1.00 0.25 0.40</span><br><span class=\"line\">a^b //指数运算为a的b次方</span><br><span class=\"line\">%% //取余</span><br><span class=\"line\">%/% //除法取整</span><br><span class=\"line\">%in% //判断某个元素是否在向量中</span><br><span class=\"line\">exp(a) //底数为e的指数，为e的a次方</span><br><span class=\"line\">log(25,base=a) //base为底</span><br><span class=\"line\">sqrt(x) //开平方</span><br><span class=\"line\">abs(x) //绝对值</span><br><span class=\"line\">sign(x) //判断x是正还是负，如果是正返回1，如果是负返回-1，值为零返回零</span><br><span class=\"line\">round(a,num) //保留num位小数</span><br><span class=\"line\">signif(a,num) //保留num位有效数字</span><br><span class=\"line\">ceiling(x) //向上取整</span><br><span class=\"line\">floor(x) //向下取整</span><br><span class=\"line\"></span><br><span class=\"line\">max(a) //获取最大值，a可以是向量，矩阵，列表，数据框。如果是列表或者数据框，则会获取每一列的最大值。</span><br><span class=\"line\">cummax(a) //返回1到当前下标中最大值</span><br><span class=\"line\">min和cummin的用法与上面一致</span><br><span class=\"line\">sum(a) //求和，返回一个值</span><br><span class=\"line\">cumsum //累计求和，返回一个向量记录返回1到当前下标中的求和</span><br><span class=\"line\">prod和cumprod求乘积与上面一致</span><br><span class=\"line\"></span><br><span class=\"line\">mean(a) //均值</span><br><span class=\"line\">median(a) //中位数</span><br><span class=\"line\">sd(a) //标准差</span><br><span class=\"line\">var(a) //方差</span><br><span class=\"line\"></span><br><span class=\"line\">rev(a) //向量反转，类似于reverse方法</span><br><span class=\"line\">排序方法，decreasing默认是false，升序排列。index.return=true,返回元素原先在a中索引。partial=n只对前n个元素做排序。</span><br><span class=\"line\">sort(a，decreasing,index.return,partial=n)</span><br><span class=\"line\"></span><br><span class=\"line\">table() //向量元素频数统计</span><br><span class=\"line\">unique() //去重</span><br><span class=\"line\"></span><br><span class=\"line\">which() //返回向量中符合条件的下标，类似于filter，不过这个是返回下标而不是值</span><br><span class=\"line\">which.max() //如果有多个只返回下标最先出现的一个</span><br><span class=\"line\">which.min() //如果有多个只返回下标最先出现的一个</span><br><span class=\"line\"></span><br><span class=\"line\">intersect() //取交集</span><br><span class=\"line\">setdiff() //取差集，即第一个参数有，但第二个参数没有的值</span><br><span class=\"line\">union() //取并集</span><br><span class=\"line\"></span><br><span class=\"line\">矩阵或者数据框的合并</span><br><span class=\"line\">rbind() //按行合并，要求列长度相等。</span><br><span class=\"line\">cbind() //按列合并，要求行相等。</span><br><span class=\"line\"></span><br><span class=\"line\">a%*%b //矩阵a和矩阵b乘法运算</span><br><span class=\"line\">solve(a,b) //ax=b,第二个参数没写默认为E，求x</span><br><span class=\"line\"></span><br><span class=\"line\">连接函数，collapse和sep为可选参数用于指定以什么符号连接，如果没有的话使用空格连接。使用collapse会返回字符串，sep则会返回向量</span><br><span class=\"line\">paste(a,b,collapse,sep) </span><br><span class=\"line\"></span><br><span class=\"line\">与分布相关的函数</span><br><span class=\"line\">runif(n,min,max) //在[min,max]中生成n个服从均匀分布的样本</span><br><span class=\"line\">rnorm(n,mean,sd) //生成n个服从均值为mean，标准差没sd的正态分布样本</span><br><span class=\"line\">rbinom(n,size,prob) //生成n个做了size次，成功概率为prob的二项分布样本</span><br><span class=\"line\">rpois(n,lambda) //生成n个具有均值为lambda的泊松分布样本</span><br><span class=\"line\">rgeom(n,prob) //生成n个成功概率为prob的几何分布样本</span><br><span class=\"line\">rnbinom(n,size,prob) //生成n个实验次数为size，成功概率为prob的负二项分布样本</span><br><span class=\"line\">rexp(n,rate) //生成n个参数为rate的指数分布函数</span><br></pre></td></tr></table></figure>\n<h3 id=\"四-数据的处理\"><a class=\"markdownIt-Anchor\" href=\"#四-数据的处理\">#</a> 四、数据的处理</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">data = read.csv(url) //读取csv文件的数据</span><br><span class=\"line\">write.csv(data,url) //将数据写入csv文件。</span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "https://seele-exzzz.github.io/2023/11/27/Video-Audio/%E7%AB%AF%E5%AF%B9%E7%AB%AF%E8%BF%9E%E6%8E%A5%E5%88%9D%E4%BD%93%E9%AA%8C/",
            "url": "https://seele-exzzz.github.io/2023/11/27/Video-Audio/%E7%AB%AF%E5%AF%B9%E7%AB%AF%E8%BF%9E%E6%8E%A5%E5%88%9D%E4%BD%93%E9%AA%8C/",
            "title": "端对端连接初体验",
            "date_published": "2023-11-27T02:48:55.097Z",
            "content_html": "<h3 id=\"端对端连接初体验\"><a class=\"markdownIt-Anchor\" href=\"#端对端连接初体验\">#</a> 端对端连接初体验</h3>\n<h4 id=\"一-nat-stun-turn\"><a class=\"markdownIt-Anchor\" href=\"#一-nat-stun-turn\">#</a> 一、NAT STUN TURN</h4>\n<ol>\n<li>NAT</li>\n</ol>\n<p>NAT 全称 Network Addresss Translation 即网络地址转换。出现的目的是为了解决 ipv4 不够用的情况同时还能保证内网安全，缺点在于 nat 会降低网速，nat 层数越多网速越慢，同时 nat 如果两边都是对称型或者一边是对称型另一边是端口限制性，就无法进行 p2p 连接了。由于 ipv4 数量不够，不足以让每台设备都拥有一个 ipv4，同时 ipv6 还未普及。所以需要 nat 将内网 ip 转化为公网 ip 中的某个端口。一般一个路由器有一个公网 ip，同时路由器会给连接上路由器的设备一个内网 ip。其中内网 ip 有三类：A 类：10.0.0.0–10.255.255.255，B 类：172.16.0.0–172.31.255.255，c 类：192.168.0.0–192.168.255.255。路由器内的设备在访问外网时，内网 ip 地址经过路由器会映射为路由器外网 ip 地址中的某个端口号，发给某个网站的服务器，此时服务器收到的 ip 地址是路由器的 ip 地址的某个端口而不是内网 ip 地址。路由器收到网站返回的响应，会根据映射表发给相应的内网 ip 的设备。</p>\n<p>NAT 有两大类型一个是锥型，另一个是对称型。当路由器内的设备访问某个网站时，路由器会生成一个外网 ip 地址，如果此时在访问另一个网站，路由器生成的外网 ip 地址也是同一个，这就是锥型，如果不同则是对称型。换句话说如果设备在访问不同的网站时，经由 NAT 生成的 ip 地址如果是同一个就是锥型，不同则是对称型。</p>\n<p>锥型还分为三种，分别是完全锥型，地址受限锥型，端口受限锥型。如果能通过 NAT 生成的 ip 地址，向该地址发生消息，内网的设备能够直接接收到该消息则是完全锥型，如果要求该内网设备发消息给某个服务器，这个服务器才能通过 NAT 生成的 ip 地址发给该内网设备则是地址受限锥型。如果要求该内网设备发消息给某个服务器，且消息必须由该服务器上收到消息的端口号发送，通过 NAT 生成的 ip 地址发送消息给内网设备则是端口受限锥型。简单的讲如果任何设备都可以通过由 NAT 映射的 ip 地址访问内网设备则是完全锥型，如果需要该内网设备访问过的设备，才能访问内网设备则是地址受限锥型。如果不仅要该内网设备访问过的设备，发送消息时还必须通过接收消息的端口号发送消息，才能访问内网设备则是端口受限锥型。</p>\n<p>从宽松程度来看，完全锥型 &lt; 地址受限锥型 &lt; 端口受限锥型 &lt; 对称型 完全锥型最宽松，对称型最严格。</p>\n<p>从安全角度来看，完全锥型 &lt; 地址受限锥型 &lt; 端口受限锥型 &lt; 对称型。完全锥型最不安全，对称型最安全。</p>\n<ol start=\"2\">\n<li>STUN</li>\n</ol>\n<p>STUN 全称 Simple Traversal of UDP Through NATs，即简单的用 udp 实现 NAT 穿越。如果两个设备拥有公网 ip，那么这两个设备就能互相访问对方也就很轻易的完成 p2p 连接。但现实是，由于 ipv4 紧缺导致设备一般没有公网 ip，用的是由 NAT 分配的内网 ip，而内网 ip 则不能直接访问。这个时候就需要用到 STUN 进行 NAT 穿越，获取设备内网 ip 经由路由器映射下的公网 ip 地址，然后交换双方的公网 ip 地址以实现 p2p 连接。当然并不是所有设备都能 p2p 连接的，如果双方的 NAT 是对称型的或者有一方是对称型另一方是端口受限锥型则无法进行 p2p 连接，这时候就需要使用 TURN</p>\n<p>使用 STUN 时，需要在双方设置 STUN 客户端，以及一个双方能访问到的 STUN 服务器 (一般部署到公网上)  。STUN 客户端和 STUN 服务器需要进行至多三次测试，用于判断双方的 NAT 类型，是否能用 UDP 传输以及双方在 NAT 映射下的公网 ip 地址以及端口号。测试如下，图片来自 wiki。</p>\n<p><img data-src=\"https://upload.wikimedia.org/wikipedia/commons/thumb/3/35/STUN_Algorithm3_zh_Hans.svg/1280px-STUN_Algorithm3_zh_Hans.svg.png\" alt=\"undefined\"></p>\n<ol start=\"3\">\n<li>TURN</li>\n</ol>\n<p>TURN 全称 Traversal Using Relays around NAT，即使用中继实现 NAT 穿越。当通信双方的 NAT 是对称型的或者有一方是对称型另一方是端口受限锥型则无法进行 p2p 连接。这时候就需要使用 TURN 服务器，获取通信双方的音视频相关的数据，再交换。使用 TURN 作中继相比 p2p 连接，延迟要高且耗费流量，如果 TURN 服务器的带宽不够还会降低双方的通信质量，这是无法进行 p2p 连接的无奈之举。</p>\n<p>相关资料：</p>\n<p><a href=\"[详解P2P技术中的NAT穿透原理(转载) - 简书 (jianshu.com)](https://www.jianshu.com/p/f71707892eb2)\">详解 P2P 技术中的 NAT 穿透原理 (转载)</a></p>\n<p><a href=\"[P2P技术详解(二)：P2P中的NAT穿越(打洞)方案详解 - 简书 (jianshu.com)](https://www.jianshu.com/p/9bfbcbee0abb)\">P2P 技术详解 (二)：P2P 中的 NAT 穿越 (打洞) 方案详解</a></p>\n<p><a href=\"[P2P技术详解(三)：P2P技术之STUN、TURN、ICE详解(转载) - 简书 (jianshu.com)](https://www.jianshu.com/p/258e7d8be2ba)\">P2P 技术详解 (三)：P2P 技术之 STUN、TURN、ICE 详解 (转载)</a></p>\n<p><a href=\"[STUN - 维基百科，自由的百科全书 (wikipedia.org)](https://zh.wikipedia.org/wiki/STUN)\">STUN Wiki</a></p>\n<h4 id=\"二-candidate-ice-sdp\"><a class=\"markdownIt-Anchor\" href=\"#二-candidate-ice-sdp\">#</a> 二、Candidate ICE SDP</h4>\n<ol>\n<li>\n<p>candidate 意为候选者，有三种类型分别为 host，srflx，relay。优先度由高到低。</p>\n<p>host：如果通信双方处于一个局域网下或者说连接同一个 wife。就可以使用这个类型，优势度最高。具体收集的是，ip 地址和端口。</p>\n<p>srflx：如果通信双方不在同一个局域网但可以进行 p2p 连接，则可以走这个类型。优先度仅此于 host</p>\n<p>relay：如果双方无法进行 p2p 连接即双方可能是对称型或者一方对称另一方端口限制型的话，则选择这个类型。优先度最低，只有上面两种不行无法进行 p2p 连接才会选择。relay 和 srflx 收集的是经过 NAT 映射后的 ip 地址和端口。</p>\n</li>\n<li>\n<p>ice：全称 Interactive Connectivity Establishment（交互式连通建立方式）。ice 收集所有通信方式并找到一个最佳的通信方式。比如通过 STUN 找到 srflx 类型的 candidate，通过 TURN 找到 relay 类型的 candidate。优先使用 host，如果不通则尝试 srflx，如果还不通最后使用 relay。</p>\n</li>\n<li>\n<p>SDP：全称 Session Description Protocol（会话描述协议）。通信双方的设备支持的视频和音频的编解码很大概率是不同，所以需要了解通信双方所支持的音视频编解码，然后从中选择一个双方都有且最好的音视频编解码。sdp 记录了某一方支持的音视频编解码。</p>\n</li>\n</ol>\n<h4 id=\"三-rtcpeerconnection\"><a class=\"markdownIt-Anchor\" href=\"#三-rtcpeerconnection\">#</a> 三、RTCPeerConnection</h4>\n<p>RTCPeerConnection 是一个构造函数，用于创建 offer 和 answer，设置本地的 sdp 信息以及远端的 sdp 信息。在媒体协商前需将媒体流使用 addstream 或者 addtrack 设置到 RTCPeerConnection 的实例对象中。在设置完媒体流后需要进行媒体协商，发起方需要创建 offer，将 offer 设置为本地的 sdp 信息同时发送给信令服务器。接收方收到信令服务器发送的 offer，将 offer 设置为本地描述，然后创建 answer，将 answer 设置为本地描述同时发送 answer 到信令服务器。接收方收到信令服务器的 answer 将设置远端描述。至此媒体协商完成，在 webrtc 底层会收集 candidate，此时还需要交换双方的 candidate，当交换完成就会使用 ice 找到合适的连接方式。这时候通信双方建立了一条链路。音视频数据可以通过这个链路传输了。当收到远端传来的数据还需要在本地展示出来。需注意的是，需要给 RTCPeerConnection 设置媒体流，在设置本地描述后就会触发 onicecandidate，如果在设置本地描述前没有设置媒体流的话是不会触发 oniecandidate 的。另外接收方将发送方发送的 offer 设置为远端描述后才能创建 answer。整个流程如下。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let local = document.querySelector(&#x27;#local&#x27;) </span><br><span class=\"line\">let remote = document.querySelector(&#x27;#remote&#x27;)</span><br><span class=\"line\">let stream </span><br><span class=\"line\">//连接信令服务器</span><br><span class=\"line\">const socket = io(&#x27;http://localhost:3000&#x27;)</span><br><span class=\"line\">socket.on(&#x27;connect&#x27;,()=&gt;&#123;console.log(&#x27;连接成功&#x27;)&#125;)</span><br><span class=\"line\">async function getvideo (pc)&#123;</span><br><span class=\"line\">    stream = await navigator.mediaDevices.getUserMedia(&#123;video:true,audio:false&#125;)</span><br><span class=\"line\">    getOffer()</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">getvideo()</span><br><span class=\"line\">//pc1为发送方</span><br><span class=\"line\">let pc1 = new RTCPeerConnection()</span><br><span class=\"line\">async function getOffer()&#123;</span><br><span class=\"line\">    await pc1.addStream(stream) //先设置媒体流然后再创建offer将offer设置到本地描述这时候就会触发onicecandidate。</span><br><span class=\"line\">    let offer = await pc1.createOffer() //获取发送方的offer</span><br><span class=\"line\">    await pc1.setLocalDescription(offer) //将发送方的offer设置到本地描述</span><br><span class=\"line\">    socket.emit(&#x27;sendOffer&#x27;,offer) //将offer传输到信令服务器</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">socket.on(&#x27;getAnswer&#x27;,async(answer)=&gt;&#123;</span><br><span class=\"line\">    await pc1.setRemoteDescription(answer) //将接收方的answer设置到远端描述。      </span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">pc1.onicecandidate=(e)=&gt;&#123;</span><br><span class=\"line\">    if(e.candidate)&#123;</span><br><span class=\"line\">        socket.emit(&#x27;candidate&#x27;,e.candidate,&#x27;pc1&#x27;) //当发送方将offer设置到本地描述就会不断触发这个事件，此时的e.candidate有可能是null所以需加一层判断</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">pc1.ontrack=(e)=&gt;&#123;</span><br><span class=\"line\">    local.srcObject = e.streams[0]</span><br><span class=\"line\">    local.play()</span><br><span class=\"line\">&#125; //当远程描述设置完成就会触发ontrack</span><br><span class=\"line\"></span><br><span class=\"line\">socket.on(&#x27;sendCandidate&#x27;,async(candidate,type)=&gt;&#123;</span><br><span class=\"line\">    if(type===&#x27;pc1&#x27;)&#123;</span><br><span class=\"line\">        await pc2.addIceCandidate(candidate) //接收方用addicecandidate接收发送方的candidate</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        await pc1.addIceCandidate(candidate) //发送方用addicecandidate接收接收方的candidate</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">//pc2为接收方</span><br><span class=\"line\">let pc2 = new RTCPeerConnection()</span><br><span class=\"line\">socket.on(&#x27;getOffer&#x27;,async(offer)=&gt;&#123;</span><br><span class=\"line\">    await pc2.addStream(stream) //先设置媒体流，然后将发送方的offer设置到远端描述，这时候才能创建answer，再将创建的answer设置到本地描述。这时候就会触发onicecandidate。</span><br><span class=\"line\">    await pc2.setRemoteDescription(offer) //将发送方的offer设置到远端描述</span><br><span class=\"line\">    let answer = await pc2.createAnswer() //获取接收方的answer</span><br><span class=\"line\">    await pc2.setLocalDescription(answer) //将接收方的answer设置到本地描述</span><br><span class=\"line\">    socket.emit(&#x27;sendAnswer&#x27;,answer) //将answer传输到信令服务器    </span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">pc2.onicecandidate=(e)=&gt;&#123;</span><br><span class=\"line\">    if(e.candidate)&#123;</span><br><span class=\"line\">    \t//当接受方将answer设置到本地描述就会不断触发这个事件，因为e.candidate有可能是null所以这里加个判断</span><br><span class=\"line\">        socket.emit(&#x27;candidate&#x27;,e.candidate,&#x27;pc2&#x27;) </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">pc2.ontrack=(e)=&gt;&#123;</span><br><span class=\"line\">    remote.srcObject = e.streams[0]</span><br><span class=\"line\">    remote.play()</span><br><span class=\"line\">&#125; //当远程描述设置完成就会触发ontrack</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">//信令服务器</span><br><span class=\"line\">const express = require(&quot;express&quot;);</span><br><span class=\"line\">const &#123; createServer &#125; = require(&quot;http&quot;);</span><br><span class=\"line\">const &#123; Server &#125; = require(&quot;socket.io&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">const app = express();</span><br><span class=\"line\">const httpServer = createServer(app);</span><br><span class=\"line\">const io = new Server(httpServer,&#123;</span><br><span class=\"line\">\tcors : &#x27;127.0.0.1:5500&#x27; //允许请求的地址 </span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">io.on(&quot;connection&quot;, (socket) =&gt; &#123;</span><br><span class=\"line\">\tsocket.on(&#x27;sendOffer&#x27;,(offer)=&gt;&#123;</span><br><span class=\"line\">\t\tsocket.emit(&#x27;getOffer&#x27;,offer)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tsocket.on(&#x27;sendAnswer&#x27;,(answer)=&gt;&#123;</span><br><span class=\"line\">\t\tsocket.emit(&#x27;getAnswer&#x27;,answer)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">  \tsocket.on(&#x27;candidate&#x27;,(candidate)=&gt;&#123;</span><br><span class=\"line\">\t\tsocket.emit(&#x27;sendCandidate&#x27;,candidate)</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">httpServer.listen(3000);</span><br></pre></td></tr></table></figure>\n<p>相关资料：</p>\n<p><a href=\"[WebRTC这么火🔥，前端靓仔，请收下这篇入门教程 - 掘金 (juejin.cn)](https://juejin.cn/post/7266417942182608955)\">WebRTC 这么火🔥，前端靓仔，请收下这篇入门教程</a></p>\n<h4 id=\"四-rtcdatachannel\"><a class=\"markdownIt-Anchor\" href=\"#四-rtcdatachannel\">#</a> 四、RTCDataChannel</h4>\n<p>可以使用 RTCDataChannel 可以传输文本，文件以及图片。RTCDataChannel 是由 RTCPeerConnection 实例对象的 createDataChannel () 创建的。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let channel = pc1.createDataChannel(&#x27;chat&#x27;) //使用createDataChannel创建通道，第一个参数是通道的名字</span><br><span class=\"line\">let channel1 = pc1.createDataChannel(&#x27;123&#x27;)</span><br><span class=\"line\">channel.onopen=(e)=&gt;&#123; //通道建立后触发这个onopen事件</span><br><span class=\"line\">    channel.send(&#x27;hello,world&#x27;) //可以使用send方法发送消息</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">channel.onmessage=(e)=&gt;&#123;</span><br><span class=\"line\">    console.log(e.data,&#x27;pc1&#x27;) //接收消息</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">//每当建立一个通道就会触发ondatachannel</span><br><span class=\"line\">pc2.ondatachannel=(e)=&gt;&#123; </span><br><span class=\"line\">    let channel = e.channel</span><br><span class=\"line\">    channel.onopen=(e)=&gt;&#123;</span><br><span class=\"line\">\t\tchannel.send(&#x27;你好世界&#x27;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    channel.onmessage=(e)=&gt;&#123;</span><br><span class=\"line\">        console.log(e.data,&#x27;pc2&#x27;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "音视频开发",
                "webrtc"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/11/22/Video-Audio/%E5%B9%BB%E5%BD%B1%E5%9D%A6%E5%85%8B%E5%88%B6%E5%A4%87/",
            "url": "https://seele-exzzz.github.io/2023/11/22/Video-Audio/%E5%B9%BB%E5%BD%B1%E5%9D%A6%E5%85%8B%E5%88%B6%E5%A4%87/",
            "title": "幻影坦克制备",
            "date_published": "2023-11-22T11:06:34.980Z",
            "content_html": "<h3 id=\"幻影坦克\"><a class=\"markdownIt-Anchor\" href=\"#幻影坦克\">#</a> 幻影坦克</h3>\n<h4 id=\"1介绍\"><a class=\"markdownIt-Anchor\" href=\"#1介绍\">#</a> 1. 介绍</h4>\n<p>​\t有些图片在 qq 或者贴吧等平台上，正常情况是一张图片，但是打开放大变成了另一种图片，因为其表现形式像红色警戒的幻影坦克，因此将这类图片称作幻影坦克。其实这类图片是 png 图片，众所周知 png 图片有透明度，正是因为这个特性就可以让图片在不同背景下显示出不同图片成为可能。接下来介绍如何制作这类图片。</p>\n<h4 id=\"2图像混合\"><a class=\"markdownIt-Anchor\" href=\"#2图像混合\">#</a> 2. 图像混合</h4>\n<p>​\t在调用 canvas 的 context 的 getImageData 方法后，会返回一个对象，其中 data 属性包含这个图片的像素颜色信息。每个像素有四个数据分别是 rgba，其中第四个数据是不透明度。这四个数据的取值范围均为 0-255。a 的数值越大越不透明，255 为完全不透明，0 为完全透明。那如果取值在这个中间图片会是什么样子的呢。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>r</mi><mrow><mi>m</mi><mi>i</mi><mi>x</mi></mrow></msub><mo>=</mo><msub><mi>r</mi><mn>1</mn></msub><mo>∗</mo><mi>α</mi><mo>+</mo><msub><mi>r</mi><mn>2</mn></msub><mo>∗</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">r_{mix} = r_1*α+ r_2*(1-α)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">mi</span><span class=\"mord mathnormal mtight\">x</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6153em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6153em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>g</mi><mrow><mi>m</mi><mi>i</mi><mi>x</mi></mrow></msub><mo>=</mo><msub><mi>g</mi><mn>1</mn></msub><mo>∗</mo><mi>α</mi><mo>+</mo><msub><mi>g</mi><mn>2</mn></msub><mo>∗</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">g_{mix} = g_1*α+ g_2*(1-α)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">mi</span><span class=\"mord mathnormal mtight\">x</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6597em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6597em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>b</mi><mrow><mi>m</mi><mi>i</mi><mi>x</mi></mrow></msub><mo>=</mo><msub><mi>b</mi><mn>1</mn></msub><mo>∗</mo><mi>α</mi><mo>+</mo><msub><mi>b</mi><mn>2</mn></msub><mo>∗</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">b_{mix} = b_1*α+ b_2*(1-α)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3117em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">mi</span><span class=\"mord mathnormal mtight\">x</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">1</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3011em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">2</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p>​\t其中 mix 下标图像混合后的色值，1 下标为上面的图片色值，2 下标为下面的图片或者说背景色值。</p>\n<p>​\t可以做个实验，左边是色值改为混合后的色值，其中背景是白色，右边是改变不透明度，其背景是白色，每隔 100ms 改变一次，最后的效果一致。</p>\n<p><img data-src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8a1493933bb8447cbae82b0fb39b2696~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=834&amp;h=606&amp;s=756632&amp;e=gif&amp;f=50&amp;b=f6f1ea\" alt=\"4d66a07e-3f0c-4a8d-b6c1-d6e6250a0a26.gif\"></p>\n<p>有了上面的公式一切都好办了。根据这个公式，我们可以得出一张 png 图片在不同的背景下的色值。如果把在白色背景下呈现的图片叫做表图，在黑色背景下呈现的图片叫做里图。在知道了表图以及里图的色值，就可以根据这个公式计算出这张 png 图片的色值以及透明度。这样就可以让这张图片在黑白不同的背景下呈现出不同的图片。</p>\n<h4 id=\"3-从隐藏一个阿卡林开始\"><a class=\"markdownIt-Anchor\" href=\"#3-从隐藏一个阿卡林开始\">#</a> 3. 从隐藏一个阿卡林开始</h4>\n<p>如果我想让表图是白色的图片，让里图是阿卡林的话，代入公式可得，下标为表代表表图的色值，下标为里代表里图的色值。白色的 rgb 为 255，黑色的 rgb 为 0。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>r</mi><mtext>表</mtext></msub><mo>=</mo><mi>r</mi><mo>∗</mo><mi>α</mi><mo>+</mo><mn>255</mn><mo>∗</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">r_表 = r*α+ 255*(1-α)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">表</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4653em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">255</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>g</mi><mtext>表</mtext></msub><mo>=</mo><mi>g</mi><mo>∗</mo><mi>α</mi><mo>+</mo><mn>255</mn><mo>∗</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">g_表 = g*α+ 255*(1-α)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">表</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6597em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">255</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>b</mi><mtext>表</mtext></msub><mo>=</mo><mi>b</mi><mo>∗</mo><mi>α</mi><mo>+</mo><mn>255</mn><mo>∗</mo><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">b_{表} = b*α+ 255*(1-α)\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord cjk_fallback mtight\">表</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">255</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mclose\">)</span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>r</mi><mtext>里</mtext></msub><mo>=</mo><mi>r</mi><mo>∗</mo><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">r_里 = r*α\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.5806em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">里</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4653em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>g</mi><mtext>里</mtext></msub><mo>=</mo><mi>g</mi><mo>∗</mo><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">g_里 = g*α\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.625em;vertical-align:-0.1944em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">里</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6597em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>b</mi><mtext>里</mtext></msub><mo>=</mo><mi>b</mi><mo>∗</mo><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">b_{里} = b*α\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8444em;vertical-align:-0.15em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord cjk_fallback mtight\">里</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>α</mi><mo>=</mo><mo stretchy=\"false\">(</mo><msub><mi>r</mi><mtext>里</mtext></msub><mo>−</mo><msub><mi>r</mi><mtext>表</mtext></msub><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><mn>255</mn><mo>+</mo><mn>1</mn><mo>=</mo><mo stretchy=\"false\">(</mo><msub><mi>g</mi><mtext>里</mtext></msub><mo>−</mo><msub><mi>g</mi><mtext>表</mtext></msub><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><mn>255</mn><mo>+</mo><mn>1</mn><mo>=</mo><mo stretchy=\"false\">(</mo><msub><mi>b</mi><mtext>里</mtext></msub><mo>−</mo><msub><mi>b</mi><mtext>表</mtext></msub><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><mn>255</mn><mo>+</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">α = (r_里-r_表)/255+1=(g_里-g_表)/255+1=(b_里-b_表)/255+1\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">里</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">表</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\">/255</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">里</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">表</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\">/255</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">里</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">表</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\">/255</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>r</mi><mo>=</mo><msub><mi>r</mi><mtext>里</mtext></msub><mi mathvariant=\"normal\">/</mi><mi>α</mi><mtext>，</mtext><mi>g</mi><mo>=</mo><msub><mi>g</mi><mtext>里</mtext></msub><mi mathvariant=\"normal\">/</mi><mi>α</mi><mtext>，</mtext><mi>b</mi><mo>=</mo><msub><mi>b</mi><mtext>里</mtext></msub><mi mathvariant=\"normal\">/</mi><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">r=r_里/α，g=g_里/α，b=b_里/α\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0278em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">里</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mord cjk_fallback\">，</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:-0.0359em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">里</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mord cjk_fallback\">，</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">里</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span></span></p>\n<p>可以发现要想完美实现需求的话，需要里图与表图的 rgb 差值相同才行，这也是为啥大部分的幻影坦克用的基本是灰度图的原因，当 rgb 相同的时候颜色就是灰色的，数值越大越白，越小越黑。另外表图是白色也是不可能完成的需求，如果要求表图为白色就要求混合后的图片要么 rgb 都为 255，要么不透明度为零。但是可以降低要求让表图的 rgb 尽可能大，尽可能偏白。如果将表图 rgb 设置为 250 灰白，一般人看不出会认为是白色。同时将阿卡林的图片变成灰度图。灰度的公式如下</p>\n<p>avg =0.299 * r +0.587 * g +0.114 * b 将 rgb 都设置成 avg 就行，至于这三个系数是怎么来的，老实说我也不清楚，但是效果挺好的。于是就得到了如下的公式。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mn>250</mn><mo>=</mo><mi>r</mi><mi>g</mi><mi>b</mi><mo>∗</mo><mi>α</mi><mo>+</mo><mn>255</mn><mo stretchy=\"false\">(</mo><mn>1</mn><mo>−</mo><mi>α</mi><mo stretchy=\"false\">)</mo><mo separator=\"true\">,</mo><mi>r</mi><mi>g</mi><msub><mi>b</mi><mtext>里</mtext></msub><mo>=</mo><mi>r</mi><mi>b</mi><mi>g</mi><mo>∗</mo><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">250 = rgb*α+255(1-α),rgb_里 = rbg*α\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">250</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">255</span><span class=\"mopen\">(</span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mclose\">)</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">里</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">b</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">∗</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span></span></p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><mi>α</mi><mo>=</mo><mo stretchy=\"false\">(</mo><mi>r</mi><mi>g</mi><msub><mi>b</mi><mtext>里</mtext></msub><mo>−</mo><mn>250</mn><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><mn>255</mn><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>r</mi><mi>g</mi><mi>b</mi><mo>=</mo><mi>r</mi><mi>g</mi><msub><mi>b</mi><mtext>里</mtext></msub><mi mathvariant=\"normal\">/</mi><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">α = (rgb_里-250)/255+1,rgb = rgb_里/α\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">里</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">250</span><span class=\"mclose\">)</span><span class=\"mord\">/255</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">里</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span></span></p>\n<p><img data-src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7355fbacf3cb4450a33ece9b60a1b5b0~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=956&amp;h=350&amp;s=1130756&amp;e=gif&amp;f=175&amp;b=faf9f7\" alt=\"57d0c0f6-80f6-4cd4-9650-19e5edcab2db.gif\"></p>\n<p>​\t可以发现效果非常的 amazing 啊，另外在背景颜色为白色的情况下，表图其实不是白色，看的出来有点灰准确的讲是 rgb 为 250 的灰白色，不细看还看不出来。</p>\n<p>​\t那如果就是要里图是有颜色的，而不是灰色图的话要怎么办。可以尝试一下让表图的 rgb 不相同，试着让其尽量大偏白，这就相当于让一个不透明度变小，或者说选择里图中 rgb 最小的值进行计算不透明度，从而计算表图的 rgb。</p>\n<p><img data-src=\"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/90579b9e590a47c29af7a43f71b69788~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=948&amp;h=338&amp;s=2813280&amp;e=gif&amp;f=150&amp;b=f9efe0\" alt=\"66aa414c-870d-4af5-857f-fe7cd59d5805.gif\"></p>\n<p><img data-src=\"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8d71970490ff47ff9cc6b8d8d9d93dcd~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=790&amp;h=324&amp;s=1820951&amp;e=gif&amp;f=175&amp;b=f2e2d0\" alt=\"72266d9f-8b1d-421d-a7e6-a320457f17e9.gif\"></p>\n<p>​\t最终的效果，只能说在黑色背景下图片是完美显示，只是在白色背景下隐藏不了，加一层灰色的遮罩都隐藏不了，因为表图的 rgb 值不同所以会表现出彩色，图片隐藏不住。换句话说，如果想在黑色背景下完美展示，并在白色背景下完美隐藏的彩色图片理论上是不存在的。</p>\n<h4 id=\"4-制作一个真正的幻影坦克\"><a class=\"markdownIt-Anchor\" href=\"#4-制作一个真正的幻影坦克\">#</a> 4. 制作一个真正的幻影坦克</h4>\n<p>​\t如果有一张图片想要在白色背景下展示叫做表图，另一张图片想要在黑色背景下展示加做里图。代入公式可得。</p>\n<p><span class=\"katex-display\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\" display=\"block\"><semantics><mrow><msub><mi>α</mi><mrow><mi>r</mi><mi>g</mi><mi>b</mi></mrow></msub><mo>=</mo><mo stretchy=\"false\">(</mo><mi>r</mi><mi>g</mi><msub><mi>b</mi><mtext>里</mtext></msub><mo>−</mo><mi>r</mi><mi>g</mi><msub><mi>b</mi><mtext>表</mtext></msub><mo stretchy=\"false\">)</mo><mi mathvariant=\"normal\">/</mi><mn>255</mn><mo>+</mo><mn>1</mn><mo separator=\"true\">,</mo><mi>r</mi><mi>g</mi><mi>b</mi><mo>=</mo><mi>r</mi><mi>g</mi><msub><mi>b</mi><mtext>里</mtext></msub><mi mathvariant=\"normal\">/</mi><mi>α</mi></mrow><annotation encoding=\"application/x-tex\">α_{rgb} = (rgb_里-rgb_表)/255+1,rgb = rgb_里/α\n</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7167em;vertical-align:-0.2861em;\"></span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3361em;\"><span style=\"top:-2.55em;margin-left:-0.0037em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal mtight\">b</span></span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.2861em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">里</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">表</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mclose\">)</span><span class=\"mord\">/255</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8889em;vertical-align:-0.1944em;\"></span><span class=\"mord\">1</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\">b</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord\"><span class=\"mord mathnormal\">b</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.3283em;\"><span style=\"top:-2.55em;margin-left:0em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord cjk_fallback mtight\">里</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.0037em;\">α</span></span></span></span></span></p>\n<p>可以发现，要想完美实现一个幻影坦克就要表图的色值大于里图的色值，不然的话 α 会大于一，出现异样，具体表现就是在白色背景下会显示出里图。为了更好的隐藏里图可以让里图更暗一些，具体的做法就是将里图的色值等比例的缩小，不过缩的太小，里图会变的很暗，在黑色背景就不太好显示。在选择里图的时候可以考虑色值比较小的图片。</p>\n<p><img data-src=\"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05fcb0852c6f4cad8705e227683dac4e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1328&amp;h=386&amp;s=1926797&amp;e=gif&amp;f=225&amp;b=f0efec\" alt=\"c024f1ab-1aec-4c3d-bf99-ac9f1a02300d.gif\"></p>\n<p>相关资料</p>\n<p><a href=\"[『整活』幻影坦克 基础版_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1kV411v7fR/?spm_id_from=333.880.my_history.page.click)\">『整活』幻影坦克 基础版</a></p>\n<p><a href=\"[幻影坦克架构指南(一) - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/31164700)\">幻影坦克架构指南 (一)</a></p>\n<p><span class=\"exturl\" data-url=\"aHR0cDovLzE4Mi45Mi4xODUuMTQ5LzIwMjEvMDIvMDcv5bm75b2x5Z2m5YWL5Zu+54mH55qE5Y6f55CG5ZKM5Lu75oSP5Lik5byg5Zu+54mH5ZCI5oiQ5bm75b2x5Z2m5YWL5Zu+55qE5a6M5aSH5oCn6K6o6K66\">“幻影坦克” 图片的原理和任意两张图片合成幻影坦克图的完备性讨论</span></p>\n",
            "tags": [
                "音视频开发",
                "webrtc"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/11/14/Video-Audio/websocket%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/",
            "url": "https://seele-exzzz.github.io/2023/11/14/Video-Audio/websocket%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/",
            "title": "websocket的基本使用",
            "date_published": "2023-11-14T07:48:00.229Z",
            "content_html": "<h3 id=\"websocket的基本使用\"><a class=\"markdownIt-Anchor\" href=\"#websocket的基本使用\">#</a> websocket 的基本使用</h3>\n<p>websocket 是全双工，可以做到客户端与服务端的实时连接，在直播，即时通讯，等要求实时传输的场景下有广泛的运用。</p>\n<h3 id=\"一-基本使用\"><a class=\"markdownIt-Anchor\" href=\"#一-基本使用\">#</a> 一、基本使用</h3>\n<h4 id=\"1-引用\"><a class=\"markdownIt-Anchor\" href=\"#1-引用\">#</a> 1. 引用</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.前端</span><br><span class=\"line\">let socket = new WebSocket(url) //注意url以ws或者wss开头，而不是http或者https,当调用这个构造函数的时候会连接一下。</span><br><span class=\"line\">socket实例对象上的方法与事件:</span><br><span class=\"line\">onclose:连接关闭事件</span><br><span class=\"line\">onerror:连接失败事件</span><br><span class=\"line\">onopen:连接成功事件</span><br><span class=\"line\">onmessage:从服务器上获取数据时的事件</span><br><span class=\"line\">close:断开连接</span><br><span class=\"line\">send:发送数据</span><br><span class=\"line\">2.后端</span><br><span class=\"line\">npm install ws // 下载ws，一个支持websocket的第三方库</span><br><span class=\"line\">const WebSocket = require(&#x27;ws&#x27;) //引入构造函数websocket</span><br><span class=\"line\">const ws = new WebSocket.Server(&#123;port:3000&#125;) //调用websocket的server方法并传入port参数确定监听的端口号</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"2-连接断连发送接收\"><a class=\"markdownIt-Anchor\" href=\"#2-连接断连发送接收\">#</a> 2. 连接，断连，发送，接收</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1.前端</span><br><span class=\"line\">socket.onopen=()=&gt;&#123;</span><br><span class=\"line\">\tsocket.send(&#x27;hello，world&#x27;) //向服务器发送消息</span><br><span class=\"line\">\tsocket.close() //断开连接</span><br><span class=\"line\">&#125; //连接成功后的事件。</span><br><span class=\"line\">socket.onmessage=(data)=&gt;&#123;</span><br><span class=\"line\">\tconsole.log(data)</span><br><span class=\"line\">&#125;//当服务器向客户端发送消息后的事件。</span><br><span class=\"line\">2.后端</span><br><span class=\"line\">ws.on(&#x27;connection&#x27;,(server)=&gt;&#123;</span><br><span class=\"line\">\t//后端两种方法接收数据</span><br><span class=\"line\">\tserver.on(&#x27;message&#x27;,(data)=&gt;&#123;</span><br><span class=\"line\">\t\tconsole.log(data)</span><br><span class=\"line\">\t\tconsole.log(data.toString(&#x27;utf8&#x27;)) //可以使用toString将buffer转化为字符串</span><br><span class=\"line\">\t&#125;) //这时传来的数据是buffer二进制格式</span><br><span class=\"line\">\tserver.onmessage=(data)=&gt;&#123;</span><br><span class=\"line\">\t\tconsole.log(data)</span><br><span class=\"line\">\t&#125; //这时传来的数据是json格式</span><br><span class=\"line\">\tserver.on(&#x27;close&#x27;,()=&gt;&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t&#125;)连接断开后的事件。</span><br><span class=\"line\">&#125;)// ws为实例对象，其中有connection的事件，每有一次连接就会调用一次，客户端可以有多次连接。同时，回调函数上有一个参数，之后的连接关闭，以及发送，接受事件都在这个参数上而不在实例对象上</span><br></pre></td></tr></table></figure>\n<h4 id=\"3心跳机制\"><a class=\"markdownIt-Anchor\" href=\"#3心跳机制\">#</a> 3. 心跳机制</h4>\n<p>​\t当客户端与服务端断开连接时，是没有事件回调的，这时如果客户端往服务端发送消息时，会触发 onclose 事件，如果在 onclose 重连，那么之前发送的消息就没了。为了保障客户端与服务端一直维持连接，客户端应该时不时发送消息给服务端，如果某次消息没有回应或者说回应的时间超过了设置超时的时间便发起重新连接直至连接成功。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">前端</span><br><span class=\"line\">let url = &#x27;ws://localhost:3000&#x27;</span><br><span class=\"line\">let socket,heart,localConnection = false</span><br><span class=\"line\">const createWebSocket=(url)=&gt;&#123;</span><br><span class=\"line\">    try&#123;</span><br><span class=\"line\">        socket = new WebSocket(url)</span><br><span class=\"line\">    &#125;catch&#123;</span><br><span class=\"line\">        connection(url)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">const connection=(url)=&gt;&#123;</span><br><span class=\"line\">    if(heart&amp;&amp;heart.live) return //如果有心脏且在跳动就没有必要连接了</span><br><span class=\"line\">    if(localConnection) return //类似节流的写法，一段时间内连接一次，避免重复连接</span><br><span class=\"line\">    localConnection = true</span><br><span class=\"line\">    createWebSocket(url)</span><br><span class=\"line\">    setTimeout(()=&gt;&#123;</span><br><span class=\"line\">        localConnection = false</span><br><span class=\"line\">    &#125;,2000)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">createWebSocket(url)</span><br><span class=\"line\">class Heart&#123;</span><br><span class=\"line\">    constructor(time,timeOut)&#123;</span><br><span class=\"line\">        this.time = time</span><br><span class=\"line\">        this.timeOut = timeOut</span><br><span class=\"line\">        this.live = false</span><br><span class=\"line\">        this.startTime = null</span><br><span class=\"line\">        this.connectionTime = null</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    start()&#123;</span><br><span class=\"line\">        let self = this</span><br><span class=\"line\">        this.startTime = setTimeout(()=&gt;&#123;</span><br><span class=\"line\">            socket.send(&#x27;ping&#x27;)</span><br><span class=\"line\">            self.connectionTime = setTimeout(()=&gt;&#123;</span><br><span class=\"line\">                connection(url)</span><br><span class=\"line\">            &#125;,self.timeOut) //如果在设置超时时间内有回应便会在onmessage处重置心跳将这个定时器清除，如果这个定时器触发了说明了超时，连接可能失败。这时重新连接</span><br><span class=\"line\">        &#125;,this.time) //每次接收到消息都会重置心跳重新启动，这里使用setTimeout，而不是setInterval。</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    reset(time1,time2)&#123;</span><br><span class=\"line\">        let time3 = time1?time1:this.time</span><br><span class=\"line\">        let time4 = time2?time2:this.timeOut</span><br><span class=\"line\">        clearTimeout(this.connectionTime)</span><br><span class=\"line\">        clearTimeout(this.timer)</span><br><span class=\"line\">        return new Heart(time3,time4)</span><br><span class=\"line\">    &#125; //重置，将定时器清除同时可以更改心跳间隔以及超时时间。</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">socket.onopen=()=&gt;&#123;</span><br><span class=\"line\">    heart = new Heart(30000,1000) //每隔30秒跳动一次，超时时间为1秒</span><br><span class=\"line\">    heart.start() //开始跳动</span><br><span class=\"line\">&#125;//连接上后开始跳动心脏</span><br><span class=\"line\">socket.onclose=()=&gt;&#123;</span><br><span class=\"line\">    console.log(&#x27;连接断开&#x27;)</span><br><span class=\"line\">    heart.live = false</span><br><span class=\"line\">    connection(url)</span><br><span class=\"line\">&#125;//连接断开时重新连接</span><br><span class=\"line\">socket.onmessage=(message)=&gt;&#123;</span><br><span class=\"line\">    heart = heart.reset() </span><br><span class=\"line\">    heart.start()</span><br><span class=\"line\">    heart.live = true</span><br><span class=\"line\">    if(message==&#x27;pong&#x27;) return </span><br><span class=\"line\">&#125;//收到消息，说明连接还在，将心脏的live改为true同时重置心脏的跳动，类似防抖的写法。</span><br></pre></td></tr></table></figure>\n<p>相关资料</p>\n<p><a href=\"[WebSocket加入心跳包防止自动断开连接 - 简书 (jianshu.com)](https://www.jianshu.com/p/1141dcf6de3e)\">WebSocket 加入心跳包防止自动断开连接</a></p>\n<p><a href=\"[ws中文文档|ws js中文教程|解析 | npm中文文档 (npmdoc.org)](http://www.npmdoc.org/wszhongwenwendangws-jszhongwenjiaochengjiexi.html#how-to-detect-and-close-broken-connections)\"><span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5ucG1kb2Mub3JnL3dzemhvbmd3ZW53ZW5kYW5nd3MtanN6aG9uZ3dlbmppYW9jaGVuZ2ppZXhpLmh0bWw=\">ws 中文文档 | ws js 中文教程 | 解析</span></a></p>\n<h3 id=\"二-socketio的基本使用\"><a class=\"markdownIt-Anchor\" href=\"#二-socketio的基本使用\">#</a> 二、socket.io 的基本使用</h3>\n<p>​\tsocket.io 是一个第三方库，集成了 websocket, 如果客户端不支持 websocket 的话，会转为 http。同时 websocket 客户端无法访问使用 socket.io 的服务端，socket.io 的客户端也无法访问 websocket 的服务端，即如果使用 socket.io 的话，<span class=\"exturl\" data-url=\"aHR0cDovL3huLS1zb2NrZXQtdnQ5aXo3c2p3ZWs5dnU3cW12bm52OGJxNXFkYTQ5NzBkdnUwYS5pbw==\">服务端和客户端都要使用 socket.io</span>。其中还有 room 和断开重连，在制作直播间以及即时通讯软件的群聊的功能的时候会很方便。重新连接，内置心跳机制。注意，websocket 支持跨域，所以 websocket 并不是一个安全的连接方式，但是 socket.io 不支持跨域，所以在后端使用 socket.io 的时候要使用 cors 解决跨域问题。</p>\n<h4 id=\"1引用\"><a class=\"markdownIt-Anchor\" href=\"#1引用\">#</a> 1. 引用</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">前端</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;script src=&quot;https://cdn.socket.io/4.7.2/socket.io.min.js&quot;&gt;&lt;/script&gt; //使用cdn引用，也可以下载到本地直接引用</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">\t主要这里的url是http或者https，如果是ws或者wss则无法连接。如果不传参数，默认请求地址与客户端同域，另外如果没有设置autoConnect为false，调用则会连接。</span><br><span class=\"line\">    const socket = io(url,options)</span><br><span class=\"line\">&lt;/script&gt;</span><br><span class=\"line\">后端</span><br><span class=\"line\"></span><br><span class=\"line\">npm install socket.io //安装最新版本</span><br><span class=\"line\">npm install socket.io@version //安装指定版本</span><br><span class=\"line\">//纯socket写法</span><br><span class=\"line\">const &#123;Server&#125; = require(&#x27;socket.io&#x27;)</span><br><span class=\"line\">const io = new Server(&#123;port,&#123;option&#125;&#125;) //port端口号，options配置对象</span><br><span class=\"line\">io.on(&#x27;connection&#x27;,(socket)=&gt;&#123;</span><br><span class=\"line\"> </span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">//使用express框架写法</span><br><span class=\"line\">const express = require(&quot;express&quot;);</span><br><span class=\"line\">const &#123; createServer &#125; = require(&quot;http&quot;);</span><br><span class=\"line\">const &#123; Server &#125; = require(&quot;socket.io&quot;);</span><br><span class=\"line\"></span><br><span class=\"line\">const app = express();</span><br><span class=\"line\">const httpServer = createServer(app);</span><br><span class=\"line\">const io = new Server(httpServer, &#123; /* options */ &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">io.on(&quot;connection&quot;, (socket) =&gt; &#123;</span><br><span class=\"line\">  // ...</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">httpServer.listen(3000);</span><br><span class=\"line\">//处理跨域</span><br><span class=\"line\">const io = new Server(httpServer,&#123;</span><br><span class=\"line\">\tcors : url //允许请求的地址 </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h4 id=\"2-基本使用\"><a class=\"markdownIt-Anchor\" href=\"#2-基本使用\">#</a> 2. 基本使用</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">前端</span><br><span class=\"line\">const socket = io(url)</span><br><span class=\"line\">console.log(socket.id) //undefined</span><br><span class=\"line\">socket.on(&#x27;connect&#x27;,()=&gt;&#123;</span><br><span class=\"line\">\tconsole.log(socket.id) //在建立连接之后socket上有一个由20个字符串组成的id值</span><br><span class=\"line\">\tsocket.on(&#x27;connect&#x27;,()=&gt;&#123;</span><br><span class=\"line\">\t</span><br><span class=\"line\">\t&#125;)//连接事件</span><br><span class=\"line\">\tsocket.on(&#x27;disconnect&#x27;,()=&gt;&#123;</span><br><span class=\"line\">\t\tsocket.connect()</span><br><span class=\"line\">\t&#125;)//断连事件，如果触发了可以重新连接</span><br><span class=\"line\">\tsocket.emit(eventName,args)//发送，第一个参数是事件名称，后面可以传入多个参数，参数也可以是回调函数</span><br><span class=\"line\">\tsocket.emit(&#x27;1&#x27;,(res)=&gt;&#123;</span><br><span class=\"line\">\t\tconsole.log(res) //res为后端调用时传入的参数</span><br><span class=\"line\">\t&#125;)</span><br><span class=\"line\">\tsocket.on(&#x27;1&#x27;,(cb)=&gt;&#123;</span><br><span class=\"line\">\t\tcb(&#x27;hello,world&#x27;)</span><br><span class=\"line\">\t&#125;)//这边前端传了一个函数，后端获取后可以调用</span><br><span class=\"line\">\t注意这时会在前端打印这个消息，而不是后端，本质上是前端给后端传一个函数，后端把参数传过去，前端接收到后端的参数后调用。</span><br><span class=\"line\">\tsocket.on(eventName,()=&gt;&#123;&#125;)//监听，第一个参数是事件名称，后面是回调函数。</span><br><span class=\"line\">\tsocket.io的接收和发送的写法与electron和vue的eventBus一致。</span><br><span class=\"line\">\tsocket.once(eventName,()=&gt;&#123;&#125;)//与on不同的是这个调用一次就寄了，</span><br><span class=\"line\">\tsocket.off(eventName，function) //删除某个监听事件,第二个参数可选，如果不传参就删除所有监听事件。</span><br><span class=\"line\">\tsocket.listeners(eventName) //获取某一个事件的回调函数</span><br><span class=\"line\">\tsocket,timeout(time).emit(eventName,()=&gt;&#123;&#125;) //给事件设置一个时间，如果超时则触发后面的回调函数，与心跳机制的超时类似。</span><br><span class=\"line\">\tsocket.close() //断连</span><br><span class=\"line\">\tsocket.connet() //连接</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h4 id=\"3广播房间\"><a class=\"markdownIt-Anchor\" href=\"#3广播房间\">#</a> 3. 广播，房间</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">后端</span><br><span class=\"line\">io.on(&#x27;connection&#x27;,(socket)=&gt;&#123;</span><br><span class=\"line\">\tsocket.emit(eventName，args) //向本次与服务端相连的客户端发送消息</span><br><span class=\"line\">\tsocket.broadcast.emit() //除了本次连接外的其他连接发送消息。</span><br><span class=\"line\">\tsocket.join(room) //加入房间</span><br><span class=\"line\">\tsocket.leave(room) //离开房间</span><br><span class=\"line\">\tsocket.to(room).emit() //给某个房间广播</span><br><span class=\"line\">\tsocket.to(room1).to(room2) //同时给多个房间发消息</span><br><span class=\"line\">\tsocket.to(socket.id) //每个连接都会生成一个id值，给某个客户端发送消息。实现私人消息。</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>相关资料</p>\n<p><a href=\"[Socket.IO](https://socket.io/zh-CN/)\">Socket.IO 官方文档</a></p>\n<h3 id=\"多人聊天室\"><a class=\"markdownIt-Anchor\" href=\"#多人聊天室\">#</a> 多人聊天室</h3>\n<p>实现功能，用户可以选择一个创建或者加入一个聊天室，聊天室会展示该房间的所有用户。用户可以发送消息以及文件。因为时间紧做的比较粗糙，页面简陋且还有一些功能比如给用户加头像，用户名唯一。同时还有一些 bug 比如图片在接收的时候，拿到的 url 有点问题。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br><span class=\"line\">191</span><br><span class=\"line\">192</span><br><span class=\"line\">193</span><br><span class=\"line\">194</span><br><span class=\"line\">195</span><br><span class=\"line\">196</span><br><span class=\"line\">197</span><br><span class=\"line\">198</span><br><span class=\"line\">199</span><br><span class=\"line\">200</span><br><span class=\"line\">201</span><br><span class=\"line\">202</span><br><span class=\"line\">203</span><br><span class=\"line\">204</span><br><span class=\"line\">205</span><br><span class=\"line\">206</span><br><span class=\"line\">207</span><br><span class=\"line\">208</span><br><span class=\"line\">209</span><br><span class=\"line\">210</span><br><span class=\"line\">211</span><br><span class=\"line\">212</span><br><span class=\"line\">213</span><br><span class=\"line\">214</span><br><span class=\"line\">215</span><br><span class=\"line\">216</span><br><span class=\"line\">217</span><br><span class=\"line\">218</span><br><span class=\"line\">219</span><br><span class=\"line\">220</span><br><span class=\"line\">221</span><br><span class=\"line\">222</span><br><span class=\"line\">223</span><br><span class=\"line\">224</span><br><span class=\"line\">225</span><br><span class=\"line\">226</span><br><span class=\"line\">227</span><br><span class=\"line\">228</span><br><span class=\"line\">229</span><br><span class=\"line\">230</span><br><span class=\"line\">231</span><br><span class=\"line\">232</span><br><span class=\"line\">233</span><br><span class=\"line\">234</span><br><span class=\"line\">235</span><br><span class=\"line\">236</span><br><span class=\"line\">237</span><br><span class=\"line\">238</span><br><span class=\"line\">239</span><br><span class=\"line\">240</span><br><span class=\"line\">241</span><br><span class=\"line\">242</span><br><span class=\"line\">243</span><br><span class=\"line\">244</span><br><span class=\"line\">245</span><br><span class=\"line\">246</span><br><span class=\"line\">247</span><br><span class=\"line\">248</span><br><span class=\"line\">249</span><br><span class=\"line\">250</span><br><span class=\"line\">251</span><br><span class=\"line\">252</span><br><span class=\"line\">253</span><br><span class=\"line\">254</span><br><span class=\"line\">255</span><br><span class=\"line\">256</span><br><span class=\"line\">257</span><br><span class=\"line\">258</span><br><span class=\"line\">259</span><br><span class=\"line\">260</span><br><span class=\"line\">261</span><br><span class=\"line\">262</span><br><span class=\"line\">263</span><br><span class=\"line\">264</span><br><span class=\"line\">265</span><br><span class=\"line\">266</span><br><span class=\"line\">267</span><br><span class=\"line\">268</span><br><span class=\"line\">269</span><br><span class=\"line\">270</span><br><span class=\"line\">271</span><br><span class=\"line\">272</span><br><span class=\"line\">273</span><br><span class=\"line\">274</span><br><span class=\"line\">275</span><br><span class=\"line\">276</span><br><span class=\"line\">277</span><br><span class=\"line\">278</span><br><span class=\"line\">279</span><br><span class=\"line\">280</span><br><span class=\"line\">281</span><br><span class=\"line\">282</span><br><span class=\"line\">283</span><br><span class=\"line\">284</span><br><span class=\"line\">285</span><br><span class=\"line\">286</span><br><span class=\"line\">287</span><br><span class=\"line\">288</span><br><span class=\"line\">289</span><br><span class=\"line\">290</span><br><span class=\"line\">291</span><br><span class=\"line\">292</span><br><span class=\"line\">293</span><br><span class=\"line\">294</span><br><span class=\"line\">295</span><br><span class=\"line\">296</span><br><span class=\"line\">297</span><br><span class=\"line\">298</span><br><span class=\"line\">299</span><br><span class=\"line\">300</span><br><span class=\"line\">301</span><br><span class=\"line\">302</span><br><span class=\"line\">303</span><br><span class=\"line\">304</span><br><span class=\"line\">305</span><br><span class=\"line\">306</span><br><span class=\"line\">307</span><br><span class=\"line\">308</span><br><span class=\"line\">309</span><br><span class=\"line\">310</span><br><span class=\"line\">311</span><br><span class=\"line\">312</span><br><span class=\"line\">313</span><br><span class=\"line\">314</span><br><span class=\"line\">315</span><br><span class=\"line\">316</span><br><span class=\"line\">317</span><br><span class=\"line\">318</span><br><span class=\"line\">319</span><br><span class=\"line\">320</span><br><span class=\"line\">321</span><br><span class=\"line\">322</span><br><span class=\"line\">323</span><br><span class=\"line\">324</span><br><span class=\"line\">325</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">前端</span><br><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=&quot;en&quot;&gt;</span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class=\"line\">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class=\"line\">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class=\"line\">    &lt;script src=&quot;https://cdn.socket.io/4.7.2/socket.io.min.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">    &lt;style&gt;</span><br><span class=\"line\">        #user&#123;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            background-image: linear-gradient(to top, #fad0c4 0%, #fad0c4 1%, #ffd1ff 100%);</span><br><span class=\"line\">            width: 600px;</span><br><span class=\"line\">            height: 300px;</span><br><span class=\"line\">            left: 50%;</span><br><span class=\"line\">            top: 50%;</span><br><span class=\"line\">            margin-left: -300px;</span><br><span class=\"line\">            margin-top: -150px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #roomList&#123;</span><br><span class=\"line\">            width: 300px;</span><br><span class=\"line\">            margin: 40px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #userData&#123;</span><br><span class=\"line\">            width: 300px;</span><br><span class=\"line\">            margin: 0 auto;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #join&#123;</span><br><span class=\"line\">            display: block;</span><br><span class=\"line\">            width: 200px;</span><br><span class=\"line\">            background-image: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);</span><br><span class=\"line\">            height: 50px;</span><br><span class=\"line\">            margin: 40px auto;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        input&#123;</span><br><span class=\"line\">            margin: 4px;</span><br><span class=\"line\">            padding: 4px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #ul&#123;</span><br><span class=\"line\">            display: flex;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ul&#123;</span><br><span class=\"line\">            </span><br><span class=\"line\">            list-style: none;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        li&#123;</span><br><span class=\"line\">            list-style: none;</span><br><span class=\"line\">            margin: 0 4px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #chat&#123;</span><br><span class=\"line\">            position: relative;</span><br><span class=\"line\">            background-color: #a1c4fd;</span><br><span class=\"line\">            top: 100px;</span><br><span class=\"line\">            left: 200px;</span><br><span class=\"line\">            width: 1600px;</span><br><span class=\"line\">            height: 800px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #left&#123;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            background-color: #c2e9fb;</span><br><span class=\"line\">            width: 60%;</span><br><span class=\"line\">            height: 90%;</span><br><span class=\"line\">            left: 5%;</span><br><span class=\"line\">            top: 5%;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #right&#123;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            background-color: #ffd1ff;</span><br><span class=\"line\">            width: 25%;</span><br><span class=\"line\">            height: 80%;</span><br><span class=\"line\">            left: 70%;</span><br><span class=\"line\">            top: 10%;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #textarea&#123;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            top: 95%;</span><br><span class=\"line\">            width: 80%;</span><br><span class=\"line\">            left: 12%;</span><br><span class=\"line\">            resize: none;</span><br><span class=\"line\">            overflow: hidden;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #sendFile&#123;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            top: 95%;</span><br><span class=\"line\">            width: 10%;</span><br><span class=\"line\">            text-align: center;</span><br><span class=\"line\">            margin: 10px;</span><br><span class=\"line\">            background-color: #ffd1ff;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #sendmsg&#123;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            top: 95%;</span><br><span class=\"line\">            left: 90%;</span><br><span class=\"line\">            width: 10%;</span><br><span class=\"line\">            text-align: center;</span><br><span class=\"line\">            margin: 10px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        #webchat&#123;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            background-color: antiquewhite;</span><br><span class=\"line\">            top: 4%;</span><br><span class=\"line\">            width: 100%;</span><br><span class=\"line\">            height: 90%;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &lt;/style&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;div id=&quot;user&quot; &gt;</span><br><span class=\"line\">        &lt;div id=&quot;roomList&quot;&gt;</span><br><span class=\"line\">            &lt;ul id=&quot;list&quot;&gt;房间列表:&lt;/ul&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">        &lt;div id=&quot;userData&quot;&gt;</span><br><span class=\"line\">            &lt;div &gt;用户名:&lt;input id=&quot;userName&quot;/&gt;&lt;/div&gt;</span><br><span class=\"line\">            &lt;div &gt;房间号:&lt;input id=&quot;roomName&quot;/&gt;&lt;/div&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">        &lt;div&gt;&lt;button id=&quot;join&quot;&gt;加入&lt;/button&gt;&lt;/div&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">    &lt;div id=&quot;chat&quot; style=&quot;display: none;&quot;&gt;</span><br><span class=\"line\">        &lt;div id=&quot;left&quot;&gt;</span><br><span class=\"line\">            房间号:&lt;span id=&quot;roomNumber&quot;&gt;&lt;/span&gt;</span><br><span class=\"line\">            &lt;div id=&quot;webchat&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">            &lt;div id=&quot;sendFile&quot;&gt;发送文件&lt;/div&gt;</span><br><span class=\"line\">            &lt;textarea name=&quot;&quot; id=&quot;textarea&quot;&gt;&lt;/textarea&gt;</span><br><span class=\"line\">            &lt;div id=&quot;sendmsg&quot;&gt;发送&lt;/div&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">        &lt;div id=&quot;right&quot;&gt;</span><br><span class=\"line\">            &lt;ul id=&quot;userList&quot;&gt;用户列表&lt;/ul&gt;</span><br><span class=\"line\">        &lt;/div&gt;</span><br><span class=\"line\">    &lt;/div&gt;</span><br><span class=\"line\">    &lt;script&gt;</span><br><span class=\"line\">    let userName = document.querySelector(&#x27;#userName&#x27;)</span><br><span class=\"line\">    let roomName = document.querySelector(&#x27;#roomName&#x27;)  </span><br><span class=\"line\">    let join = document.querySelector(&#x27;#join&#x27;)</span><br><span class=\"line\">    let sendmsg = document.querySelector(&#x27;#sendmsg&#x27;)</span><br><span class=\"line\">    let webchat = document.querySelector(&#x27;#webchat&#x27;)</span><br><span class=\"line\">    let name,room</span><br><span class=\"line\">    /*</span><br><span class=\"line\">        加入后，登录页面消失，聊天页面显示，同时展示房间号，该房间的用户。</span><br><span class=\"line\">    */</span><br><span class=\"line\">    function addmsg(value,name)&#123;</span><br><span class=\"line\">        let div = document.createElement(&#x27;div&#x27;)</span><br><span class=\"line\">        let user = document.createElement(&#x27;span&#x27;)</span><br><span class=\"line\">        user.innerHTML = name+&#x27;:&#x27;+value</span><br><span class=\"line\">        div.appendChild(user)</span><br><span class=\"line\">        webchat.appendChild(div)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    join.addEventListener(&#x27;click&#x27;,()=&gt;&#123;</span><br><span class=\"line\">        let user =&#123;</span><br><span class=\"line\">            userName:userName.value,</span><br><span class=\"line\">            roomName:roomName.value</span><br><span class=\"line\">        &#125; //获取用户的名字以及房间号</span><br><span class=\"line\">        name = user.userName</span><br><span class=\"line\">        room = user.roomName</span><br><span class=\"line\">        socket.emit(&#x27;joinRoom&#x27;,user) //告知服务器是哪个用户加入了那个房间</span><br><span class=\"line\">        document.querySelector(&#x27;#user&#x27;).style.display = &#x27;none&#x27; //登录页面消失</span><br><span class=\"line\">        document.querySelector(&#x27;#chat&#x27;).style.display = &#x27;block&#x27; //聊天页面显示</span><br><span class=\"line\">        let li = document.createElement(&#x27;li&#x27;)</span><br><span class=\"line\">        let ul = document.querySelector(&#x27;#userList&#x27;) //该房间的用户列表</span><br><span class=\"line\">        document.querySelector(&#x27;#roomNumber&#x27;).innerHTML = roomName.value</span><br><span class=\"line\">        li.textContent = userName.value</span><br><span class=\"line\">        ul.appendChild(li)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    sendmsg.addEventListener(&#x27;click&#x27;,()=&gt;&#123;</span><br><span class=\"line\">        let textarea = document.querySelector(&#x27;#textarea&#x27;)</span><br><span class=\"line\">        let value = textarea.value</span><br><span class=\"line\">        textarea.value = &#x27;&#x27;</span><br><span class=\"line\">        addmsg(value,name)</span><br><span class=\"line\">        socket.emit(&#x27;chatmsg&#x27;,value,room,name)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    const socket = io(&#x27;http://localhost:3000&#x27;)</span><br><span class=\"line\">    socket.on(&#x27;connect&#x27;,()=&gt;[</span><br><span class=\"line\">    ])</span><br><span class=\"line\">    socket.on(&#x27;disconnect&#x27;,()=&gt;&#123;</span><br><span class=\"line\">        socket.connect() //断连后重新连接</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    socket.on(&#x27;roomUser&#x27;,(list)=&gt;&#123;</span><br><span class=\"line\">        let ul = document.querySelector(&#x27;#userList&#x27;)//该房间的用户列表</span><br><span class=\"line\">        if(list&amp;&amp;list.length&gt;=2)&#123;</span><br><span class=\"line\">            </span><br><span class=\"line\">                console.log(list)</span><br><span class=\"line\">                if(document.querySelector(&#x27;#userList li&#x27;))&#123;</span><br><span class=\"line\">                    document.querySelector(&#x27;#userList li&#x27;).remove()</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            //说明加入了一个有用户的房间</span><br><span class=\"line\">            list.forEach((user)=&gt;&#123;</span><br><span class=\"line\">                let li = document.createElement(&#x27;li&#x27;)</span><br><span class=\"line\">                li.textContent = user</span><br><span class=\"line\">                ul.appendChild(li)</span><br><span class=\"line\">            &#125;)    </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    socket.on(&#x27;chat&#x27;,(msg,name)=&gt;&#123;</span><br><span class=\"line\">        addmsg(msg,name)</span><br><span class=\"line\">    &#125;) //该房间的用户发送的消息</span><br><span class=\"line\">    socket.on(&#x27;roomList&#x27;,(roomList)=&gt;&#123;</span><br><span class=\"line\">        let roomUl = document.querySelector(&#x27;#list&#x27;) //登录页面的房间列表</span><br><span class=\"line\">        roomList.forEach((room)=&gt;&#123;</span><br><span class=\"line\">            let roomLi = document.createElement(&#x27;li&#x27;) </span><br><span class=\"line\">            roomLi.textContent = room</span><br><span class=\"line\">            roomUl.appendChild(roomLi)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    socket.on(&#x27;addNewRoom&#x27;,(room)=&gt;&#123;</span><br><span class=\"line\">        let roomUl = document.querySelector(&#x27;#list&#x27;) //登录页面的房间列表</span><br><span class=\"line\">        let roomLi = document.createElement(&#x27;li&#x27;) </span><br><span class=\"line\">        roomLi.textContent = room</span><br><span class=\"line\">        roomUl.appendChild(roomLi)</span><br><span class=\"line\">    &#125;)//有用户创建了新的房间</span><br><span class=\"line\">    socket.on(&#x27;roomIn&#x27;,(msg,user)=&gt;&#123;</span><br><span class=\"line\">        //当有其他用户加入房间，便会向该房间广播这个消息</span><br><span class=\"line\">        let userLi = document.createElement(&#x27;li&#x27;)</span><br><span class=\"line\">        let userUl = document.querySelector(&#x27;#userList&#x27;) //聊天页面的该房间下的用户列表。</span><br><span class=\"line\">        userLi.textContent = user</span><br><span class=\"line\">        userUl.appendChild(userLi)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">    /*</span><br><span class=\"line\">        文件上传功能实现</span><br><span class=\"line\">    */</span><br><span class=\"line\"></span><br><span class=\"line\">    let drag = document.querySelector(&#x27;#sendFile&#x27;)</span><br><span class=\"line\">    drag.ondragover=(e)=&gt;&#123;</span><br><span class=\"line\">        e.preventDefault() //阻止事件默认行为</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    drag.ondrop=(e)=&gt;&#123;</span><br><span class=\"line\">        e.preventDefault() </span><br><span class=\"line\">        let file = e.dataTransfer.files[0]</span><br><span class=\"line\">        let read = new FileReader()</span><br><span class=\"line\">        let blob = new Blob([file],&#123;type:file.type&#125;)</span><br><span class=\"line\">        read.readAsArrayBuffer(blob)</span><br><span class=\"line\">        read.onload=(e)=&gt;&#123;</span><br><span class=\"line\">            let arrayBuffer = e.target.result</span><br><span class=\"line\">            socket.emit(&quot;upload&quot;,arrayBuffer,file.type,room)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    socket.on(&#x27;sendFile&#x27;,(file,type)=&gt;&#123;</span><br><span class=\"line\">        let div = document.createElement(&#x27;div&#x27;)</span><br><span class=\"line\">        let blob = new Blob([file],&#123;type&#125;)</span><br><span class=\"line\">        let read = new FileReader()</span><br><span class=\"line\">        div.style.height = 100+&#x27;px&#x27;</span><br><span class=\"line\">        div.style.width = 100+&#x27;px&#x27;</span><br><span class=\"line\">        read.readAsDataURL(blob)</span><br><span class=\"line\">        read.onload=(e)=&gt;&#123;</span><br><span class=\"line\">            let url = e.target.result</span><br><span class=\"line\">            console.log(url)</span><br><span class=\"line\">            if(type.indexOf(&#x27;image&#x27;)!=-1)&#123;</span><br><span class=\"line\">                let image = document.createElement(&#x27;image&#x27;)</span><br><span class=\"line\">                let span = document.createElement(&#x27;span&#x27;)</span><br><span class=\"line\">                image.src = url</span><br><span class=\"line\">                span.innerHTML=name+&#x27;:&#x27;+&#x27;文件&#x27;</span><br><span class=\"line\">                div.appendChild(span)</span><br><span class=\"line\">                div.appendChild(image)</span><br><span class=\"line\">            &#125;else&#123;</span><br><span class=\"line\">                let a = document.createElement(&#x27;a&#x27;)</span><br><span class=\"line\">                let span = document.createElement(&#x27;span&#x27;)</span><br><span class=\"line\">                span.innerHTML=name+&#x27;:&#x27;+&#x27;文件&#x27;</span><br><span class=\"line\">                a.appendChild(span)</span><br><span class=\"line\">                a.href = url</span><br><span class=\"line\">                a.download = true</span><br><span class=\"line\">                div.appendChild(a)</span><br><span class=\"line\">            &#125;    </span><br><span class=\"line\">            webchat.appendChild(div)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    &lt;/script&gt;</span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\">&lt;/html&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">后端</span><br><span class=\"line\">const express = require(&#x27;express&#x27;)</span><br><span class=\"line\">const &#123; createServer &#125; = require(&#x27;http&#x27;)</span><br><span class=\"line\">const &#123;Server&#125; = require(&#x27;socket.io&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">const app = express()</span><br><span class=\"line\">const httpServer = createServer(app)</span><br><span class=\"line\">const io = new Server(httpServer,&#123;</span><br><span class=\"line\">   cors:&#x27;127.0.0.1:5500&#x27;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">let roomSet = new Set() //储存用户创建的房间</span><br><span class=\"line\">let roomMap = new Map() //键为房间，值为这个房间下所有用户</span><br><span class=\"line\"></span><br><span class=\"line\">io.on(&#x27;connection&#x27;,(socket)=&gt;&#123;</span><br><span class=\"line\">    console.log(&#x27;连接成功&#x27;)</span><br><span class=\"line\">    //当有用户连接时，将目前已有的房间传过去</span><br><span class=\"line\">    socket.emit(&#x27;roomList&#x27;,[...roomSet]) </span><br><span class=\"line\">    /*</span><br><span class=\"line\">    当有用户加入房间成功后，会向服务器发送用户以及房间名。</span><br><span class=\"line\">    如果是新房间则向所有用户广播新房间同时给这个房间的所有用户发送消息。</span><br><span class=\"line\">    */</span><br><span class=\"line\">    socket.on(&#x27;joinRoom&#x27;,(data)=&gt;&#123;</span><br><span class=\"line\">        const &#123;userName,roomName&#125; = data</span><br><span class=\"line\">        if(!roomSet.has(roomName))&#123;</span><br><span class=\"line\">          io.emit(&#x27;addNewRoom&#x27;,roomName)</span><br><span class=\"line\">        &#125;//如果是新的房间,则向所有用户广播。</span><br><span class=\"line\">        let userList</span><br><span class=\"line\">        if(roomMap.has(roomName))&#123;</span><br><span class=\"line\">          userList = roomMap.get(roomName)</span><br><span class=\"line\">          let list = roomMap.get(roomName)</span><br><span class=\"line\">          list.push(userName)</span><br><span class=\"line\">          roomMap.set(roomName,list)</span><br><span class=\"line\">        &#125;else&#123;</span><br><span class=\"line\">          let list = [userName]</span><br><span class=\"line\">          roomMap.set(roomName,list)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        socket.join(roomName) //让该用户加入此房间</span><br><span class=\"line\">        roomSet.add(roomName) //记录用户创建的房间</span><br><span class=\"line\">        socket.to(roomName).emit(&#x27;roomIn&#x27;,`$&#123;userName&#125;进入$&#123;roomName&#125;房间`,userName)</span><br><span class=\"line\">        socket.emit(&#x27;roomUser&#x27;,userList) //用户进入房间后,向用户发送该房间的所有用户</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    socket.on(&#x27;upload&#x27;,(file,type,room)=&gt;&#123;</span><br><span class=\"line\">      socket.to(room).emit(&#x27;sendFile&#x27;,file,type)</span><br><span class=\"line\">    &#125;) //收到文件后向该房间的用户广播</span><br><span class=\"line\">    socket.on(&#x27;chatmsg&#x27;,(msg,room,name)=&gt;&#123;</span><br><span class=\"line\">        socket.to(room).emit(&#x27;chat&#x27;,msg,name)</span><br><span class=\"line\">    &#125;) //有用户发言就给该房间的所有用户发送消息</span><br><span class=\"line\">    socket.on(&#x27;disconnect&#x27;,()=&gt;&#123;</span><br><span class=\"line\">\t\tconsole.log(&#x27;断开连接&#x27;)</span><br><span class=\"line\">\t&#125;) //本次连接断开连接</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">io.on(&#x27;disconnect&#x27;,()=&gt;&#123;</span><br><span class=\"line\">  console.log(&#x27;断开连接&#x27;)</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">httpServer.listen(3000)</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "音视频开发",
                "webrtc"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/11/13/Video-Audio/canvas%E5%AF%B9%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/",
            "url": "https://seele-exzzz.github.io/2023/11/13/Video-Audio/canvas%E5%AF%B9%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/",
            "title": "canvas对视频处理",
            "date_published": "2023-11-13T10:08:48.565Z",
            "content_html": "<h2 id=\"canvas对视频处理\"><a class=\"markdownIt-Anchor\" href=\"#canvas对视频处理\">#</a> canvas 对视频处理</h2>\n<h3 id=\"1使用canvas动态截取视频\"><a class=\"markdownIt-Anchor\" href=\"#1使用canvas动态截取视频\">#</a> 1. 使用 canvas 动态截取视频</h3>\n<h4 id=\"1-截取画面\"><a class=\"markdownIt-Anchor\" href=\"#1-截取画面\">#</a> 1. 截取画面</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//可以使用drawImage截取视频当前播放的这一帧画面。</span><br><span class=\"line\">this.ctx.drawImage(video,0,0,width,height)</span><br><span class=\"line\">//与处理图片一样可以使用getImageData获取某一帧的画面的rgba数据</span><br><span class=\"line\">let data = this.ctx.getImageData(0,0,width,height)</span><br><span class=\"line\">//处理后使用putImageData将某画面绘制到canvas上。</span><br><span class=\"line\">this.ctx.putImageData(data,0,0)</span><br><span class=\"line\">最后绘制时注意，视频的大小以及画布的大小，如果视频大于画布的大小可以考虑使用scale缩小坐标系，不过这样会导致画面变糊，不建议这样解决。众所周知，canvas有两个宽高，一个是画布的宽高，这个获取dom后设置即可，另一个是展示的宽高，这个用style设置即可。先获取视频的大小，将画布的大小设置成视频的大小，由于展示的画布大小小于视频这时会自动对画布的内容缩小。</span><br><span class=\"line\">video.onloadeddata=()=&gt;&#123;</span><br><span class=\"line\">\t\tcanvas.width = video.videoWidth</span><br><span class=\"line\">\t\tcanvas.height = video.videoHeight</span><br><span class=\"line\">&#125;//视频加载完成后触发的一个事件</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-canvas处理视频\"><a class=\"markdownIt-Anchor\" href=\"#2-canvas处理视频\">#</a> 2. canvas 处理视频</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//绘制视频</span><br><span class=\"line\">function record()&#123;</span><br><span class=\"line\">\tctx.drawImage(video,0,0) //绘制视频</span><br><span class=\"line\">\tsetTimeout(()=&gt;&#123;</span><br><span class=\"line\">\t\trecord()</span><br><span class=\"line\">\t&#125;,16) //每隔16ms调用自己</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">既然都拿到视频画面了，可以对视频每一帧处理，比如将图片变为灰度图片。</span><br><span class=\"line\">function record()&#123;</span><br><span class=\"line\">\tctx.drawImage(video,0,0) //绘制视频</span><br><span class=\"line\">\tlet imageData = ctx.getImageData(0,0,canvas.width,canvas.height)</span><br><span class=\"line\">            for(let i=0;i&lt;imageData.data.length;i+=4)&#123;</span><br><span class=\"line\">                let r = imageData.data[i]</span><br><span class=\"line\">                let g = imageData.data[i+1]</span><br><span class=\"line\">                let b = imageData.data[i+2]</span><br><span class=\"line\">                let avg = .299 * r + .587 * g + .114 * b</span><br><span class=\"line\">                imageData.data[i] = avg</span><br><span class=\"line\">                imageData.data[i+1] = avg</span><br><span class=\"line\">                imageData.data[i+2] = avg</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">    ctx.putImageData(imageData,0,0)</span><br><span class=\"line\">\tsetTimeout(()=&gt;&#123;</span><br><span class=\"line\">\t\trecord()</span><br><span class=\"line\">\t&#125;,16) //每隔16ms调用自己</span><br><span class=\"line\">&#125;//不过这样处理之后，绘制的视频掉帧严重。</span><br></pre></td></tr></table></figure>\n<h3 id=\"3合成视频\"><a class=\"markdownIt-Anchor\" href=\"#3合成视频\">#</a> 3. 合成视频</h3>\n<p>如果有一段绿幕视频，只要将这个画面用 drawImage 绘制，然后用 getImageData 获取画面的 rgba 数据，将所有纯绿色的像素点即 rb 为 0，g 为 255 的像素点的透明度改为 0 即完全透明，再将这个画面绘制到另一个视频即可。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;video src=&quot;./video/1.mp4&quot; id=&quot;video&quot; style=&quot;width: 600px; height: 400px;&quot; controls&gt;&lt;/video&gt;</span><br><span class=\"line\">&lt;video src=&quot;./video/蓝幕.mp4&quot; id=&quot;blue&quot; style=&quot;width: 600px; height: 400px;&quot; controls&gt;&lt;/video&gt;</span><br><span class=\"line\">&lt;button id=&quot;play&quot;&gt;播放&lt;/button&gt;</span><br><span class=\"line\">&lt;canvas id=&quot;canvas&quot; style=&quot;width: 600px; height: 400px;&quot;&gt;&lt;/canvas&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">let video = document.querySelector(&#x27;#video&#x27;)</span><br><span class=\"line\">let blue = document.querySelector(&#x27;#blue&#x27;)</span><br><span class=\"line\">let play = document.querySelector(&#x27;#play&#x27;)</span><br><span class=\"line\">let canvasblue = document.createElement(&#x27;canvas&#x27;)</span><br><span class=\"line\">let canvas = document.querySelector(&#x27;#canvas&#x27;)</span><br><span class=\"line\">let ctx = canvas.getContext(&#x27;2d&#x27;)</span><br><span class=\"line\">let ctxblue = canvasblue.getContext(&#x27;2d&#x27;)      </span><br><span class=\"line\">//视频加载完成后，将画布的宽高设置成视频的宽高</span><br><span class=\"line\">blue.onloadeddata = ()=&gt;&#123;</span><br><span class=\"line\">  canvasblue.width = blue.videoWidth</span><br><span class=\"line\">  canvasblue.height = blue.videoHeight</span><br><span class=\"line\">&#125;      </span><br><span class=\"line\">video.onloadeddata = ()=&gt;&#123;</span><br><span class=\"line\">  canvas.width = video.videoWidth</span><br><span class=\"line\">  canvas.height = video.videoHeight</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">play.addEventListener(&#x27;click&#x27;,()=&gt;&#123;</span><br><span class=\"line\">    blue.play()</span><br><span class=\"line\">    video.play()</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">video.addEventListener(&#x27;play&#x27;,()=&gt;&#123;</span><br><span class=\"line\">    setInterval(()=&gt;&#123;</span><br><span class=\"line\">        ctxblue.drawImage(blue,0,0) //用画布绘制蓝幕视频</span><br><span class=\"line\">        let data = ctxblue.getImageData(0,0,blue.videoWidth,blue.videoHeight)</span><br><span class=\"line\">        for(let i=0;i&lt;data.data.length;i+=4)&#123;</span><br><span class=\"line\">            if(data.data[i+2]==255) data.data[i+3] = 0</span><br><span class=\"line\">            //如果像素点蓝色为255则将其变为完全透明</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        ctxblue.putImageData(data,0,0) //将更改的数据绘制会原画布</span><br><span class=\"line\">        ctx.drawImage(video,0,0) //绘制原视频</span><br><span class=\"line\">        ctx.drawImage(canvasblue,0,0) //将绘制蓝幕的画布绘制到原视频。最后发现原视频掉帧严重。</span><br><span class=\"line\">    &#125;,16) 每隔16ms绘制一次。</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p><a href=\"[使用 canvas 处理视频 - Web API 接口参考 | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Manipulating_video_using_canvas)\">使用 canvas 处理视频</a></p>\n",
            "tags": [
                "音视频开发",
                "webrtc"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/11/11/Video-Audio/canvas%E5%AF%B9%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/",
            "url": "https://seele-exzzz.github.io/2023/11/11/Video-Audio/canvas%E5%AF%B9%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/",
            "title": "canvas对图片处理",
            "date_published": "2023-11-11T01:41:27.957Z",
            "content_html": "<h2 id=\"canvas对图片处理\"><a class=\"markdownIt-Anchor\" href=\"#canvas对图片处理\">#</a> canvas 对图片处理</h2>\n<h3 id=\"1绘制裁剪\"><a class=\"markdownIt-Anchor\" href=\"#1绘制裁剪\">#</a> 1. 绘制，裁剪</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let img = document.querySelector(&#x27;#img&#x27;)</span><br><span class=\"line\">let canvas = document.querySelector(&#x27;#canvas&#x27;)</span><br><span class=\"line\">let ctx = canvas.getContext(&#x27;2d&#x27;)</span><br><span class=\"line\">img.onload=()=&gt;&#123;</span><br><span class=\"line\">    canvas.width = img.width</span><br><span class=\"line\">    canvas.height = img.height</span><br><span class=\"line\">    //第一种绘制方法，第一个为图像的Dom，第二个参数为，图像绘制到画布的水平位置，第三个参数为，图像绘制到画布的竖直方向</span><br><span class=\"line\">    ctx.drawImage(img,0,0) </span><br><span class=\"line\">    //第二种绘制方法可以进行，前三个参数一样，width为图像在画布的宽度，如果这个值比canvas本身的宽度要大便是放大，要小就是缩小。height也一样。</span><br><span class=\"line\">    ctx.drawImage(img,0,0,width,height)</span><br><span class=\"line\">    //第三种绘制方法为裁剪。</span><br><span class=\"line\">    sx: 裁剪点位于最左边的位置的差值</span><br><span class=\"line\">    sy: 裁剪点位于最上边的位置的差值</span><br><span class=\"line\">    swidth: 裁剪宽度</span><br><span class=\"line\">    sheight 裁剪高度</span><br><span class=\"line\">    这四个与裁剪相关用于确定裁剪位置以及裁剪宽高。</span><br><span class=\"line\">    后面四个参数与第二种绘制方法的后面四个参数一致，前两个用来确定绘制点的位置，后面两个用来确定绘制的宽高。</span><br><span class=\"line\">    ctx.drawImage(img,sx,sy,swidth,sheight,dx,dy,dwidth,dheight)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"2变换\"><a class=\"markdownIt-Anchor\" href=\"#2变换\">#</a> 2. 变换</h3>\n<p>变换为坐标系的改变，如果想让 canvas 的图片发生改变需先改变坐标系，在绘制图片。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.scale(x,y) //x为水平伸缩倍数，y为竖直伸缩倍数。</span><br><span class=\"line\">ctx.translate(x,y) //x为水平移动的距离，y为竖直移动的距离。</span><br><span class=\"line\">ctx.rotate(r) //r为旋转的角度，旋转的点为坐标系原点，默认在左上角，可以通过translate更改原点位置。</span><br><span class=\"line\">ctx.transform(a,b,c,d,e,f) //a:水平缩放,b:垂直倾斜,c:水平倾斜,d:垂直缩放,e:水平移动,f:垂直移动。其实这是一个三阶矩阵。二维图形要选择，缩放需要二阶矩阵，而平移是仿射变化所以需要增加一个维度记录方向。所以图形的缩放，选择，平移需要一个三阶矩阵实现，</span><br></pre></td></tr></table></figure>\n<h3 id=\"3像素控制\"><a class=\"markdownIt-Anchor\" href=\"#3像素控制\">#</a> 3. 像素控制</h3>\n<p>如果直接在本地文件打开并使用 getImageData () 这个函数获取图片的数据的话，会出现跨域问题，可以使用 live serve 这个 vscode 插件，运行文件。关于跨域问题可以参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIubW96aWxsYS5vcmcvemgtQ04vZG9jcy9XZWIvSFRNTC9DT1JTX2VuYWJsZWRfaW1hZ2U=\">这个</span>。</p>\n<h4 id=\"1-灰度图片\"><a class=\"markdownIt-Anchor\" href=\"#1-灰度图片\">#</a> 1. 灰度图片</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ctx.drawImage(img,0,0,img.width,img,height) //先绘制图片，img为dom</span><br><span class=\"line\">let imageData = ctx.getImageData(0,0,img.width,img.height) //获取图片数据</span><br><span class=\"line\">//获取灰度图片，运用0.299*r+0.587*g+0.114*b这个公式获取某一个rgb下的灰度值，当rgb相同时就会呈现灰色。</span><br><span class=\"line\">for(let i=0;i&lt;imageData.data.length;i+=4)&#123; //每一个像素点有四个值分别是rgba，其中a是透明度。</span><br><span class=\"line\">\tlet r = imageData.data[i]</span><br><span class=\"line\">\tlet g = imageData.data[i+1]</span><br><span class=\"line\">\tlet b = imageData.data[i+2]</span><br><span class=\"line\">\tlet avg = .299 * r + .587 * g + .114 * b</span><br><span class=\"line\">    imageData.data[i] = avg</span><br><span class=\"line\">    imageData.data[i+1] = avg</span><br><span class=\"line\">    imageData.data[i+2] = avg</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">//这个函数有两种写法，第一种</span><br><span class=\"line\">ctx.putImageData(imageData,x,y) //x为离坐标原点的水平距离，y为离坐标原点的垂直距离，坐标原点默认是左上角。可以使用translate更改。这个可以改变绘制后图像的改变的位置</span><br><span class=\"line\">第二种写法</span><br><span class=\"line\">ctx.putImageData(imageData,x,y,dx,dy,width,height)</span><br><span class=\"line\">前三个参数与第一种写法一致。后面的参数主要是选择要覆盖原图像的位置。</span><br><span class=\"line\">dx:新图像绘制在原图像的水平位置</span><br><span class=\"line\">dy:新图像绘制在原图像的竖直位置</span><br><span class=\"line\">width:新图像的宽度</span><br><span class=\"line\">height:新图像的高度</span><br><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h4 id=\"2-各种滤镜的实现\"><a class=\"markdownIt-Anchor\" href=\"#2-各种滤镜的实现\">#</a> 2. 各种滤镜的实现</h4>\n<ol>\n<li>\n<p>反色：新 rgb 为（255-r,255-g,255-b）</p>\n</li>\n<li>\n<p>灰色调：新 rgb 为</p>\n<p>r:(r * 0.272) + (g * 0.534) + (b * 0.131)</p>\n<p>g:(r * 0.349) + (g * 0.686) + (b * 0.168)</p>\n<p>b:(r * 0.393) + (g * 0.769) + (b * 0.189)</p>\n</li>\n<li>\n<p>模糊：做卷积，具体原理可以看这个<a href=\"[【官方双语】那么……什么是卷积？_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1Vd4y1e7pj/?spm_id_from=333.999.0.0&vd_source=f327cfd668e6eff40b7b8fec27ccf6df)\">【官方双语】那么…… 什么是卷积？</a></p>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let img = document.querySelector(&#x27;#img&#x27;)</span><br><span class=\"line\">let canvas = document.querySelector(&#x27;#canvas&#x27;)</span><br><span class=\"line\">let invertColor = document.querySelector(&#x27;#invertColor&#x27;)</span><br><span class=\"line\">let adjustColor = document.querySelector(&#x27;#adjustColor&#x27;)</span><br><span class=\"line\">let blurImage = document.querySelector(&#x27;#blurImage&#x27;)</span><br><span class=\"line\">let fudiaoImage = document.querySelector(&#x27;#fudiaoImage&#x27;)</span><br><span class=\"line\">let kediaoImage = document.querySelector(&#x27;#kediaoImage&#x27;)</span><br><span class=\"line\">let mirrorImage = document.querySelector(&#x27;#mirrorImage&#x27;)</span><br><span class=\"line\">let ctx = canvas.getContext(&#x27;2d&#x27;)</span><br><span class=\"line\">let invertColorctx = invertColor.getContext(&#x27;2d&#x27;)</span><br><span class=\"line\">let adjustColorctx = adjustColor.getContext(&#x27;2d&#x27;)</span><br><span class=\"line\">let blurImagectx = blurImage.getContext(&#x27;2d&#x27;)</span><br><span class=\"line\">let fudiaoImagectx = fudiaoImage.getContext(&#x27;2d&#x27;)</span><br><span class=\"line\">let kediaoImagectx = kediaoImage.getContext(&#x27;2d&#x27;)</span><br><span class=\"line\">let mirrorImagectx = mirrorImage.getContext(&#x27;2d&#x27;)</span><br><span class=\"line\">img.src=&quot;./img/cover.jpg&quot;</span><br><span class=\"line\">img.onload=()=&gt;&#123;</span><br><span class=\"line\">    //图片灰度</span><br><span class=\"line\">    canvas.width = img.width</span><br><span class=\"line\">    canvas.height = img.height</span><br><span class=\"line\">    ctx.drawImage(img,0,0,img.width,img.height) </span><br><span class=\"line\">    let imageData = ctx.getImageData(0,0,img.width,img.height)</span><br><span class=\"line\">    for(let i=0;i&lt;imageData.data.length;i+=4)&#123;</span><br><span class=\"line\">        let r = imageData.data[i]</span><br><span class=\"line\">        let g = imageData.data[i+1]</span><br><span class=\"line\">        let b = imageData.data[i+2]</span><br><span class=\"line\">        let avg = .299 * r + .587 * g + .114 * b</span><br><span class=\"line\">        imageData.data[i] = avg</span><br><span class=\"line\">        imageData.data[i+1] = avg</span><br><span class=\"line\">        imageData.data[i+2] = avg</span><br><span class=\"line\"> </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    ctx.putImageData(imageData,0,0,0,0,img.width,img.height)</span><br><span class=\"line\">    //图片反色调</span><br><span class=\"line\">    invertColor.width = img.width</span><br><span class=\"line\">    invertColor.height = img.height</span><br><span class=\"line\">    invertColorctx.drawImage(img,0,0,img.width,img.height)</span><br><span class=\"line\">    let invertColorData = invertColorctx.getImageData(0,0,img.width,img.height)</span><br><span class=\"line\">    for(let i=0;i&lt;invertColorData.data.length;i+=4)&#123;</span><br><span class=\"line\">        invertColorData.data[i] = 255-invertColorData.data[i]</span><br><span class=\"line\">        invertColorData.data[i+1] = 255-invertColorData.data[i+1]</span><br><span class=\"line\">        invertColorData.data[i+2] = 255-invertColorData.data[i+2]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    invertColorctx.putImageData(invertColorData,0,0)</span><br><span class=\"line\">    //图片灰色调</span><br><span class=\"line\">    adjustColor.width = img.width</span><br><span class=\"line\">    adjustColor.height = img.height</span><br><span class=\"line\">    adjustColorctx.drawImage(img,0,0,img.width,img.height)</span><br><span class=\"line\">    let adjustColorData = adjustColorctx.getImageData(0,0,img.width,img.height)</span><br><span class=\"line\">    for(let i=0;i&lt;adjustColorData.data.length;i+=4)&#123;</span><br><span class=\"line\">        let r = adjustColorData.data[i]</span><br><span class=\"line\">        let g = adjustColorData.data[i+1]</span><br><span class=\"line\">        let b = adjustColorData.data[i+2]</span><br><span class=\"line\">        adjustColorData.data[i] = (r * 0.272) + (g * 0.534) + (b * 0.131)</span><br><span class=\"line\">        adjustColorData.data[i+1] = (r * 0.349) + (g * 0.686) + (b * 0.168)</span><br><span class=\"line\">        adjustColorData.data[i+2] = (r * 0.393) + (g * 0.769) + (b * 0.189)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    adjustColorctx.putImageData(adjustColorData,0,0)</span><br><span class=\"line\">    //图片模糊,这里是用3X3的卷积核</span><br><span class=\"line\">    blurImage.width = img.width</span><br><span class=\"line\">    blurImage.height = img.height</span><br><span class=\"line\">    blurImagectx.drawImage(img,0,0,img.width,img.height)</span><br><span class=\"line\">    let blurImageData = blurImagectx.getImageData(0,0,img.width,img.height)</span><br><span class=\"line\">    for(let i=0;i&lt;blurImageData.height-2;i++)&#123;</span><br><span class=\"line\">        for(let j=0;j&lt;blurImageData.width*4-8;j+=4)&#123;</span><br><span class=\"line\">            let list1 = [0,1,2],list2 = [0,4,8]</span><br><span class=\"line\">            let tr=0,tg=0,tb=0</span><br><span class=\"line\">            list1.forEach((a)=&gt;&#123;</span><br><span class=\"line\">                list2.forEach((b)=&gt;&#123;</span><br><span class=\"line\">                    let num = j+b+(i+a)*blurImageData.width*4</span><br><span class=\"line\">                    tr += blurImageData.data[num]</span><br><span class=\"line\">                    tg += blurImageData.data[num+1]</span><br><span class=\"line\">                    tb += blurImageData.data[num+2]</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">            tr = tr/9</span><br><span class=\"line\">            tg = tg/9</span><br><span class=\"line\">            tb = tb/9</span><br><span class=\"line\">            list1.forEach((a)=&gt;&#123;</span><br><span class=\"line\">                list2.forEach((b)=&gt;&#123;</span><br><span class=\"line\">                    let num = j+b+(i+a)*blurImageData.width*4</span><br><span class=\"line\">                    blurImageData.data[num] = tr</span><br><span class=\"line\">                    blurImageData.data[num+1] = tg</span><br><span class=\"line\">                    blurImageData.data[num+2] = tb</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    blurImagectx.putImageData(blurImageData,0,0)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>最终效果，如下</p>\n<img data-src=\"https://typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com/img/video%26audio/canvasimage-20231113175220294.png\">\n<p>相关资料</p>\n<p><a href=\"[25-像素操作_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1kv4y1D7uS/?p=25&vd_source=f327cfd668e6eff40b7b8fec27ccf6df)\">全新 Canvas 全网最详细课程（2023 年 2 月新更）</a></p>\n<p><a href=\"[纯JavaScript实现HTML5 Canvas六种特效滤镜 · HTML5 Canvas编程 · 看云 (kancloud.cn)](https://www.kancloud.cn/digest/canvas-programming/154008)\"><strong>纯 JavaScript 实现 HTML5 Canvas 六种特效滤镜</strong></a></p>\n",
            "tags": [
                "音视频开发",
                "webrtc"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/11/09/Video-Audio/webrtc%E5%9F%BA%E7%A1%80/",
            "url": "https://seele-exzzz.github.io/2023/11/09/Video-Audio/webrtc%E5%9F%BA%E7%A1%80/",
            "title": "webrtc基础",
            "date_published": "2023-11-09T15:30:33.623Z",
            "content_html": "<h2 id=\"webrtc基础\"><a class=\"markdownIt-Anchor\" href=\"#webrtc基础\">#</a> webrtc 基础</h2>\n<h3 id=\"一-获取媒体流\"><a class=\"markdownIt-Anchor\" href=\"#一-获取媒体流\">#</a> 一、获取媒体流</h3>\n<p>navigator.mediaDevices 上有四个方法</p>\n<ol>\n<li>getUserMedia: 获取用户摄像头的媒体流，媒体流包括视频流和音频流。</li>\n<li>getDiaplayMedia: 获取用户的屏幕。</li>\n<li>enumerateDevices: 返回用户设备。</li>\n<li>getSupportedConstraints: 返回一个对象，表示可以约束的属性</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">async function()&#123;</span><br><span class=\"line\">\t//是一个promise，返回一个媒体流对象。</span><br><span class=\"line\">\tlet stream = await navigator.mediaDevices.getUserMedia(&#123;video:true,audio:true&#125;) //获取用户摄像头以及麦克风的流，另外画面是镜像</span><br><span class=\"line\">    let stream = await navigator.mediaDevices.getDisplayMedia(&#123;video:true,audio:false&#125;) //获取用户桌面的流</span><br><span class=\"line\">    video.srcObject = stream //将获取到了媒体流放在video的SrcObject上。不过如果是获取用户桌面的媒体流放在video上播放会出现画面重叠，目前还不知道如何解决，我看别人做的也是这样。</span><br><span class=\"line\">    let list = await navigator.mediaDevices.enumerateDevices() //返回一个数组储存着用户输入输出设备</span><br><span class=\"line\">    list.forEach((arr)=&gt;&#123;</span><br><span class=\"line\">    \tlet &#123;deviceId,label,kind,groupId&#125; = arr</span><br><span class=\"line\">    \tdeviceId : 设备的id</span><br><span class=\"line\">    \tlabel : 设备的名称</span><br><span class=\"line\">    \tkind : 设备种类 audioinput audiooutput videoinput</span><br><span class=\"line\">    \tgroupId : 如果设备是同一个，他们的groupId就是同一个</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    //另外，如果网页不在本地运行且不是https，deviceId，label和groupId则为空。</span><br><span class=\"line\">&#125; </span><br></pre></td></tr></table></figure>\n<h3 id=\"二-媒体流和轨道\"><a class=\"markdownIt-Anchor\" href=\"#二-媒体流和轨道\">#</a> 二、媒体流和轨道</h3>\n<h4 id=\"一-媒体流\"><a class=\"markdownIt-Anchor\" href=\"#一-媒体流\">#</a> 一、媒体流</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">stream&#123;</span><br><span class=\"line\">    属性：</span><br><span class=\"line\">    active //如果获取到用户的媒体流是活跃的则为true，否则为false</span><br><span class=\"line\">    id //每条媒体流有一个专属的id值，用于区别不同的媒体流</span><br><span class=\"line\">    方法：</span><br><span class=\"line\">    addTrack(track) //给这个媒体流增加一个轨</span><br><span class=\"line\">    removeTrack(track) //移除该媒体流下的某一条轨道</span><br><span class=\"line\">    clone(id) //克隆某一个id值下的轨道并返回这个轨道同时新的轨道有新的id值</span><br><span class=\"line\">    getTrackById(id) //返回指定id的轨道</span><br><span class=\"line\">    getTracks() //返回这个视频流中的所有轨道，用数组储存。</span><br><span class=\"line\">    getVideoTracks() //返回所有视频轨，返回顺序不固定，每次调用的时候顺序有变。</span><br><span class=\"line\">    getAudioTracks() //返回所有音频轨，返回顺序不固定，每次调用的时候顺序有变。</span><br><span class=\"line\">    事件处理：</span><br><span class=\"line\">    onaddtrack() //当添加完轨道后触发此事件</span><br><span class=\"line\">    onremovetrack() //当删除某一条轨道后触发此事件</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"二-轨\"><a class=\"markdownIt-Anchor\" href=\"#二-轨\">#</a> 二、轨</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">track&#123;</span><br><span class=\"line\">\t属性：</span><br><span class=\"line\">\tid //每一个轨都有一个专属的id</span><br><span class=\"line\">\tkind //轨的种类，分为audio和video</span><br><span class=\"line\">\tenabled //表示该轨是否可用，可以手动设置。值为布尔值</span><br><span class=\"line\">\tlabel //设备名称</span><br><span class=\"line\">\tmuted //是否静音，值为布尔值</span><br><span class=\"line\">\treadyState //live设备正常连接，ended没有更多数据，而且不会提供更多的数据</span><br><span class=\"line\">\t方法：</span><br><span class=\"line\">\tgetConstraints() //返回该轨道的约束，这个与获取媒体流时传的参数有关</span><br><span class=\"line\">\tapplyConstraints() //给该轨道新的约束</span><br><span class=\"line\">\tgetSettings() //返回该轨道所有约束包括自己添加的和浏览器默认的</span><br><span class=\"line\">\tgetCapabilities() //返回一个对象，表示该轨道可调节的属性值以及范围，可以通过这个获取到约束的范围从而给该轨道设置范围。</span><br><span class=\"line\">\tclone() //返回一个track的克隆，同时产生一个新的id</span><br><span class=\"line\">\tstop() //stop后，readyState的状态变为ended</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"三-约束属性\"><a class=\"markdownIt-Anchor\" href=\"#三-约束属性\">#</a> 三、约束属性</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">约束属性是指音频与视频的属性，一共有以下这些，太长了之后有时间再一个一个写吧</span><br><span class=\"line\">aspectRatio</span><br><span class=\"line\">autoGainControl</span><br><span class=\"line\">brightness</span><br><span class=\"line\">channelCount</span><br><span class=\"line\">colorTemperature</span><br><span class=\"line\">contrast</span><br><span class=\"line\">deviceId</span><br><span class=\"line\">displaySurface</span><br><span class=\"line\">echoCancellation</span><br><span class=\"line\">exposureCompensation</span><br><span class=\"line\">exposureMode</span><br><span class=\"line\">exposureTime</span><br><span class=\"line\">facingMode</span><br><span class=\"line\">focusDistance</span><br><span class=\"line\">focusMode</span><br><span class=\"line\">frameRate</span><br><span class=\"line\">groupId</span><br><span class=\"line\">height</span><br><span class=\"line\">iso</span><br><span class=\"line\">latency</span><br><span class=\"line\">noiseSuppression</span><br><span class=\"line\">pan</span><br><span class=\"line\">pointsOfInterest</span><br><span class=\"line\">resizeMode</span><br><span class=\"line\">sampleRate</span><br><span class=\"line\">sampleSize</span><br><span class=\"line\">saturation</span><br><span class=\"line\">sharpness</span><br><span class=\"line\">suppressLocalAudioPlayback</span><br><span class=\"line\">tilt</span><br><span class=\"line\">torch</span><br><span class=\"line\">whiteBalanceMode</span><br><span class=\"line\">width</span><br><span class=\"line\">zoom</span><br></pre></td></tr></table></figure>\n<p>相关资料</p>\n<p><a href=\"[mediaDevices开启你本地视频之旅行 - 掘金 (juejin.cn)](https://juejin.cn/post/6924563220657586184#heading-3)\">mediaDevices 开启你本地视频之旅行</a></p>\n<p><a href=\"[MediaDevices - Web API 接口参考 | MDN (mozilla.org)](https://developer.mozilla.org/zh-CN/docs/Web/API/MediaDevices)\">MediaDevices MDN</a></p>\n<p><a href=\"[功能、约束和设置 - Web API 接口 |MDN网络 (mozilla.org)](https://developer.mozilla.org/en-US/docs/Web/API/Media_Capture_and_Streams_API/Constraints)\">功能、约束和设置 MDN</a></p>\n<h3 id=\"三-video标签相关属性\"><a class=\"markdownIt-Anchor\" href=\"#三-video标签相关属性\">#</a> 三、video 标签相关属性</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">属性：</span><br><span class=\"line\">autoplay : 在声明该属性后，视频会尽快播放。另外给该值设置false没有用，如果不想自动播放要移除该属性</span><br><span class=\"line\">controls : 给视频增加一个控制面板</span><br><span class=\"line\">controlslist : 当有controls才生效，可以选择将控件移除，可选值nodownload，nofullscreen，noremoteplayback</span><br><span class=\"line\">crossorigin : 是否使用cors来获取视频</span><br><span class=\"line\">loop : 重复播放</span><br><span class=\"line\">poster : 下载时展示的封面，，如果没指定默认按第一帧显示</span><br></pre></td></tr></table></figure>\n<p>相关资料</p>\n<p><a href=\"<video>: 视频嵌入元素 - HTML（超文本标记语言） | MDN (mozilla.org)\">video: 视频嵌入元素 MDN</a></p>\n<h3 id=\"四-视频的录制以及下载\"><a class=\"markdownIt-Anchor\" href=\"#四-视频的录制以及下载\">#</a> 四、视频的录制以及下载</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let recoder = new MediaRecorder(options) //options是一个配置对象</span><br><span class=\"line\">options&#123;</span><br><span class=\"line\">\tmimeType : 选择录制时的mime格式,分为视频格式和编码格式</span><br><span class=\"line\">\tstate : inactive(闲置中),recording(录制中),paused(暂停)</span><br><span class=\"line\">\tstream : 需要录制的媒体流</span><br><span class=\"line\">\tvideoBitsPerSecond : 视频的编码比率</span><br><span class=\"line\">\taudioBitsPerSecond : 音频的编码比率</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">方法:</span><br><span class=\"line\">isTypeSupported() : 用来判断用户的浏览器是否支持某个视频格式</span><br><span class=\"line\">pause() : 录制暂停</span><br><span class=\"line\">requestData() : 从最开始或者上一个requestData开始到当前接受到的，储存为blob。</span><br><span class=\"line\">resume() : 继续录制之前被暂停的录制</span><br><span class=\"line\">start(timeslice) : 开始录制,timeslice每隔timeslice毫秒记录视频，储存格式为blob</span><br><span class=\"line\">stop() : 录制停止，无法继续录制，同时触发dataavailable事件，返回一个blob</span><br><span class=\"line\">事件:</span><br><span class=\"line\">ondataavailable : 当调用stop或者requestData或者设置了start的参数，时间到了后触发，该事件的data属性会有录制视频的blob数据。</span><br><span class=\"line\">onpause : pause后触发</span><br><span class=\"line\">onresume : resume后触发</span><br><span class=\"line\">onstart : start后触发</span><br><span class=\"line\">onstop : stop后触发</span><br></pre></td></tr></table></figure>\n<h3 id=\"五-实战\"><a class=\"markdownIt-Anchor\" href=\"#五-实战\">#</a> 五、实战</h3>\n<p>完成获取用户摄像头，麦克风或者桌面的媒体流并展示，同时录制，支持暂停，继续，停止录制。同时将录制的视频展示并下载。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">HTML部分</span><br><span class=\"line\">&lt;div&gt;</span><br><span class=\"line\">    &lt;video autoplay controls playsinline id=&quot;video&quot; style=&quot;width: 800px;height: 600px;&quot;&gt;&lt;/video&gt; </span><br><span class=\"line\">    &lt;video autoplay controls playsinline id=&quot;recordVideo&quot; style=&quot;width: 600px;height: 400px;&quot;&gt;&lt;/video&gt; </span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\">&lt;div&gt;</span><br><span class=\"line\">    &lt;button id=&quot;user&quot;&gt;摄像头录制&lt;/button&gt;</span><br><span class=\"line\">    摄像头选择:</span><br><span class=\"line\">    &lt;select id=&quot;selectVideo&quot; style=&quot;width: 100px;&quot;&gt;&lt;/select&gt;</span><br><span class=\"line\">    麦克风选择:</span><br><span class=\"line\">    &lt;select id=&quot;selectAudio&quot; style=&quot;width: 100px;&quot;&gt;&lt;/select&gt;</span><br><span class=\"line\">    &lt;button id=&quot;desktop&quot;&gt;桌面共享&lt;/button&gt;</span><br><span class=\"line\">    &lt;button id=&quot;start&quot;&gt;视频录制&lt;/button&gt;</span><br><span class=\"line\">    &lt;button id=&quot;pause&quot;&gt;视频录制暂停&lt;/button&gt;</span><br><span class=\"line\">    &lt;button id=&quot;stop&quot;&gt;视频录制停止&lt;/button&gt;</span><br><span class=\"line\">    &lt;button id=&quot;resume&quot;&gt;继续录制&lt;/button&gt;</span><br><span class=\"line\">    &lt;button id=&quot;show&quot;&gt;展示录制视频&lt;/button&gt;</span><br><span class=\"line\">    &lt;button id=&quot;download&quot;&gt;下载录制的视频&lt;/button&gt;</span><br><span class=\"line\">    选择录制视频的格式:</span><br><span class=\"line\">    &lt;select id=&quot;select&quot; style=&quot;width: 120px;&quot;&gt; &lt;/select&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\">JS部分</span><br><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\">    let video = document.querySelector(&#x27;#video&#x27;)</span><br><span class=\"line\">    let recordVideo = document.querySelector(&#x27;#recordVideo&#x27;)</span><br><span class=\"line\">    let user = document.querySelector(&#x27;#user&#x27;)</span><br><span class=\"line\">    let desktop = document.querySelector(&#x27;#desktop&#x27;)</span><br><span class=\"line\">    let select = document.querySelector(&#x27;#select&#x27;)</span><br><span class=\"line\">    let selectVideo = document.querySelector(&#x27;#selectVideo&#x27;)</span><br><span class=\"line\">    let selectAudio = document.querySelector(&#x27;#selectAudio&#x27;)</span><br><span class=\"line\">    let start = document.querySelector(&#x27;#start&#x27;)</span><br><span class=\"line\">    let pause = document.querySelector(&#x27;#pause&#x27;)</span><br><span class=\"line\">    let stop = document.querySelector(&#x27;#stop&#x27;)</span><br><span class=\"line\">    let show = document.querySelector(&#x27;#show&#x27;)</span><br><span class=\"line\">    let resume = document.querySelector(&#x27;#resume&#x27;)</span><br><span class=\"line\">    let download = document.querySelector(&#x27;#download&#x27;)</span><br><span class=\"line\">    let types = [&#x27;webm&#x27;,&#x27;mp4&#x27;,&#x27;ogg&#x27;,&#x27;mov&#x27;,&#x27;avi&#x27;,&#x27;wmv&#x27;,&#x27;flv&#x27;,&#x27;mkv&#x27;,&#x27;ts&#x27;,&#x27;x=matroska&#x27;]</span><br><span class=\"line\">    let codecs = [&#x27;vp9&#x27;,&#x27;vp9.0&#x27;,&#x27;vp8&#x27;,&#x27;vp8.0&#x27;,&#x27;avc1&#x27;,&#x27;av1&#x27;,&#x27;h265&#x27;,&#x27;h264&#x27;]</span><br><span class=\"line\">    let mimeType = &#x27;video/webm;codecs=vp8&#x27;</span><br><span class=\"line\">    let stream,blobList=[],recordStream</span><br><span class=\"line\">    //获取用户摄像头权限</span><br><span class=\"line\">    user.addEventListener(&#x27;click&#x27;,async()=&gt;&#123;</span><br><span class=\"line\">        stream = await navigator.mediaDevices.getUserMedia(&#123;</span><br><span class=\"line\">            video :&#123;</span><br><span class=\"line\">                width:800,</span><br><span class=\"line\">                height:600</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            audio:true</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        video.srcObject = stream</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    //获取用户桌面共享权限</span><br><span class=\"line\">    desktop.addEventListener(&#x27;click&#x27;,async()=&gt;&#123;</span><br><span class=\"line\">        stream = await navigator.mediaDevices.getDisplayMedia(&#123;</span><br><span class=\"line\">            video:&#123;</span><br><span class=\"line\">                width:800,</span><br><span class=\"line\">                height:600</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            audio:false</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        video.srcObject = stream</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    //开始录制</span><br><span class=\"line\">    start.addEventListener(&#x27;click&#x27;,()=&gt;&#123;</span><br><span class=\"line\">        if(recordStream) return //如果已经在开始录制就返回，防止重复录制</span><br><span class=\"line\">        recordStream = new MediaRecorder(stream,&#123;mimeType&#125;)</span><br><span class=\"line\">        recordStream.start(1000) </span><br><span class=\"line\">        recordStream.ondataavailable = (e)=&gt;&#123;</span><br><span class=\"line\">            blobList.push(e.data) //e.data为blob,将blob用数组储存方便后面展示以及下载</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    select.addEventListener(&#x27;click&#x27;,support())</span><br><span class=\"line\">    selectVideo.addEventListener(&#x27;click&#x27;,selectDevice(&#x27;video&#x27;))</span><br><span class=\"line\">    selectAudio.addEventListener(&#x27;click&#x27;,selectDevice(&#x27;audio&#x27;))</span><br><span class=\"line\">    pause.addEventListener(&#x27;click&#x27;,()=&gt;&#123;if(recordStream) recordStream.pause()&#125;)</span><br><span class=\"line\">    stop.addEventListener(&#x27;click&#x27;,()=&gt;&#123;if(recordStream) recordStream.stop()&#125;)</span><br><span class=\"line\">    show.addEventListener(&#x27;click&#x27;,()=&gt;&#123;</span><br><span class=\"line\">        if(blobList.length&gt;0)&#123;</span><br><span class=\"line\">            let blob = new Blob(blobList)</span><br><span class=\"line\">            let url = URL.createObjectURL(blob)</span><br><span class=\"line\">            recordVideo.src = url</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    resume.addEventListener(&#x27;click&#x27;,()=&gt;&#123;if(recordStream) recordStream.resume()&#125;)</span><br><span class=\"line\">    download.addEventListener(&#x27;click&#x27;,downloadVideo)</span><br><span class=\"line\">    function support()&#123;</span><br><span class=\"line\">        let click //闭包，事件委托。第一次点击时获取用户浏览器支持的录制格式，之后获取用户选择的录制格式。</span><br><span class=\"line\">        return async function(e)&#123;</span><br><span class=\"line\">            if(click)&#123;</span><br><span class=\"line\">                mimeType = e.target.value</span><br><span class=\"line\">            &#125;else&#123;</span><br><span class=\"line\">                click = true</span><br><span class=\"line\">                let list = await getSupportList()</span><br><span class=\"line\">                list.forEach((type)=&gt;&#123;</span><br><span class=\"line\">                    let option = document.createElement(&#x27;option&#x27;)</span><br><span class=\"line\">                    option.text = type</span><br><span class=\"line\">                    option.value = type</span><br><span class=\"line\">                    select.add(option)</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">            &#125;  </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    function getSupportList()&#123;</span><br><span class=\"line\">        let list = []</span><br><span class=\"line\">        types.forEach((type)=&gt;&#123;</span><br><span class=\"line\">            codecs.forEach(async(code)=&gt;&#123;</span><br><span class=\"line\">                let videoType = `video/$&#123;type&#125;;codecs=$&#123;code&#125;`</span><br><span class=\"line\">                let res = await MediaRecorder.isTypeSupported(videoType)</span><br><span class=\"line\">                if(res) list.push(videoType)</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        return list</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    function selectDevice(type)&#123;</span><br><span class=\"line\">        let video,audio </span><br><span class=\"line\">        return async function(e)&#123;</span><br><span class=\"line\">            if(type==&#x27;video&#x27;&amp;&amp;!video||type==&#x27;audio&#x27;&amp;&amp;!audio)&#123;</span><br><span class=\"line\">                if(type==&#x27;video&#x27;) video = true</span><br><span class=\"line\">                if(type==&#x27;audio&#x27;) audio = true</span><br><span class=\"line\">                let deviceList = await navigator.mediaDevices.enumerateDevices()</span><br><span class=\"line\">                deviceList.forEach((device)=&gt;&#123;</span><br><span class=\"line\">                    let &#123;deviceId,label,kind,groupId&#125; = device</span><br><span class=\"line\">                    if(type==&#x27;video&#x27;&amp;&amp;kind==&#x27;videoinput&#x27;)&#123;</span><br><span class=\"line\">                        let option = document.createElement(&#x27;option&#x27;)</span><br><span class=\"line\">                        option.text = label</span><br><span class=\"line\">                        option.value = deviceId</span><br><span class=\"line\">                        selectVideo.add(option)</span><br><span class=\"line\">                    &#125;else if(type==&#x27;audio&#x27;&amp;&amp;kind==&#x27;audioinput&#x27;)&#123;</span><br><span class=\"line\">                        let option = document.createElement(&#x27;option&#x27;)</span><br><span class=\"line\">                        option.text = label</span><br><span class=\"line\">                        option.value = deviceId</span><br><span class=\"line\">                        selectAudio.add(option)                        </span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;)</span><br><span class=\"line\">            &#125;else&#123;</span><br><span class=\"line\">                if(e.target.value)&#123;</span><br><span class=\"line\">                    switchCamera(e.target.value)</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    //切换摄像头前先停止录制，将录制的媒体流的所有轨暂停同时将媒体流设置为空</span><br><span class=\"line\">    function stopCamera()&#123;</span><br><span class=\"line\">        if(stream)&#123;</span><br><span class=\"line\">            let trackList = stream.getTracks()</span><br><span class=\"line\">            trackList.forEach((track)=&gt;&#123;</span><br><span class=\"line\">                track.stop()</span><br><span class=\"line\">            &#125;)</span><br><span class=\"line\">            video.srcObject = null</span><br><span class=\"line\">            stream = null</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    async function switchCamera(deviceId)&#123;</span><br><span class=\"line\">        stopCamera()</span><br><span class=\"line\">        stream = navigator.mediaDevices.getUserMedia(&#123;</span><br><span class=\"line\">            video:&#123;</span><br><span class=\"line\">                width:800,</span><br><span class=\"line\">                height:600</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            audio:false,</span><br><span class=\"line\">            deviceId</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        video.srcObject = stream</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    function downloadVideo()&#123;</span><br><span class=\"line\">        let blob = new Blob(blobList,&#123; type: &#x27;video/mp4&#x27; &#125;)</span><br><span class=\"line\">        let url = URL.createObjectURL(blob)</span><br><span class=\"line\">        let a = document.createElement(&#x27;a&#x27;)</span><br><span class=\"line\">        a.href = url</span><br><span class=\"line\">        a.download = &#x27;1&#x27; //给a链接一个download即可下载</span><br><span class=\"line\">        a.click() //点击a下载</span><br><span class=\"line\">        URL.revokeObjectURL(url) //URL.createObjectURL生成的url是储存在内存中，即时清空防止内存泄露</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    &lt;/script&gt;</span><br></pre></td></tr></table></figure>\n<p>相关资料</p>\n<p><a href=\"[WebRTC 从实战到未来！迎接风口，前端必学的技术🔥 - 掘金 (juejin.cn)](https://juejin.cn/post/7151932832041058340?searchId=202311092329013EC7636625689FB1BF03)\">WebRTC 从实战到未来！迎接风口，前端必学的技术🔥</a></p>\n",
            "tags": [
                "音视频开发",
                "webrtc"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/11/07/Video-Audio/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%9F%BA%E7%A1%80/",
            "url": "https://seele-exzzz.github.io/2023/11/07/Video-Audio/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%9F%BA%E7%A1%80/",
            "title": "二进制基础",
            "date_published": "2023-11-07T12:07:51.100Z",
            "content_html": "<h2 id=\"二进制基础\"><a class=\"markdownIt-Anchor\" href=\"#二进制基础\">#</a> 二进制基础</h2>\n<h3 id=\"一-原码-反码-补码\"><a class=\"markdownIt-Anchor\" href=\"#一-原码-反码-补码\">#</a> 一 、 原码 反码 补码</h3>\n<p>对于有符号的变量而言，首位代表符号，0 为正数，1 为负数。</p>\n<p>原码：十进制转化为二进制</p>\n<p>反码：负数的符号不变，其他位取反。</p>\n<p>补码：负数的反码加一。</p>\n<p>另外对于 8 位二进制而言，储存范围为 [-127,127],-128 无原码以及反码，但是有补码为 10000000。而 10000000 在反码以及原码中表示 0.</p>\n<p>计算机内存储存的数据为补码，在进行减法运算的时候则是转化为加法计算，比如 1-1 转化为 1+（-1），将 1 与 - 1 的补码相加然后转为原码就是最终结果。如果加出了九位则将第一位舍弃。</p>\n<p>相关资料：</p>\n<p><a href=\"[【计算机基础】轻松学会原码、反码、补码的转换规则以及计算机内有符号数的计算方式！_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1aB4y177Ef/?spm_id_from=333.337.search-card.all.click&vd_source=f327cfd668e6eff40b7b8fec27ccf6df)\">原码，反码，补码，b 站视频</a></p>\n<p><a href=\"[深入理解计算机中的原码、补码、反码 - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/371184302)\">原码，反码，补码，知乎文章</a></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xMTg0MzI1NTQ=\">原码，反码，补码，知乎文章</span></p>\n<h3 id=\"二-二进制逻辑运算\"><a class=\"markdownIt-Anchor\" href=\"#二-二进制逻辑运算\">#</a> 二、二进制逻辑运算</h3>\n<h4 id=\"1-或与非异或\"><a class=\"markdownIt-Anchor\" href=\"#1-或与非异或\">#</a> 1. 或与非，异或</h4>\n<ol>\n<li>或（&amp;）：两个都为 1 时才为 1</li>\n<li>与（|）： 有一个为 1 就为 1</li>\n<li>非（!）：取反</li>\n<li>异或（^）： 不同为 1，相同为 0，自己与自己取异或为 0</li>\n</ol>\n<h4 id=\"2二进制移位\"><a class=\"markdownIt-Anchor\" href=\"#2二进制移位\">#</a> 2. 二进制移位</h4>\n<ol>\n<li>左移运算：二进制向左移动，最后一位补零。相当于乘 2 的 n 次方，n 为移动的位数 a&lt;&lt;n (a 为数，n 为移动位数)</li>\n<li>有符号右移运算：对于正数，右移第一位补零，对于负数，右移第一位补一，相当于除于 2 的 n 次方，n 为移动的位数并向下取整。a&gt;&gt;n</li>\n<li>无符号右移运算：右移第一位补零  a&gt;&gt;&gt;n</li>\n</ol>\n<p>相关资料：</p>\n<p><a href=\"[【计算机基础】二进制的逻辑运算 - 与、或、非、异或、同或！_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1hY4y1T7au/?spm_id_from=333.999.0.0)\">二进制逻辑运算，b 站视频</a></p>\n<p><a href=\"[【计算机知识】移位运算——左移运算、右移运算、无符号右移！_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1i14y1W7aF/?spm_id_from=333.999.0.0&vd_source=f327cfd668e6eff40b7b8fec27ccf6df)\">二进制移位，b 站视频</a></p>\n<h3 id=\"三-小数的储存以及储存及读取模式\"><a class=\"markdownIt-Anchor\" href=\"#三-小数的储存以及储存及读取模式\">#</a> 三。小数的储存以及储存及读取模式</h3>\n<p>小数的储存分为定点数以及浮点数储存。</p>\n<ol>\n<li>定点数，小数点固定，一般不采用这种方法储存因为储存数据的范围小。将整数部分转为二进制，将小数部分转为二进制，然后组合。小数点在整数后面，小数前面。小数转为二进制的方法为乘 2 然后取整，第一位为 2 的 - 1 次方，第二位为 2 的 - 2 次方，依次类推。有些小数比如 0.2 无法完全转为二进制，会出现精度损失。这也是为什么 JavaScript 中 0.1+0.2!=0.3。如果用 8 位储存一个数据，第一位储存数据的正负，后四位储存整数，最后三位储存小数。那么整数部分就只能储存 1111 即负 - 16 到 15，小数部分只能储存 111，即 2 的 - 3 次方加 2 的 - 2 次方加 2 的 - 1 次方为 0.875 也即 0 到 0.875。使用定点数储存数据储存的范围不大，故一般不采用此方法储存小数。</li>\n<li>浮点数，采用科学计数法储存小数，小数点不固定，一般使用 ieee754 标准。浮点数分为 float（单精度），double（双精度）。将小数转化为二进制然后用科学计数法表示，只不过与十进制的科学计数法不同，二进制下为基数为 2 而不是 10。对于 float，用四字节，32 位储存，第一位为储存数字的正负，后面 8 位储存阶码也即指数部分，指数加上偏移量 127 再转二进制即为阶码。剩下 23 位储存小数部分，因为整数一定为 1 故不额外花一位储存整数部分。double 用八字节，64 位储存。第一位储存数字正负，后面 11 位储存阶码，double 的偏移量为 1023. 剩下的储存小数部分。</li>\n</ol>\n<p>储存模式分为大端法以及小端法。</p>\n<ol>\n<li>小端法：数据低位储存低位地址</li>\n<li>大端法：与小端法反过来</li>\n</ol>\n<p>储存和读取一般使用小端发</p>\n<p>相关资料：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3ZpZGVvL0JWMUxlNHkxMzdnVQ==\">定点数，浮点数。b 站视频</span></p>\n<p><a href=\"[什么是定点数？ - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/338588296)\">定点数，知乎文章</a></p>\n<p><a href=\"[什么是定点数？ - 知乎 (zhihu.com)](https://zhuanlan.zhihu.com/p/338588296)\">浮点数，知乎文章，阶码部分有点问题</a></p>\n<h3 id=\"四-fileblobarraybufferbuffer\"><a class=\"markdownIt-Anchor\" href=\"#四-fileblobarraybufferbuffer\">#</a> 四、File，Blob，ArrayBuffer，Buffer</h3>\n<p>Blob: 全称 binary large object。首先 blob 是一个对象，其次 blob 储存了不可以更改的二进制数据。</p>\n<p>File: file 对象是一个特殊的 blob，或者说 blob 是 file 原型链上的原型对象。file 相对于 blob 多了两个属性一个是文件名字，一个是文件最近一次被修改的时间戳。另外 file 对象只在浏览器中有，在 nodejs 中是没有的。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">File.prototype.__proto__==Blob.prototype //true</span><br></pre></td></tr></table></figure>\n<p>ArrayBuffer：是原始的二进制数据缓冲区，与 blob 一样储存了二进制数据，与 blob 不同的是 ArrayBuffer 不能设置 MIME 类型。虽然 ArrayBuffer 与 blob 都无法更改数据，但是 ArrayB 可以使用 TypedArray 对象和 DataView 对象对二进制数据进行更改。</p>\n<p>Buffer：nodejs 中处理二进制数据的对象，与 ArrayBuffer 可以互相转化。</p>\n<h4 id=\"1数据的获取\"><a class=\"markdownIt-Anchor\" href=\"#1数据的获取\">#</a> 1. 数据的获取</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/*</span><br><span class=\"line\">\tfile对象的获取</span><br><span class=\"line\">*/</span><br><span class=\"line\">let file = new File([&#x27;123&#x27;],&#x27;123.txt&#x27;) //第一个参数可以是blob，第二个参数为文件名。</span><br><span class=\"line\"></span><br><span class=\"line\">//使用input标签获取file</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;input type=&quot;file&quot; id=&quot;input&quot;&gt; //将type设置成file即可</span><br><span class=\"line\">let input = document.querySelector(&#x27;#input&#x27;)</span><br><span class=\"line\">input.onchange=(e)=&gt;&#123; //input上onchange方法，当用户上传了文件就会调用这个事件</span><br><span class=\"line\">    console.log(e.target.files) //这是一个数组储存用户上传的所有文件。</span><br><span class=\"line\">    console.log(e.target.files[0].__proto__==File.prototype) //true，数据类型为file</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//拖拽获取file</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;div id=&quot;drag&quot;&gt;&lt;/div&gt;</span><br><span class=\"line\">let drag = document.querySelector(&#x27;#drag&#x27;)</span><br><span class=\"line\">drag.ondragover=(e)=&gt;&#123;</span><br><span class=\"line\">    e.preventDefault() //阻止事件默认行为</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">drag.ondrop=(e)=&gt;&#123;</span><br><span class=\"line\">    e.preventDefault() </span><br><span class=\"line\">    console.log(e.dataTransfer.files)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//使用File System Access获取file</span><br><span class=\"line\"></span><br><span class=\"line\">drag.addEventListener(&#x27;click&#x27;,async()=&gt;&#123;</span><br><span class=\"line\">\tlet filelist = await showOpenFilePicker() //会返回一个数组，储存着用户上传的文件</span><br><span class=\"line\">\tlet file = await filelist[0].getFile() //会返回一个file对象。</span><br><span class=\"line\">\tfile.__proto__ == File.prototype // true,说明这个是file对象。</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">/*</span><br><span class=\"line\">\tBlob对象的获取</span><br><span class=\"line\">*/</span><br><span class=\"line\"></span><br><span class=\"line\">let blob = new Blob(array,options) </span><br><span class=\"line\">array:由ArrayBuffer，ArrayBufferView，Blob，Dom等对象构成</span><br><span class=\"line\">options：type：MIME类型</span><br><span class=\"line\"></span><br><span class=\"line\">/*</span><br><span class=\"line\">\tBuffer的获取</span><br><span class=\"line\">*/</span><br><span class=\"line\">在nodejs中使用fs模块读取文件。</span><br><span class=\"line\">fs.readFile(filename,(err,data)=&gt;&#123;</span><br><span class=\"line\">\tconsole.log(data) //此时的data是一个Buffer对象</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">buffer.tostring(&#x27;utf-8&#x27;) //buffer转成字符串</span><br><span class=\"line\"></span><br><span class=\"line\">由ArrayBuffer转化而来。</span><br><span class=\"line\">let buffer = Buffer.from(ArrayBuffer)</span><br><span class=\"line\">/*</span><br><span class=\"line\">\tArrayBuffer的获取</span><br><span class=\"line\">*/</span><br><span class=\"line\">ArrayBuffer一般是由file，blob或者Buffer转化的。</span><br><span class=\"line\"></span><br><span class=\"line\">let read = new FileReader()</span><br><span class=\"line\">read.readAsArrayBuffer(blob) //这里的参数可以传blob以及file，同时这是异步，可以调用read的onload事件，读取完成后就可以获取。</span><br><span class=\"line\">read.onload = ((res)=&gt;&#123;</span><br><span class=\"line\">\tconsole.log(res) //res为ArrayBuffer</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">由Buffer转化</span><br><span class=\"line\">let ArrayBuffer = Buffer.from(Buffer).buffer</span><br></pre></td></tr></table></figure>\n<h4 id=\"2转化为url或者base64\"><a class=\"markdownIt-Anchor\" href=\"#2转化为url或者base64\">#</a> 2. 转化为 url 或者 base64</h4>\n<p>对于图片或者视频如果要展示出来需要在 img 标签或者 video 标签上的 src 放上 url 链接或者 base64. 如果想要下载可以在 a 链接上添加 download 属性即可下载。</p>\n<p>FileReader.readAsDataURL: 异步方法，通过 FileReader.onload 的事件获取值，值为一段 data:base64 字符串</p>\n<p>URL.createObjectURL: 同步方法，获取到的是储存在内存中的 url。不用的话需手动释放防止内存泄露，获取速度要比 FileReader.readAsDataURL 要快.</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let read = new FileReader() </span><br><span class=\"line\">read.readAsDataURL(blob) //可以传入blob或者file对象</span><br><span class=\"line\">read.onload=((e)=&gt;&#123;</span><br><span class=\"line\">\tconsole.log(e.target.result) // 一段data:64字符串,可以在img以及video的src上挂载。</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">let url = URL.createObjectURL(blob) </span><br></pre></td></tr></table></figure>\n<h4 id=\"3-blob和arraybuffer的切片处理\"><a class=\"markdownIt-Anchor\" href=\"#3-blob和arraybuffer的切片处理\">#</a> 3. Blob 和 ArrayBuffer 的切片处理</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">用法与字符串和数组的slice一致，第三个参数为MIME类型设置，如果没有则使用原blob的MIME类型</span><br><span class=\"line\">let newblob = oldblob.slice(start,end,type) </span><br><span class=\"line\">let newArrayBuffer = oldArrayBuffer，slice(start,end) </span><br></pre></td></tr></table></figure>\n<p>相关资料</p>\n<p><a href=\"[谈谈JS二进制：File、Blob、FileReader、ArrayBuffer、Base64 - 掘金 (juejin.cn)](https://juejin.cn/post/7148254347401363463?searchId=20231109095758F3BF67CFE83D9F338CBE#heading-28)\">谈谈 JS 二进制：File、Blob、FileReader、ArrayBuffer、Base64 (稀土掘金)</a></p>\n<p><a href=\"[JS 的二进制家族：base64、File、Blob、ArrayBuffer 的关系 - 掘金 (juejin.cn)](https://juejin.cn/post/6844904069165744135?from=search-suggest#heading-6)\">JS 的二进制家族：base64、File、Blob、ArrayBuffer 的关系 (稀土掘金)</a></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC83MjAzNzAxODc1NTMwMDM5MzU3\">File System Access API 让浏览器拥有操作本地文件的能力 (稀土掘金)</span></p>\n<p><a href=\"[【Web基础】Blob Url & Data Url_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1Kv4y1471j/?spm_id_from=333.788&vd_source=f327cfd668e6eff40b7b8fec27ccf6df)\">【Web 基础】Blob Url &amp; Data Url</a></p>\n<h3 id=\"五-arraybuffertypedarraydataview\"><a class=\"markdownIt-Anchor\" href=\"#五-arraybuffertypedarraydataview\">#</a> 五、ArrayBuffer，TypedArray，DataView</h3>\n<p>ArrayBuffer 是二进制数据，如果想要读取或者修改还需要 TypedArray 和 DataView 的视图。视图可以理解为以何种方式读取。比如如果 ArrayBuffer 有四字节的数据，可以一字节一字节（8 位）的读取，也可以二字节二字节（16）的读取，这取决于数据是以何种方式储存。如果这个 ArrayBuffer 储存的是图片数据，众所周知图片每个像素由 rgba 构成，每一个数据的大小在 0-255 之间，所以这时候要用 uint8Array，无符号 8 位一字节读取。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let arraybuffer = new ArrayBuffer(8) //创建一个8字节的数据，数据默认是0</span><br><span class=\"line\">let uint8 = new Uint8Array(arraybuffer) //以uint8的方式读取</span><br><span class=\"line\">//ArrayBuffer有8字节，因为是以8int方式读取所以这里有8个数据，因为是无符号，所以取值范围为0-255</span><br><span class=\"line\">uint8[0] = 1 //修改第一个为1</span><br><span class=\"line\">console.log(uint8)//[1, 0, 0, 0, 0, 0, 0, 0]</span><br><span class=\"line\">//设值大于范围，转成二进制只取后8位。256的二进制是1 0000 0000，这里只取后八位。0000 0000即0</span><br><span class=\"line\">uint8[0] = 256</span><br><span class=\"line\">console.log(uint8)//[0, 0, 0, 0, 0, 0, 0, 0]</span><br><span class=\"line\">//如果是负数的话，取该负数的补码。因为是无符号所以负数的补码直接把所有位取反就行，补码是反码加一。</span><br><span class=\"line\">uint8[0] = -1 // -1反码1111 1110，补码1111 1111即255</span><br><span class=\"line\"></span><br><span class=\"line\">set方法 可以复制一段数据</span><br><span class=\"line\">let arraybuffer = new ArrayBuffer(8)</span><br><span class=\"line\">let uint8 = new Uint8Array(arraybuffer)</span><br><span class=\"line\">let uint = new Uint8Array(4)</span><br><span class=\"line\">uint[0] = 1</span><br><span class=\"line\">uint8.set(uint) //不带第二个参数，默认从第一个开始复制</span><br><span class=\"line\">console.log(uint8) //[1, 0, 0, 0, 0, 0, 0, 0]</span><br><span class=\"line\">uint8.set(uint,4) //从第五个数据开始复制</span><br><span class=\"line\">console.log(uint8) //[0, 0, 0, 0, 1, 0, 0, 0]</span><br><span class=\"line\"></span><br><span class=\"line\">如果后端发来一段一段ArrayBuffer将其合并</span><br><span class=\"line\">function (buffers)&#123;</span><br><span class=\"line\">\tlet totalLength = 0</span><br><span class=\"line\">\tfor(let buffer of buffers)&#123;</span><br><span class=\"line\">\t\ttotalLength += buffer.length</span><br><span class=\"line\">\t&#125; //获取总共ArrayBuffer的长度</span><br><span class=\"line\">\t//创建一个ArrayBuffer长度的ArrayBuffer，注意如果没有这么多连续的内存空间，创建会失败。</span><br><span class=\"line\">\tlet uint = new uint8Array(totalLength) </span><br><span class=\"line\">\tlet offset = 0 //记录每段内容的下标</span><br><span class=\"line\">\tfor(let buffer of buffers)&#123;</span><br><span class=\"line\">\t\tuint,set(buffer,offset)</span><br><span class=\"line\">\t\toffset+= buffer.length</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"1-typedarray\"><a class=\"markdownIt-Anchor\" href=\"#1-typedarray\">#</a> 1. TypedArray</h4>\n<p>​\tTypedArray 由以下九种类型组成。TypedArray 的特点在于每个数据的类型相同，适合处理一些简单的二进制数据，比如图片的 rgba 数据是由 8 位无符号整数组成。</p>\n<ul>\n<li><strong> <code>Int8Array</code> </strong>：8 位有符号整数，长度 1 个字节。</li>\n<li><strong> <code>Uint8Array</code> </strong>：8 位无符号整数，长度 1 个字节。</li>\n<li><strong> <code>Uint8ClampedArray</code> </strong>：8 位无符号整数，长度 1 个字节，溢出处理不同。</li>\n<li><strong> <code>Int16Array</code> </strong>：16 位有符号整数，长度 2 个字节。</li>\n<li><strong> <code>Uint16Array</code> </strong>：16 位无符号整数，长度 2 个字节。</li>\n<li><strong> <code>Int32Array</code> </strong>：32 位有符号整数，长度 4 个字节。</li>\n<li><strong> <code>Uint32Array</code> </strong>：32 位无符号整数，长度 4 个字节。</li>\n<li><strong> <code>Float32Array</code> </strong>：32 位浮点数，长度 4 个字节。</li>\n<li><strong> <code>Float64Array</code> </strong>：64 位浮点数，长度 8 个字节。</li>\n</ul>\n",
            "tags": [
                "音视频开发",
                "二进制"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/10/04/algorithm/%E5%A0%86%20%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/",
            "url": "https://seele-exzzz.github.io/2023/10/04/algorithm/%E5%A0%86%20%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/",
            "title": "堆 优先队列",
            "date_published": "2023-10-04T13:14:39.498Z",
            "content_html": "<h3 id=\"堆\"><a class=\"markdownIt-Anchor\" href=\"#堆\">#</a> 堆</h3>\n<p>堆分为大顶堆（大根堆）和小顶堆（小根堆）两种。对于一个堆首先是一颗完全二叉树即只有最后一层不为空且最后一层从左往右是连续的不为空。其次如果是大顶堆，根元素是最大值，子节点比父节点都要小，小顶堆则相反</p>\n<h4 id=\"1-上浮\"><a class=\"markdownIt-Anchor\" href=\"#1-上浮\">#</a> 1. 上浮</h4>\n<p>​\t每次插入元素时，都往堆最后一个的地方插入元素，为了维护堆的性质则需对插入的元素进行上浮操作。如果是大顶堆的话，插入的元素如果比父节点大就要与父节点交换值。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//大顶堆</span><br><span class=\"line\">function up (index)&#123;</span><br><span class=\"line\">    let father = Math.floor((index-1)/2) //获取父节点的下标</span><br><span class=\"line\">    // 如果是大顶堆的话，当父节点的值小于当前节点的值时就要交换节点。二叉树用数组arr储存。</span><br><span class=\"line\">    while(father&gt;=0&amp;&amp;arr[father]&lt;arr[index])&#123;</span><br><span class=\"line\">    \t[arr[index],arr[father]] = [arr[father],arr[index]] //交换子节点的值和父节点的值。</span><br><span class=\"line\">        index = father </span><br><span class=\"line\">        father = Math.floor((index-1)/2)</span><br><span class=\"line\">    &#125; </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"2下沉\"><a class=\"markdownIt-Anchor\" href=\"#2下沉\">#</a> 2. 下沉</h4>\n<p>​\t当根节点弹出的时候，则需要将最后一个元素放在根节点中，为了维护堆的性质则需要对根节点进行下沉操作。如果是大顶堆的话，插入的元素如果比父节点大就要与父节点交换值。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//大顶堆</span><br><span class=\"line\">function down(index)&#123; </span><br><span class=\"line\">\tif(!arr[index*2+1]) return //如果不存在左子树的话就不下沉了</span><br><span class=\"line\">\t//如果右子树不存在的话就选左子树否则比较左子树以及右子树的大小谁大选谁</span><br><span class=\"line\">\tlet son = arr[index*2+2]?arr[index*2+1]&gt;arr[index*2+2]?index*2+1:index*2+1:index*2+1 </span><br><span class=\"line\">\twhile(son&lt;arr.length&amp;&amp;arr[index]&lt;arr[son])&#123;</span><br><span class=\"line\">\t\t[arr[index],arr[son]] = [arr[son],arr[index]]</span><br><span class=\"line\">\t\tindex = son</span><br><span class=\"line\">\t\tson = arr[index*2+2]?arr[index*2+1]&gt;arr[index*2+2]?index*2+1:index*2+1:index*2+1 </span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"3-插入元素\"><a class=\"markdownIt-Anchor\" href=\"#3-插入元素\">#</a> 3. 插入元素</h4>\n<p>每次往堆插入元素时在最后的地方插入并进行上浮的操作。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function push (val)&#123;</span><br><span class=\"line\">\tarr.push(val)</span><br><span class=\"line\">\tup(arr.length-1)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"4-弹出元素\"><a class=\"markdownIt-Anchor\" href=\"#4-弹出元素\">#</a> 4. 弹出元素</h4>\n<p>每次从堆中弹出根元素然后将最后一个元素放在根元素上进行下浮操作。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function pop ()&#123;</span><br><span class=\"line\">\tlet val = arr[0]</span><br><span class=\"line\">\tarr[0] = arr.pop()</span><br><span class=\"line\">\tdown(0)</span><br><span class=\"line\">\treturn val</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"5-创建一个堆类\"><a class=\"markdownIt-Anchor\" href=\"#5-创建一个堆类\">#</a> 5. 创建一个堆类</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Quque&#123;</span><br><span class=\"line\">    constructor(quque=[],compare=(a,b)=&gt;a-b)&#123;</span><br><span class=\"line\">        this.compare = (a,b)=&gt;compare(this.arr[a],this.arr[b]) //比较函数如果没传的话默认构建大顶堆</span><br><span class=\"line\">        this.quque = quque //用于一开始接受一个数组然后用build将这个数组构建成堆</span><br><span class=\"line\">        this.arr = []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    // 如果一开始传入了一个数组就将其构建成一个堆</span><br><span class=\"line\">    build()&#123; </span><br><span class=\"line\">        this.quque.forEach((a)=&gt;this.push(a))</span><br><span class=\"line\">        this.quque = []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    up(index)&#123;</span><br><span class=\"line\">        let father = Math.floor((index-1)/2)</span><br><span class=\"line\">        while(father&gt;=0&amp;&amp;this.compare(index,father)&gt;0)&#123;</span><br><span class=\"line\">            [this.arr[father],this.arr[index]] = [this.arr[index],this.arr[father]]</span><br><span class=\"line\">            index = father</span><br><span class=\"line\">            father = Math.floor((index-1)/2)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    down(index)&#123;</span><br><span class=\"line\">        let son = this.arr[index*2+2]?this.arr[index*2+1]&lt;this.arr[index*2+2]?index*2+2:index*2+1:index*2+1</span><br><span class=\"line\">        while(this.compare(index,son)&lt;0)&#123;</span><br><span class=\"line\">            [this.arr[index],this.arr[son]] = [this.arr[son],this.arr[index]]</span><br><span class=\"line\">            index = son</span><br><span class=\"line\">            son = this.arr[index*2+2]?this.arr[index*2+1]&lt;this.arr[index*2+2]?index*2+2:index*2+1:index*2+1</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    push(val)&#123;</span><br><span class=\"line\">        this.arr.push(val)</span><br><span class=\"line\">        this.up(this.arr.length-1) </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    pop()&#123;</span><br><span class=\"line\">        let val = this.arr[0]</span><br><span class=\"line\">        this.arr[0] = this.arr.pop()</span><br><span class=\"line\">        this.down(0)</span><br><span class=\"line\">        return val</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"优先队列\"><a class=\"markdownIt-Anchor\" href=\"#优先队列\">#</a> 优先队列</h3>\n<p>​\t优先队列顾名思义就是一个队列，队列里面的元素有优先级比如每次弹出的都是最大值或者最小值。优先队列可以用堆进行实现。</p>\n<h4 id=\"1a-href347-前-k-个高频元素-力扣leetcodehttpsleetcodecnproblemstop-k-frequent-elements前k个高频元素a\"><a class=\"markdownIt-Anchor\" href=\"#1a-href347-前-k-个高频元素-力扣leetcodehttpsleetcodecnproblemstop-k-frequent-elements前k个高频元素a\">#</a> 1.<a href=\"[347. 前 K 个高频元素 - 力扣（LeetCode）](https://leetcode.cn/problems/top-k-frequent-elements/)\">前 k 个高频元素</a></h4>\n<p>​\t因为要获取前 k 个高频元素，所以这里使用小顶堆。当堆的元素的个数超过了 k 就将最小元素即根元素弹出，因此当遍历一遍后就留下了最大的 k 个元素。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class root &#123;</span><br><span class=\"line\">    constructor()&#123;</span><br><span class=\"line\">        this.arr = []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    up(index)&#123;</span><br><span class=\"line\">        let fatherIndex = Math.floor((index-1)/2)</span><br><span class=\"line\">        while(fatherIndex&gt;=0&amp;&amp;this.arr[index][1]&lt;this.arr[fatherIndex][1])&#123;</span><br><span class=\"line\">            [this.arr[index],this.arr[fatherIndex]] = [this.arr[fatherIndex],this.arr[index]]</span><br><span class=\"line\">            index = fatherIndex</span><br><span class=\"line\">            fatherIndex = Math.floor((index-1)/2)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    down(index)&#123;</span><br><span class=\"line\">        if(!this.arr[index*2+1]) return</span><br><span class=\"line\">        let sonindex = this.arr[index*2+2]?this.arr[index*2+1][1]&gt;this.arr[index*2+2][1]?index*2+2:index*2+1:this.arr[index*2+1][1] </span><br><span class=\"line\">        while(sonindex&lt;this.arr.length&amp;&amp;this.arr[index][1]&gt;this.arr[sonindex][1])&#123;</span><br><span class=\"line\">            [this.arr[index],this.arr[sonindex]] = [this.arr[sonindex],this.arr[index]]</span><br><span class=\"line\">            index = sonindex</span><br><span class=\"line\">            if(!this.arr[index*2+1]) return</span><br><span class=\"line\">            sonindex = this.arr[index*2+2]?this.arr[index*2+1][1]&gt;this.arr[index*2+2][1]?\t\tindex*2+2:index*2+1:this.arr[index*2+1][1]         </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    push(list)&#123;</span><br><span class=\"line\">        this.arr.push(list)</span><br><span class=\"line\">        this.up(this.arr.length-1)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    pop()&#123;</span><br><span class=\"line\">        this.arr[0] = this.arr.pop()</span><br><span class=\"line\">        this.down(0)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    size()&#123;</span><br><span class=\"line\">        return this.arr.length</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">var topKFrequent = function(nums, k) &#123;</span><br><span class=\"line\">    let map = new Map()</span><br><span class=\"line\">    let quque = new root()</span><br><span class=\"line\">    for(let num of nums)&#123;</span><br><span class=\"line\">        map.set(num,(map.get(num)||0)+1)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    for(let array of map.entries())&#123;</span><br><span class=\"line\">        quque.push(array)</span><br><span class=\"line\">        if(quque.size()&gt;k)&#123;</span><br><span class=\"line\">            quque.pop()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return quque.arr.map((a)=&gt;a[0])</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h4 id=\"2-a-href2208-将数组和减半的最少操作次数-力扣leetcodehttpsleetcodecnproblemsminimum-operations-to-halve-array-sum将数组和减半的最少操作次数a\"><a class=\"markdownIt-Anchor\" href=\"#2-a-href2208-将数组和减半的最少操作次数-力扣leetcodehttpsleetcodecnproblemsminimum-operations-to-halve-array-sum将数组和减半的最少操作次数a\">#</a> 2. <a href=\"[2208. 将数组和减半的最少操作次数 - 力扣（LeetCode）](https://leetcode.cn/problems/minimum-operations-to-halve-array-sum/)\">将数组和减半的最少操作次数</a></h4>\n<p>​\t将数组放进大顶堆中，每次将根元素减半，减半后看看根元素是否比子元素小，如果小的话就下沉直到数组和小于数组的一半。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">class Quque&#123;</span><br><span class=\"line\">    constructor(quque=[],compare=(a,b)=&gt;a-b)&#123;</span><br><span class=\"line\">        this.compare = (a,b)=&gt;compare(this.arr[a],this.arr[b])</span><br><span class=\"line\">        this.quque = quque</span><br><span class=\"line\">        this.arr = []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    build()&#123;</span><br><span class=\"line\">        this.quque.forEach((a)=&gt;this.push(a))</span><br><span class=\"line\">        this.quque = []</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    up(index)&#123;</span><br><span class=\"line\">        let father = Math.floor((index-1)/2)</span><br><span class=\"line\">        while(father&gt;=0&amp;&amp;this.compare(index,father)&gt;0)&#123;</span><br><span class=\"line\">            [this.arr[father],this.arr[index]] = [this.arr[index],this.arr[father]]</span><br><span class=\"line\">            index = father</span><br><span class=\"line\">            father = Math.floor((index-1)/2)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    down(index)&#123;</span><br><span class=\"line\">        let sonindex = this.arr[index*2+2]?this.arr[index*2+1]&lt;this.arr[index*2+2]?index*2+2:index*2+1:index*2+1</span><br><span class=\"line\">        while(this.compare(index,sonindex)&lt;0)&#123;</span><br><span class=\"line\">            [this.arr[index],this.arr[sonindex]] = [this.arr[sonindex],this.arr[index]]</span><br><span class=\"line\">            index = sonindex</span><br><span class=\"line\">            sonindex = this.arr[index*2+2]?this.arr[index*2+1]&lt;this.arr[index*2+2]?index*2+2:index*2+1:index*2+1</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    push(val)&#123;</span><br><span class=\"line\">        this.arr.push(val)</span><br><span class=\"line\">        this.up(this.arr.length-1) </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    pop()&#123;</span><br><span class=\"line\">        let val = this.arr[0]/2</span><br><span class=\"line\">        this.arr[0] = val</span><br><span class=\"line\">        this.down(0)</span><br><span class=\"line\">        return val</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">var halveArray = function(nums) &#123;</span><br><span class=\"line\">    let sum = 0,quque = new Quque(nums),res =0</span><br><span class=\"line\">    quque.build()</span><br><span class=\"line\">    nums.forEach((a)=&gt;&#123;</span><br><span class=\"line\">        sum+=a   </span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    let target = sum/2</span><br><span class=\"line\">    while(sum&gt;target)&#123;</span><br><span class=\"line\">        let value = quque.pop()</span><br><span class=\"line\">        sum -= value</span><br><span class=\"line\">        res++</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return res</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "算法",
                "算法",
                "堆",
                "优先队列"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/09/11/project/ProjectFunction/",
            "url": "https://seele-exzzz.github.io/2023/09/11/project/ProjectFunction/",
            "title": "项目功能介绍",
            "date_published": "2023-09-11T07:06:23.365Z",
            "content_html": "<h2 id=\"截图\"><a class=\"markdownIt-Anchor\" href=\"#截图\">#</a> 截图</h2>\n<h3 id=\"1-画笔橡皮擦文字复制到剪切板的功能展示\"><a class=\"markdownIt-Anchor\" href=\"#1-画笔橡皮擦文字复制到剪切板的功能展示\">#</a> 1. 画笔，橡皮擦，文字，复制到剪切板的功能展示。</h3>\n<p>​\t画笔：可以使用下面的按钮以及输入框改变画笔的大小并在截图区域绘制。</p>\n<p>​    橡皮擦：清除用画笔绘制的内容同时可以使用下面的按钮以及输入框改变橡皮擦的大小</p>\n<p>​\t文字：在截图框输入文字。</p>\n<p>​\t复制：点击√即可复制到剪切板。</p>\n<p><img data-src=\"https://typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com/img/qiuzhao/projectezgif.com-video-to-gif.gif\" alt=\"\"></p>\n<h3 id=\"2-退出撤回保存的功能展示\"><a class=\"markdownIt-Anchor\" href=\"#2-退出撤回保存的功能展示\">#</a> 2. 退出，撤回，保存的功能展示。</h3>\n<p>​\t\t退出：右键可以退出截图同时截图框可以拖动，截图内容以拖动后的截图框为主。</p>\n<p>​\t\t撤回：当进入编辑截图时，点击撤回即可清除绘制以及文本等等内容。</p>\n<p>​\t\t保存：保存按钮将图片保存。</p>\n<p><img data-src=\"https://typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com/img/qiuzhao/projectezgif.com-video-to-gif%20(1).gif\" alt=\"\"></p>\n<h2 id=\"便利贴\"><a class=\"markdownIt-Anchor\" href=\"#便利贴\">#</a> 便利贴</h2>\n<h3 id=\"1创建清除便利贴的功能展示\"><a class=\"markdownIt-Anchor\" href=\"#1创建清除便利贴的功能展示\">#</a> 1. 创建，清除便利贴的功能展示。</h3>\n<p>​\t 可以创建便利贴并在便利贴记录事情。便利贴可以创建多个，且可以移动。当事情完成后就可以清除。当软件启动时，未清除的便利贴还会显示。</p>\n<p><img data-src=\"https://typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com/img/qiuzhao/projectezgif.com-video-to-gif%20(2).gif\" alt=\"\"></p>\n<h3 id=\"软件地址\"><a class=\"markdownIt-Anchor\" href=\"#软件地址\">#</a> 软件地址：</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9wYW4uYmFpZHUuY29tL3MvMU1va1oxc1c4LXJENlRrdHhyancwQkE/cHdkPTEyMzQ=\">百度网盘</span></p>\n<p><a href=\"[Release 修复了图标,便利贴清除等相关bug · SEELE-EXZzz/desktool (github.com)](https://github.com/SEELE-EXZzz/desktool/releases/tag/1.1.0)\">GitHub</a></p>\n",
            "tags": []
        },
        {
            "id": "https://seele-exzzz.github.io/2023/08/12/project/%E7%94%A8electron%E5%AE%9E%E7%8E%B0%E6%88%AA%E5%9B%BE%E5%8A%9F%E8%83%BD/",
            "url": "https://seele-exzzz.github.io/2023/08/12/project/%E7%94%A8electron%E5%AE%9E%E7%8E%B0%E6%88%AA%E5%9B%BE%E5%8A%9F%E8%83%BD/",
            "title": "electron截图功能",
            "date_published": "2023-08-12T10:29:32.591Z",
            "content_html": "<h2 id=\"前言\"><a class=\"markdownIt-Anchor\" href=\"#前言\">#</a> 前言</h2>\n<p>想要实现截图功能，需要设置一个全屏隐藏菜单栏且透明的窗口，在窗口上放上屏幕的截图，然后监听鼠标，获取两次鼠标点击的位置，根据这个位置将图片用 canvas.drawImage 方法将图片写入 canvas 标签。然后再做保存或者写入剪切板的操作。</p>\n<h2 id=\"一-基本功能\"><a class=\"markdownIt-Anchor\" href=\"#一-基本功能\">#</a> 一、基本功能</h2>\n<h3 id=\"一-进程间通信\"><a class=\"markdownIt-Anchor\" href=\"#一-进程间通信\">#</a> 一、进程间通信</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//渲染进程</span><br><span class=\"line\">&lt;el-button type=&quot;primary&quot; @click=&quot;screenHot&quot;&gt;截图&lt;/el-button&gt; //设置一个按钮。</span><br><span class=\"line\">screenHot()&#123;</span><br><span class=\"line\">    ipcRenderer.send(&#x27;screenHot&#x27;)</span><br><span class=\"line\">&#125;//向主进程发送消息。</span><br><span class=\"line\"></span><br><span class=\"line\">//主进程</span><br><span class=\"line\">let fullScreen</span><br><span class=\"line\">ipcMain.on(&#x27;screenHot&#x27;,async()=&gt;&#123;</span><br><span class=\"line\">\twin.hide()//主窗口隐藏</span><br><span class=\"line\">    //创建一个全屏且隐藏菜单栏的窗口。</span><br><span class=\"line\">    fullScreen= new BrowserWindow(&#123;</span><br><span class=\"line\">        autoHideMenuBar: true, // 自动隐藏菜单栏</span><br><span class=\"line\">        useContentSize: true, // width 和 height 将设置为 web 页面的尺寸</span><br><span class=\"line\">        movable: false, // 是否可移动</span><br><span class=\"line\">        frame: false, // 无边框窗口</span><br><span class=\"line\">        resizable: false, // 窗口大小是否可调整</span><br><span class=\"line\">        hasShadow: false, // 窗口是否有阴影</span><br><span class=\"line\">        transparent: true, // 使窗口透明</span><br><span class=\"line\">        fullscreenable: true, // 窗口是否可以进入全屏状态</span><br><span class=\"line\">        fullscreen: true, // 窗口是否全屏</span><br><span class=\"line\">        simpleFullscreen: true, // 在 macOS 上使用 pre-Lion 全屏</span><br><span class=\"line\">        alwaysOnTop: false, // 窗口是否永远在别的窗口的上面</span><br><span class=\"line\">      webPreferences: &#123;</span><br><span class=\"line\">        nodeIntegration: process.env.ELECTRON_NODE_INTEGRATION,</span><br><span class=\"line\">        contextIsolation: !process.env.ELECTRON_NODE_INTEGRATION</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    if (process.env.WEBPACK_DEV_SERVER_URL) &#123;</span><br><span class=\"line\">      await fullScreen.loadURL(process.env.WEBPACK_DEV_SERVER_URL+&#x27;screenHot.html&#x27;)</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">      createProtocol(&#x27;app&#x27;)</span><br><span class=\"line\">      fullScreen.loadURL(&#x27;app://./screenHot.html&#x27;)//加载页面</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">ipcMain.on(&#x27;getFullScreen&#x27;,async() =&gt; &#123;</span><br><span class=\"line\">  //获取屏幕大小,以及缩放因子scaleFactor。</span><br><span class=\"line\">  const &#123; size, scaleFactor &#125; = screen.getPrimaryDisplay()</span><br><span class=\"line\">  const sources = await desktopCapturer.getSources(&#123;</span><br><span class=\"line\">    types:[&#x27;screen&#x27;],</span><br><span class=\"line\">    thumbnailSize: &#123;</span><br><span class=\"line\">      width:size.width*scaleFactor,</span><br><span class=\"line\">      height:size.height*scaleFactor</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;)</span><br><span class=\"line\">  // 向渲染进程发送屏幕截图</span><br><span class=\"line\">  fullScreen.webContents.send(&#x27;sendFullScreen&#x27;, sources[0],size)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"二-渲染进程获取桌面截图\"><a class=\"markdownIt-Anchor\" href=\"#二-渲染进程获取桌面截图\">#</a> 二、渲染进程获取桌面截图</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div&gt;</span><br><span class=\"line\">  &lt;img&gt;</span><br><span class=\"line\">  &lt;canvas&gt;&lt;/canvas&gt;</span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\">mounted()&#123;</span><br><span class=\"line\">        let img = document.querySelector(&#x27;img&#x27;) </span><br><span class=\"line\">        ipcRenderer.send(&#x27;getFullScreen&#x27;)</span><br><span class=\"line\">        ipcRenderer.on(&#x27;sendFullScreen&#x27;, (event, message) =&gt; &#123;</span><br><span class=\"line\">            img.src = message.thumbnail.toDataURL()   </span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">       &#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"三-监听鼠标获取坐标\"><a class=\"markdownIt-Anchor\" href=\"#三-监听鼠标获取坐标\">#</a> 三、监听鼠标获取坐标</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">methods:&#123;</span><br><span class=\"line\">    //获取第一次鼠标按下时的坐标</span><br><span class=\"line\">    getStartPostion(e)&#123;</span><br><span class=\"line\">        this.startX = e.clientX</span><br><span class=\"line\">        this.startY = e.clientY</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    //获取移动时的坐标</span><br><span class=\"line\">    getlastPostion(e)&#123;</span><br><span class=\"line\">        this.endX = e.clientX</span><br><span class=\"line\">        this.endY = e.clientY</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    //删除mousemove的监听事件</span><br><span class=\"line\">    getfinallyPostion()&#123;</span><br><span class=\"line\">        document.removeEventListener(&#x27;mousemove&#x27;,this.getlastPostion)</span><br><span class=\"line\">    &#125;\t\t</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">mounted()&#123;</span><br><span class=\"line\">    document.addEventListener(&#x27;mousedown&#x27;,this.getStartPostion)</span><br><span class=\"line\">    document.addEventListener(&#x27;mousemove&#x27;,this.getlastPostion)</span><br><span class=\"line\">    document.addEventListener(&#x27;mouseup&#x27;,this.getfinallyPostion)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"四-根据坐标生成一个矩形的截图区域\"><a class=\"markdownIt-Anchor\" href=\"#四-根据坐标生成一个矩形的截图区域\">#</a> 四、根据坐标生成一个矩形的截图区域</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div v-show=&quot;isShowCutScreen&quot; :style=&quot;&#123;</span><br><span class=\"line\">    position: &#x27;absolute&#x27;,</span><br><span class=\"line\">    left: startX + &#x27;px&#x27;,</span><br><span class=\"line\">    top: startY + &#x27;px&#x27;,</span><br><span class=\"line\">    width: (endX - startX) + &#x27;px&#x27;,</span><br><span class=\"line\">    height: (endY - startY) + &#x27;px&#x27;,</span><br><span class=\"line\">    border: &#x27;2px solid black&#x27;,</span><br><span class=\"line\">  &#125;&quot;&gt; </span><br><span class=\"line\">&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">data()&#123;</span><br><span class=\"line\">\treturn&#123;</span><br><span class=\"line\">        isShowCutScreen:false,</span><br><span class=\"line\">        startX:0, </span><br><span class=\"line\">        startY:0,</span><br><span class=\"line\">        endX:0,</span><br><span class=\"line\">        endY:0,</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">//鼠标第一个点击时，截图区域展示出来</span><br><span class=\"line\">getStartPostion(e)&#123;</span><br><span class=\"line\">    if(!this.isShowCutScreen)&#123;</span><br><span class=\"line\">      this.isShowCutScreen = true  </span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">      return</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    this.startX = e.clientX</span><br><span class=\"line\">    this.startY = e.clientY</span><br><span class=\"line\">&#125;,</span><br><span class=\"line\">//截图区域展示后再获取鼠标移动时的坐标</span><br><span class=\"line\">getlastPostion(e)&#123;</span><br><span class=\"line\">    if(!this.isShowCutScreen) return</span><br><span class=\"line\">    this.endX = e.clientX</span><br><span class=\"line\">    this.endY = e.clientY</span><br><span class=\"line\">&#125;,</span><br></pre></td></tr></table></figure>\n<h3 id=\"五-将截图写入canvas同时复制至剪切板\"><a class=\"markdownIt-Anchor\" href=\"#五-将截图写入canvas同时复制至剪切板\">#</a> 五、将截图写入 canvas 同时复制至剪切板</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;button v-show=&quot;isShowSetting&quot; @click=&quot;copyToclipboard&quot;&gt;复制并关闭&lt;/button&gt;</span><br><span class=\"line\">copyToclipboard()&#123;</span><br><span class=\"line\">\t/*获取物理像素与CSS像素之比，有些设备这个比值会大于一，如果不乘这个值就会出现，截图位置和大小有偏差。相当于将截图区域的图片放大这个系数放在没有放大的canvas中，截图范围变小。*/</span><br><span class=\"line\">    const devicePixelRatio = window.devicePixelRatio</span><br><span class=\"line\">    let canvas = document.querySelector(&#x27;canvas&#x27;)</span><br><span class=\"line\">    let ctx=canvas.getContext(&quot;2d&quot;)</span><br><span class=\"line\">    let img=document.querySelector(&#x27;img&#x27;)</span><br><span class=\"line\">    let startX = this.startX*devicePixelRatio</span><br><span class=\"line\">    let startY = this.startY*devicePixelRatio</span><br><span class=\"line\">    let endX = this.endX*devicePixelRatio</span><br><span class=\"line\">    let endY = this.endY*devicePixelRatio</span><br><span class=\"line\">    let width = endX-startX</span><br><span class=\"line\">    let height = endY-startY</span><br><span class=\"line\">    canvas.width = width</span><br><span class=\"line\">    canvas.height = height</span><br><span class=\"line\">    ctx.drawImage(img,startX,startY,width,height,0,0,width,height)</span><br><span class=\"line\">    //将canvas变成blob对象，然后使用clipboard复制到剪切板中</span><br><span class=\"line\">    canvas.toBlob((blob)=&gt;&#123;</span><br><span class=\"line\">        navigator.clipboard.write([new ClipboardItem(&#123; &#x27;image/png&#x27;: blob &#125;)]).then(()=&gt;&#123;</span><br><span class=\"line\">            ipcRenderer.send(&#x27;closeFullScreen&#x27;)</span><br><span class=\"line\">        &#125;).catch((err)=&gt;console.log(err))</span><br><span class=\"line\">    &#125;)          </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"\"><a class=\"markdownIt-Anchor\" href=\"#\">#</a> </h2>\n<ol>\n<li><a href=\"[基于electron、vite 和 react，我做了一个截图桌面软件 - 掘金 (juejin.cn)](https://juejin.cn/post/7239514481755127845?searchId=202308102041027394C7E481B4D632E215)\">在 electron 中实现截图</a></li>\n<li><a href=\"[用Vite+Electron搞个微信截图工具（区域截屏工具） - 掘金 (juejin.cn)](https://juejin.cn/post/7111115472182968327?searchId=20230810204054CAEE239023ED2A291BEA)\">在 electron 中实现截图</a></li>\n<li><a href=\"[剪贴板操作 Clipboard API 教程 - 阮一峰的网络日志 (ruanyifeng.com)](https://www.ruanyifeng.com/blog/2021/01/clipboard-api.html)\">剪切板使用</a></li>\n<li></li>\n</ol>\n",
            "tags": [
                "项目",
                "vue",
                "electron",
                "element-ui",
                "项目"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/08/09/algorithm/acm%E6%A8%A1%E5%BC%8F/",
            "url": "https://seele-exzzz.github.io/2023/08/09/algorithm/acm%E6%A8%A1%E5%BC%8F/",
            "title": "acm模式",
            "date_published": "2023-08-09T10:23:41.906Z",
            "content_html": "<h2 id=\"acm模式\"><a class=\"markdownIt-Anchor\" href=\"#acm模式\">#</a> acm 模式</h2>\n<p>众所周知，企业机试是要使用 acm 模式的即自行处理输入输出，而不是力扣上的那种核心代码模式。所以之后了解了一下 JavaScript 获取输入输出的方式。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">/*</span><br><span class=\"line\">\tjavaScript Node模式</span><br><span class=\"line\">*/</span><br><span class=\"line\">const readline = require(&#x27;readline&#x27;)</span><br><span class=\"line\"></span><br><span class=\"line\">const rl = readline.createInterface(&#123;</span><br><span class=\"line\">\tinput:process.stdin,</span><br><span class=\"line\">\toutput:process.stdout</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">rl.on(&#x27;line&#x27;,(input)=&gt;&#123;</span><br><span class=\"line\">\t//处理输入的每行数据，这里就是之前力扣上要写的代码。</span><br><span class=\"line\">\t//input就是输入数据。另外有时input并不是处理的数据而是条件所以在处理数据的时候还需要判断一下。</span><br><span class=\"line\">\tconsole.log()//在力扣return是输出数据，而acm模式则是通过console.log打印输出数据</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\">// 与力扣相比就多了以上这些代码。</span><br></pre></td></tr></table></figure>\n<h2 id=\"处理输入\"><a class=\"markdownIt-Anchor\" href=\"#处理输入\">#</a> 处理输入</h2>\n<h3 id=\"1-输入的类型转化\"><a class=\"markdownIt-Anchor\" href=\"#1-输入的类型转化\">#</a> 1. 输入的类型转化</h3>\n<p>在获取到数据后，需要分辨那些是需要用的，那些是用不着的。同时还需对数据作类型转化。因为拿到的数据大概率是字符串，需要将字符串转化为需要的数据类型比如数组，数字。可以使用正则判断，到底是数组字符串还是数字字符串。</p>\n<h4 id=\"1-字符串转数字\"><a class=\"markdownIt-Anchor\" href=\"#1-字符串转数字\">#</a> 1. 字符串转数字</h4>\n<p>​\t首先如果一行只有数字的话，可以匹配非数字以及空格，如果匹配成功就说明这一行除数字，换行等其他数据类型。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let reg = /[^0-9\\s]/g</span><br><span class=\"line\">//input为输入数据，如果成功匹配则说明有除了数字空格等其他数据类型</span><br><span class=\"line\">if(!reg.test(input))&#123;</span><br><span class=\"line\">\ttodo //如果只想要某行数据是只有数字的话</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"2字符串转数组\"><a class=\"markdownIt-Anchor\" href=\"#2字符串转数组\">#</a> 2. 字符串转数组</h4>\n<p>因为数组有 [] 可以匹配这个，另外也可以使用字符串的 indexOf 方法获取 [] 的下标，用 slice () 截取字符串数组中数组的部分，然后使用 split (‘’) 转成数组</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let arr = input.slice(input.indexOf(&#x27;[&#x27;),input.indexOf(&#x27;]&#x27;)+1).spilt(&#x27;&#x27;)</span><br></pre></td></tr></table></figure>\n<h3 id=\"2输入的数据构造二叉树或者链表\"><a class=\"markdownIt-Anchor\" href=\"#2输入的数据构造二叉树或者链表\">#</a> 2. 输入的数据构造二叉树或者链表</h3>\n",
            "tags": [
                "算法",
                "算法"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/08/03/project/electron-%E4%BB%8E%E9%9B%B6%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AAelectron%E9%A1%B9%E7%9B%AE/",
            "url": "https://seele-exzzz.github.io/2023/08/03/project/electron-%E4%BB%8E%E9%9B%B6%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AAelectron%E9%A1%B9%E7%9B%AE/",
            "title": "electron配置",
            "date_published": "2023-08-03T07:04:45.388Z",
            "content_html": "<h1 id=\"electron-从零搭建一个electron项目\"><a class=\"markdownIt-Anchor\" href=\"#electron-从零搭建一个electron项目\">#</a> electron - 从零搭建一个 electron 项目</h1>\n<h2 id=\"前言\"><a class=\"markdownIt-Anchor\" href=\"#前言\">#</a> 前言</h2>\n<p>要想将 vue 引入 electron 中有两种方式，分别为 electron-vue 和 Vue CLI Plugin Electron Builder. 前者虽然出的早，但很久不维护了。因此这边使用后者即 Vue CLI Plugin Electron Builder。首先需要用 vue 的脚手架生成 vue 项目，然后在引入 electron 插件。</p>\n<h2 id=\"创建electron项目\"><a class=\"markdownIt-Anchor\" href=\"#创建electron项目\">#</a> 创建 electron 项目</h2>\n<h3 id=\"1-创建vue项目\"><a class=\"markdownIt-Anchor\" href=\"#1-创建vue项目\">#</a> 1、创建 vue 项目</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm i @vue/cli -g //全局安装vue cli脚手架</span><br><span class=\"line\">vue create &lt;name&gt; //脚手架创建vue项目，前面和创建vue项目一模一样</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-添加electron插件\"><a class=\"markdownIt-Anchor\" href=\"#2-添加electron插件\">#</a> 2、添加 electron 插件</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vue add electron-builder </span><br><span class=\"line\">cnpm i electron --S //这里用npm的话大概率下载不了，因为electron有一部分代码在GitHub中，要么改镜像要么直接用cnpm</span><br></pre></td></tr></table></figure>\n<p>这时一个 electron 项目就出来了。</p>\n<h2 id=\"配置\"><a class=\"markdownIt-Anchor\" href=\"#配置\">#</a> 配置</h2>\n<p>如果用最新的 vue-cli 的话，这时 webpack 应该在 5 以上，5 以上的 webpack 不再自动引入 polyfill 了，原因是引入这个会让最后的打包体积变得很大，webpack 不建议开发者在浏览器端使用 polyfill。现在要么不用 node，要么手动引入 polyfill。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm install --save path-browserify crypto-browserify//安装path-browserify和crypto-browserify</span><br><span class=\"line\"></span><br><span class=\"line\">//在vue.config.js中加入如下配置。</span><br><span class=\"line\">module.exports = defineConfig(&#123;</span><br><span class=\"line\">  transpileDependencies: true,</span><br><span class=\"line\">  configureWebpack: &#123;</span><br><span class=\"line\">    resolve: &#123;</span><br><span class=\"line\">      fallback: &#123;</span><br><span class=\"line\">        &quot;fs&quot;: false,</span><br><span class=\"line\">        &quot;path&quot;: require.resolve(&quot;path-browserify&quot;),</span><br><span class=\"line\">        &quot;crypto&quot;: require.resolve(&quot;crypto-browserify&quot;)</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure>\n<p>之后会出现’__dirname is not defined’这个错误。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在上面的基础上加如下的配置即可。</span><br><span class=\"line\">pluginOptions:&#123;</span><br><span class=\"line\">   electronBuilder:&#123;</span><br><span class=\"line\">     nodeIntegration:true</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "项目",
                "vue",
                "electron",
                "element-ui",
                "项目"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/08/02/algorithm/%E9%93%BE%E8%A1%A8%E8%BF%9B%E9%98%B6-%E8%AE%BA%E9%80%92%E5%BD%92%E5%9C%A8%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8/",
            "url": "https://seele-exzzz.github.io/2023/08/02/algorithm/%E9%93%BE%E8%A1%A8%E8%BF%9B%E9%98%B6-%E8%AE%BA%E9%80%92%E5%BD%92%E5%9C%A8%E9%93%BE%E8%A1%A8%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8/",
            "title": "链表进阶",
            "date_published": "2023-08-02T13:31:36.133Z",
            "content_html": "<h1 id=\"链表进阶-论递归在链表中的作用\"><a class=\"markdownIt-Anchor\" href=\"#链表进阶-论递归在链表中的作用\">#</a> 链表进阶 - 论递归在链表中的作用</h1>\n<h2 id=\"前言\"><a class=\"markdownIt-Anchor\" href=\"#前言\">#</a> 前言</h2>\n<p>初次接触链表的时候，一方面在改变指针的时候容易出现问题导致链表出现环，当然之后只要涉及改变指针就靠画图理顺指针改变顺序解决了这个问题，另一方面链表与数组不一样的点在于链表无法回退，这时递归登场了，因为递归有回溯的过程，所以只要将链表的下一项当作参数，那么在回溯的时候自然就会进行回退。使用递归能很轻松地解决蛮多链表的问题。以下是一些用递归解决链表的类型题目。</p>\n<h2 id=\"一-反转链表\"><a class=\"markdownIt-Anchor\" href=\"#一-反转链表\">#</a> 一 、反转链表</h2>\n<p>这类型题目主要是需要在外面设置一个变量储存链表，然后将链表的下一项当作递归的参数，当到达要交换的最后一个节点时就要 return，然后在回溯的部分交换，外面的链表记得在交换后往前走，里面的链表在返回上一层函数的时候会自动回退，这就起到了前后两边交换节点。同时反转链表有两种情况，一种是反转相邻的节点，另一种是反转的节点隔一个节点。</p>\n<h3 id=\"a-href剑指-offer-ii-024-反转链表-力扣leetcodehttpsleetcodecnproblemsuhnkqh剑指-offer-ii-024-反转链表a\"><a class=\"markdownIt-Anchor\" href=\"#a-href剑指-offer-ii-024-反转链表-力扣leetcodehttpsleetcodecnproblemsuhnkqh剑指-offer-ii-024-反转链表a\">#</a> <a href=\"[剑指 Offer II 024. 反转链表 - 力扣（LeetCode）](https://leetcode.cn/problems/UHnkqh/)\">剑指 Offer II 024. 反转链表</a></h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var reverseList = function(head) &#123;</span><br><span class=\"line\">    if(!head||!head.next) return head //如果链表为空或者只有一项return原链表就行</span><br><span class=\"line\">    /*</span><br><span class=\"line\">    \t这里用到了虚拟头节点，因为第一个头节点也要交换如果设置虚拟头节点方便交换头节点，另外也需要在外面设置一个变量一个正向移动，另一个在回溯中逆向移动两个交换节点就能实现链表反转。</span><br><span class=\"line\">    */</span><br><span class=\"line\">    let cur = new ListNode(0,head),node = cur</span><br><span class=\"line\">    const dfs=(list)=&gt;&#123;</span><br><span class=\"line\">    \t//因为最后一个节点要交换，交换节点需要到前一个节点，所以这里到最后一个节点就return这样回溯部分就从倒二个节点开始回退</span><br><span class=\"line\">        if(!list.next) return</span><br><span class=\"line\">        //一旦交换成功就return true，一旦return的结果是true就立马return true防止继续进行回溯部分。导致已经交换过的节点继续交换。</span><br><span class=\"line\">        if(dfs(list.next)) return true </span><br><span class=\"line\">        //最后一次交换有两种情况，一种就是这个，交换节点挨着。</span><br><span class=\"line\">        if(cur.next==list)&#123;</span><br><span class=\"line\">            let temp = cur.next</span><br><span class=\"line\">            cur.next = cur.next.next</span><br><span class=\"line\">            temp.next = cur.next.next</span><br><span class=\"line\">            cur.next.next = temp</span><br><span class=\"line\">            return true</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        //大部分交换时，交换的节点都隔着节点</span><br><span class=\"line\">        let temp1 = cur.next,temp2=list.next</span><br><span class=\"line\">        cur.next = cur.next.next</span><br><span class=\"line\">        list.next = list.next.next</span><br><span class=\"line\">        temp2.next = cur.next</span><br><span class=\"line\">        cur.next = temp2</span><br><span class=\"line\">        temp1.next = list.next</span><br><span class=\"line\">        list.next = temp1</span><br><span class=\"line\">        cur = temp2</span><br><span class=\"line\">        //如果要交换的节点之间隔着一个节点，交换后cur的下个节点就是list这时该赶紧return。</span><br><span class=\"line\">        if(cur.next==list) return true</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    dfs(node)</span><br><span class=\"line\">    return node.next //最后return记得不要带上自己设置的虚拟头节点。</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"a-href92-反转链表-ii-力扣leetcodehttpsleetcodecnproblemsreverse-linked-list-ii-92-反转链表-iia\"><a class=\"markdownIt-Anchor\" href=\"#a-href92-反转链表-ii-力扣leetcodehttpsleetcodecnproblemsreverse-linked-list-ii-92-反转链表-iia\">#</a> <a href=\"[92. 反转链表 II - 力扣（LeetCode）](https://leetcode.cn/problems/reverse-linked-list-ii/)\"> 92. 反转链表 II</a></h3>\n<p>这题与上面一题差别在于，不是整个链表反转。因此在在用递归反转链表时，需用 while 循环到达需要反转的链表节点前面，同时递归函数增加一个参数用于判断是否到达了最后一个需要反转的节点。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var reverseBetween = function(head, left, right) &#123;</span><br><span class=\"line\">    if(!head.next||left==right) return head </span><br><span class=\"line\">    let node = new ListNode(0,head) //这里同样需要设置虚拟头节点，因为有可能left为1，头节点需要反转。</span><br><span class=\"line\">    let l=node,r=node</span><br><span class=\"line\">    //用while循环让l和r达到需要交换的第一个节点前。</span><br><span class=\"line\">    while(left&gt;1)&#123;</span><br><span class=\"line\">       l=l.next</span><br><span class=\"line\">       r=r.next</span><br><span class=\"line\">       left --</span><br><span class=\"line\">       right --</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    //下面代码与上题一致，无非就是多了参数，判断条件有变，交换部分的代码一致。</span><br><span class=\"line\">    const dfs =(r,right)=&gt;&#123;</span><br><span class=\"line\">        if(right==0) return</span><br><span class=\"line\">        if(dfs(r.next,right-1)) return true</span><br><span class=\"line\">        if(l.next==r)&#123;</span><br><span class=\"line\">            l.next = l.next.next</span><br><span class=\"line\">            r.next = l.next.next</span><br><span class=\"line\">            l.next.next = r</span><br><span class=\"line\">            return true</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        let temp1=l.next,temp2=r.next</span><br><span class=\"line\">        l.next = l.next.next</span><br><span class=\"line\">        r.next = r.next.next</span><br><span class=\"line\">        temp1.next = r.next</span><br><span class=\"line\">        r.next = temp1</span><br><span class=\"line\">        temp2.next = l.next</span><br><span class=\"line\">        l.next = temp2 </span><br><span class=\"line\">        l = temp2</span><br><span class=\"line\">        if(l==r||l.next==r) return true</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    dfs(r,right)</span><br><span class=\"line\">    return node.next</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"a-href2074-反转偶数长度组的节点-力扣leetcodehttpsleetcodecnproblemsreverse-nodes-in-even-length-groups2074-反转偶数长度组的节点a\"><a class=\"markdownIt-Anchor\" href=\"#a-href2074-反转偶数长度组的节点-力扣leetcodehttpsleetcodecnproblemsreverse-nodes-in-even-length-groups2074-反转偶数长度组的节点a\">#</a> <a href=\"[2074. 反转偶数长度组的节点 - 力扣（LeetCode）](https://leetcode.cn/problems/reverse-nodes-in-even-length-groups/)\">2074. 反转偶数长度组的节点</a></h3>\n<p>这题相比于上一题在于不只反转一次。反转的代码依旧可以用上面代码不过判断条件复杂一些。另外最后一组的链表长度如果小于倒数第二组的长度，这时如果长度为偶数则还要反转，而不是最后一组是偶数组才要反转，一开始还理解错误题目来着。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var reverseEvenLengthGroups = function(head) &#123;</span><br><span class=\"line\">    if(!head||!head.next||!head.next.next) return head</span><br><span class=\"line\">    let cur = head,outside = head,inside = head,index = 2</span><br><span class=\"line\">    const dfs =(list,num,k)=&gt;&#123;</span><br><span class=\"line\">    /*</span><br><span class=\"line\">    \t判断条件相比之前的题有亿点多，一共有四种情况。分为两大类一类是没走完，另一类是走到末尾了。反转链表的代码还是一样。</span><br><span class=\"line\">    \t没走完的情况：</span><br><span class=\"line\">    \t1.这时list不为空，num为0。如果当前所在组是奇数，k%2为1 这时不该反转链表，也是不执行回溯部分代码，需return一个值，这里我return-1，下面接收值，如果是-1就立即return-1</span><br><span class=\"line\">    \t2.如果当前所在组是偶数，k%2为0 这时该反转链表，这里return不return值都行。反正要执行下面回溯部分的反转链表的代码。</span><br><span class=\"line\">    \t走完的情况：</span><br><span class=\"line\">    \t3.如果剩余链表数为偶数的话，k-num%2为0，这时要执行回溯部分的代码反转链表，记得这时需到最后一个链表后再return，因为最后一个要反转，所以反转时需到倒数第二个链表的位置。所以这里的判断条件是!list.next而且这个条件需在!list之下不然会出现list为空所以没有list.next的错误。</span><br><span class=\"line\">    \t4. 如果剩余链表数为奇数的话，这时list为空，同样return一个值，下面用一个变量接住后，加个判断条件return出去，防止执行回溯部分的代码。</span><br><span class=\"line\">    */</span><br><span class=\"line\">        if(!list) return false</span><br><span class=\"line\">        if(!list.next&amp;&amp;(k-num)%2==0) return</span><br><span class=\"line\">        if(num==0&amp;&amp;k%2==0) return</span><br><span class=\"line\">        if(num==0) return -1</span><br><span class=\"line\">        let res = dfs(list.next,num-1,k)</span><br><span class=\"line\">        if(res==true)&#123;</span><br><span class=\"line\">            return true</span><br><span class=\"line\">        &#125;else if(res ==false)&#123;</span><br><span class=\"line\">            return false</span><br><span class=\"line\">        &#125;else if(res==-1)&#123;</span><br><span class=\"line\">            return -1</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        if(outside.next==list)&#123;</span><br><span class=\"line\">            let temp = list</span><br><span class=\"line\">            outside.next = outside.next.next</span><br><span class=\"line\">            temp.next = outside.next.next</span><br><span class=\"line\">            outside.next.next = temp</span><br><span class=\"line\">            return true</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        let temp2 = list.next,temp1 = outside.next</span><br><span class=\"line\">        list.next = list.next.next</span><br><span class=\"line\">        outside.next = outside.next.next</span><br><span class=\"line\">        temp2.next = outside.next</span><br><span class=\"line\">        outside.next = temp2</span><br><span class=\"line\">        temp1.next = list.next</span><br><span class=\"line\">        list.next = temp1</span><br><span class=\"line\">        outside = temp2</span><br><span class=\"line\">        if(outside.next == list) return true</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    while(cur)&#123;</span><br><span class=\"line\">        if(dfs(inside,index,index)===false) return cur </span><br><span class=\"line\">        //注意递归运行完后这里的outside会发生变化，需将inside赋值给outside</span><br><span class=\"line\">        outside = inside  </span><br><span class=\"line\">        let k = index</span><br><span class=\"line\">        while(k&gt;0)&#123;</span><br><span class=\"line\">            if(!inside||!outside) return cur</span><br><span class=\"line\">            inside = inside.next</span><br><span class=\"line\">            outside = outside.next</span><br><span class=\"line\">            k--</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        if(!inside||!outside) return cur</span><br><span class=\"line\">        index++</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return cur</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"a-href25-k-个一组翻转链表-力扣leetcodehttpsleetcodecnproblemsreverse-nodes-in-k-group-25-k-个一组翻转链表a\"><a class=\"markdownIt-Anchor\" href=\"#a-href25-k-个一组翻转链表-力扣leetcodehttpsleetcodecnproblemsreverse-nodes-in-k-group-25-k-个一组翻转链表a\">#</a> <a href=\"[25. K 个一组翻转链表 - 力扣（LeetCode）](https://leetcode.cn/problems/reverse-nodes-in-k-group/)\"> 25. K 个一组翻转链表</a></h3>\n<p>​\t\t这题和上面一样也需要多次反转，我看评论区发现，字节似乎很喜欢考这题，不过老实说这题感觉难度和上面差不多甚至比上题可以还略微简单结果这题是困难上题是一般。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var reverseKGroup = function(head, k) &#123;</span><br><span class=\"line\">    if(k==1) return head</span><br><span class=\"line\">    let node = new ListNode(0,head),l=node,r=node</span><br><span class=\"line\">    const dfs=(r,num)=&gt;&#123;</span><br><span class=\"line\">    //判断条件有两个一个是剩余链表不足k个这时num大于1，r为空，无需反转。另一个是num为0需反转。</span><br><span class=\"line\">        if(!r) return false</span><br><span class=\"line\">        if(num==0) return</span><br><span class=\"line\">        let res = dfs(r.next,num-1)</span><br><span class=\"line\">        if(res==false)&#123;</span><br><span class=\"line\">            return false</span><br><span class=\"line\">        &#125;else if(res==true)&#123;</span><br><span class=\"line\">            return true</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        if(l.next==r)&#123;</span><br><span class=\"line\">            l.next = l.next.next</span><br><span class=\"line\">            r.next = r.next.next</span><br><span class=\"line\">            l.next.next = r</span><br><span class=\"line\">            r = l</span><br><span class=\"line\">            return true</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        let temp1 = l.next,temp2=r.next</span><br><span class=\"line\">        l.next=l.next.next</span><br><span class=\"line\">        r.next=r.next.next</span><br><span class=\"line\">        temp2.next = l.next</span><br><span class=\"line\">        l.next = temp2</span><br><span class=\"line\">        temp1.next = r.next</span><br><span class=\"line\">        r.next = temp1</span><br><span class=\"line\">        l = temp2</span><br><span class=\"line\">        if(l==r||l.next==r) return true</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    while(r)&#123;</span><br><span class=\"line\">        dfs(r,k)</span><br><span class=\"line\">        //和上面一样递归反转后l的链表会改变，这时需将r赋给l。</span><br><span class=\"line\">        l = r</span><br><span class=\"line\">        let number = k</span><br><span class=\"line\">        while(number&gt;0)&#123;</span><br><span class=\"line\">            if(!l) break</span><br><span class=\"line\">            l = l.next</span><br><span class=\"line\">            r = r.next</span><br><span class=\"line\">            number--</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return node.next</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"二-回文链表\"><a class=\"markdownIt-Anchor\" href=\"#二-回文链表\">#</a> 二、回文链表</h2>\n<h3 id=\"a-hreflcr-027-回文链表-力扣leetcodehttpsleetcodecnproblemsamhzsalcr-027-回文链表a\"><a class=\"markdownIt-Anchor\" href=\"#a-hreflcr-027-回文链表-力扣leetcodehttpsleetcodecnproblemsamhzsalcr-027-回文链表a\">#</a> <a href=\"[LCR 027. 回文链表 - 力扣（LeetCode）](https://leetcode.cn/problems/aMhZSa/)\">LCR 027. 回文链表</a></h3>\n<p>这个没什么好说的，记得外面的链表也要移动。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var isPalindrome = function(head) &#123;</span><br><span class=\"line\">    let cur = head</span><br><span class=\"line\">    if(!head||!head.next) return true</span><br><span class=\"line\">    const dfs=(list)=&gt;&#123;</span><br><span class=\"line\">        if(!list) return</span><br><span class=\"line\">        let res = dfs(list.next)</span><br><span class=\"line\">        if(res)&#123;</span><br><span class=\"line\">            return true</span><br><span class=\"line\">        &#125;else if(res==false)&#123;</span><br><span class=\"line\">            return false</span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">        if(list.val!=cur.val) return false</span><br><span class=\"line\">        if(cur.next==list||cur.next.next==list) return true</span><br><span class=\"line\">        //记得外面的链表也要往前移动。</span><br><span class=\"line\">        cur=cur.next</span><br><span class=\"line\">         </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    return dfs(cur)</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"三-删除链表中满足某个条件的值\"><a class=\"markdownIt-Anchor\" href=\"#三-删除链表中满足某个条件的值\">#</a> 三、删除链表中满足某个条件的值</h2>\n<h3 id=\"a-href83-删除排序链表中的重复元素-力扣leetcodehttpsleetcodecnproblemsremove-duplicates-from-sorted-list83-删除排序链表中的重复元素a\"><a class=\"markdownIt-Anchor\" href=\"#a-href83-删除排序链表中的重复元素-力扣leetcodehttpsleetcodecnproblemsremove-duplicates-from-sorted-list83-删除排序链表中的重复元素a\">#</a> <a href=\"[83. 删除排序链表中的重复元素 - 力扣（LeetCode）](https://leetcode.cn/problems/remove-duplicates-from-sorted-list/)\">83. 删除排序链表中的重复元素</a></h3>\n<p>递推部分用哈希表获取链表各个值极其个数，回溯部分再根据哈希表删除重复的元素即可。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let map = new Map(),cur = head</span><br><span class=\"line\">const dfs =(list)=&gt;&#123;</span><br><span class=\"line\">    // 当链表为空时再return而不是到链表倒数第一位再return，不然的话递推部分会记录倒数第一个值</span><br><span class=\"line\">    if(!list) return</span><br><span class=\"line\">    if(map.has(list.val))&#123;</span><br><span class=\"line\">        map.set(list.val,map.get(list.val)+1)</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        map.set(list.val,1)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    dfs(list.next)</span><br><span class=\"line\">    if(!list.next) return // 如果是倒数第一个就直接return到上一层也就是倒数第二个，倒数第一个位置删除不了节点。</span><br><span class=\"line\">    let num = map.get(list.next.val)-1</span><br><span class=\"line\">    map.set(list.next.val,num)</span><br><span class=\"line\">    if(num&gt;=1)&#123;</span><br><span class=\"line\">        list.next = list.next.next</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">dfs(cur)</span><br><span class=\"line\">return cur</span><br></pre></td></tr></table></figure>\n<h3 id=\"a-href82-删除排序链表中的重复元素-ii-力扣leetcodehttpsleetcodecnproblemsremove-duplicates-from-sorted-list-ii82-删除排序链表中的重复元素-iia\"><a class=\"markdownIt-Anchor\" href=\"#a-href82-删除排序链表中的重复元素-ii-力扣leetcodehttpsleetcodecnproblemsremove-duplicates-from-sorted-list-ii82-删除排序链表中的重复元素-iia\">#</a> <a href=\"[82. 删除排序链表中的重复元素 II - 力扣（LeetCode）](https://leetcode.cn/problems/remove-duplicates-from-sorted-list-ii/)\">82. 删除排序链表中的重复元素 II</a></h3>\n<p>和上题差不多不过这里头节点可能会删除所以可以整一个虚拟头节点。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var deleteDuplicates = function(head) &#123;</span><br><span class=\"line\">    let map = new Map(),cur = new ListNode(false,head)</span><br><span class=\"line\">    const dfs=(list)=&gt;&#123;</span><br><span class=\"line\">        if(!list)&#123;</span><br><span class=\"line\">            let key = map.keys()</span><br><span class=\"line\">            for(let i of key)&#123;</span><br><span class=\"line\">                if(map.get(i)==1) map.delete(i)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          return  </span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">        if(map.has(list.val))&#123;</span><br><span class=\"line\">            map.set(list.val,map.get(list.val)+1)</span><br><span class=\"line\">        &#125;else&#123;</span><br><span class=\"line\">            map.set(list.val,1)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        dfs(list.next)</span><br><span class=\"line\">        if(!list.next) return</span><br><span class=\"line\">        if(map.has(list.next.val)) list.next =list.next.next</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    dfs(cur)</span><br><span class=\"line\">    return cur.next</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"二-回文链表-2\"><a class=\"markdownIt-Anchor\" href=\"#二-回文链表-2\">#</a> 二、回文链表</h2>\n<h3 id=\"a-hreflcr-027-回文链表-力扣leetcodehttpsleetcodecnproblemsamhzsalcr-027-回文链表a-2\"><a class=\"markdownIt-Anchor\" href=\"#a-hreflcr-027-回文链表-力扣leetcodehttpsleetcodecnproblemsamhzsalcr-027-回文链表a-2\">#</a> <a href=\"[LCR 027. 回文链表 - 力扣（LeetCode）](https://leetcode.cn/problems/aMhZSa/)\">LCR 027. 回文链表</a></h3>\n<p>这个没什么好说的，记得外面的链表也要移动。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var isPalindrome = function(head) &#123;</span><br><span class=\"line\">    let cur = head</span><br><span class=\"line\">    if(!head||!head.next) return true</span><br><span class=\"line\">    const dfs=(list)=&gt;&#123;</span><br><span class=\"line\">        if(!list) return</span><br><span class=\"line\">        let res = dfs(list.next)</span><br><span class=\"line\">        if(res)&#123;</span><br><span class=\"line\">            return true</span><br><span class=\"line\">        &#125;else if(res==false)&#123;</span><br><span class=\"line\">            return false</span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">        if(list.val!=cur.val) return false</span><br><span class=\"line\">        if(cur.next==list||cur.next.next==list) return true</span><br><span class=\"line\">        //记得外面的链表也要往前移动。</span><br><span class=\"line\">        cur=cur.next</span><br><span class=\"line\">         </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">    return dfs(cur)</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"三-删除链表中满足某个条件的值-2\"><a class=\"markdownIt-Anchor\" href=\"#三-删除链表中满足某个条件的值-2\">#</a> 三、删除链表中满足某个条件的值</h2>\n<h3 id=\"a-href83-删除排序链表中的重复元素-力扣leetcodehttpsleetcodecnproblemsremove-duplicates-from-sorted-list83-删除排序链表中的重复元素a-2\"><a class=\"markdownIt-Anchor\" href=\"#a-href83-删除排序链表中的重复元素-力扣leetcodehttpsleetcodecnproblemsremove-duplicates-from-sorted-list83-删除排序链表中的重复元素a-2\">#</a> <a href=\"[83. 删除排序链表中的重复元素 - 力扣（LeetCode）](https://leetcode.cn/problems/remove-duplicates-from-sorted-list/)\">83. 删除排序链表中的重复元素</a></h3>\n<p>递推部分用哈希表获取链表各个值极其个数，回溯部分再根据哈希表删除重复的元素即可。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let map = new Map(),cur = head</span><br><span class=\"line\">const dfs =(list)=&gt;&#123;</span><br><span class=\"line\">    // 当链表为空时再return而不是到链表倒数第一位再return，不然的话递推部分会记录倒数第一个值</span><br><span class=\"line\">    if(!list) return</span><br><span class=\"line\">    if(map.has(list.val))&#123;</span><br><span class=\"line\">        map.set(list.val,map.get(list.val)+1)</span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        map.set(list.val,1)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    dfs(list.next)</span><br><span class=\"line\">    if(!list.next) return // 如果是倒数第一个就直接return到上一层也就是倒数第二个，倒数第一个位置删除不了节点。</span><br><span class=\"line\">    let num = map.get(list.next.val)-1</span><br><span class=\"line\">    map.set(list.next.val,num)</span><br><span class=\"line\">    if(num&gt;=1)&#123;</span><br><span class=\"line\">        list.next = list.next.next</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">dfs(cur)</span><br><span class=\"line\">return cur</span><br></pre></td></tr></table></figure>\n<h3 id=\"a-href82-删除排序链表中的重复元素-ii-力扣leetcodehttpsleetcodecnproblemsremove-duplicates-from-sorted-list-ii82-删除排序链表中的重复元素-iia-2\"><a class=\"markdownIt-Anchor\" href=\"#a-href82-删除排序链表中的重复元素-ii-力扣leetcodehttpsleetcodecnproblemsremove-duplicates-from-sorted-list-ii82-删除排序链表中的重复元素-iia-2\">#</a> <a href=\"[82. 删除排序链表中的重复元素 II - 力扣（LeetCode）](https://leetcode.cn/problems/remove-duplicates-from-sorted-list-ii/)\">82. 删除排序链表中的重复元素 II</a></h3>\n<p>和上题差不多不过这里头节点可能会删除所以可以整一个虚拟头节点。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var deleteDuplicates = function(head) &#123;</span><br><span class=\"line\">    let map = new Map(),cur = new ListNode(false,head)</span><br><span class=\"line\">    const dfs=(list)=&gt;&#123;</span><br><span class=\"line\">        if(!list)&#123;</span><br><span class=\"line\">            let key = map.keys()</span><br><span class=\"line\">            for(let i of key)&#123;</span><br><span class=\"line\">                if(map.get(i)==1) map.delete(i)</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          return  </span><br><span class=\"line\">        &#125; </span><br><span class=\"line\">        if(map.has(list.val))&#123;</span><br><span class=\"line\">            map.set(list.val,map.get(list.val)+1)</span><br><span class=\"line\">        &#125;else&#123;</span><br><span class=\"line\">            map.set(list.val,1)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        dfs(list.next)</span><br><span class=\"line\">        if(!list.next) return</span><br><span class=\"line\">        if(map.has(list.next.val)) list.next =list.next.next</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    dfs(cur)</span><br><span class=\"line\">    return cur.next</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"a-href1171-从链表中删去总和值为零的连续节点-力扣leetcodehttpsleetcodecnproblemsremove-zero-sum-consecutive-nodes-from-linked-list1171-从链表中删去总和值为零的连续节点a\"><a class=\"markdownIt-Anchor\" href=\"#a-href1171-从链表中删去总和值为零的连续节点-力扣leetcodehttpsleetcodecnproblemsremove-zero-sum-consecutive-nodes-from-linked-list1171-从链表中删去总和值为零的连续节点a\">#</a> <a href=\"[1171. 从链表中删去总和值为零的连续节点 - 力扣（LeetCode）](https://leetcode.cn/problems/remove-zero-sum-consecutive-nodes-from-linked-list/)\">1171. 从链表中删去总和值为零的连续节点</a></h3>\n<p>前缀和 + 链表。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">var removeZeroSumSublists = function(head) &#123;</span><br><span class=\"line\">    let arr = [],cur = new ListNode(0,head),index = -1</span><br><span class=\"line\">    const dfs =(list,num)=&gt;&#123;</span><br><span class=\"line\">        if(!list) return  </span><br><span class=\"line\">        if(arr.length!=0)&#123;</span><br><span class=\"line\">            arr.push(arr[num-1]+list.val)</span><br><span class=\"line\">        &#125;else&#123;</span><br><span class=\"line\">            arr.push(list.val)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        dfs(list.next,num+1)</span><br><span class=\"line\">        let k = arr.indexOf(arr[num+1])</span><br><span class=\"line\">        if(k!=num+1&amp;&amp;index==-1) index = k</span><br><span class=\"line\">        if(index!=-1) list.next = list.next.next</span><br><span class=\"line\">        if(index==num) index = -1     </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    dfs(cur,0)</span><br><span class=\"line\">    return cur.next</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "算法",
                "算法",
                "链表",
                "递归"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/07/27/Learning-record/JavaScript%E4%B8%AD%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/",
            "url": "https://seele-exzzz.github.io/2023/07/27/Learning-record/JavaScript%E4%B8%AD%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/",
            "title": "JavaScript常用方法",
            "date_published": "2023-07-27T08:18:19.808Z",
            "content_html": "<p>[toc]</p>\n<h1 id=\"javascript中常用方法\"><a class=\"markdownIt-Anchor\" href=\"#javascript中常用方法\">#</a> JavaScript 中常用方法</h1>\n<h2 id=\"一-数组\"><a class=\"markdownIt-Anchor\" href=\"#一-数组\">#</a> 一、数组</h2>\n<h3 id=\"1截取数组\"><a class=\"markdownIt-Anchor\" href=\"#1截取数组\">#</a> 1. 截取数组</h3>\n<ol>\n<li>\n<p>slice：获取数组某一区间的元素并形成新的数组将其返回，不改变原数组.</p>\n</li>\n<li>\n<p>splice：删除数组元素同时可以插入元素，会改变原数组.</p>\n<p>slice 方法接收两个参数都为下标，区间为左闭右开。如果省略第一个参数则从第一个元素开始获取如果省略第二个参数则会一直获取到最后一个值。这两个参数都可以是负数。当参数为负数时，最后一个值的下标为 - 1 并以此往前依次减 1. 如果未获取到元素则返回空数组</p>\n<p>splice 方法接收三个参数，第一个参数是要删除值的下标不可省略另外这个参数同样也可以是负数，第二个参数的删除值的个数如果为 0 则不会删除元素，如果省略则一直删到结尾，第三个参数为插入的元素，元素不只是数字或者字符串，数组，函数或者对象都可以传入。</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let a = [1,2,3,4,5,6,7,8,9]</span><br><span class=\"line\">let b = [&#x27;a&#x27;,&#x27;b&#x27;]</span><br><span class=\"line\"></span><br><span class=\"line\">//获取下标0到2不包括2的元素并返回形成新的数组</span><br><span class=\"line\">console.log(a.slice(0,2))//[ 1, 2 ]</span><br><span class=\"line\">//如果第一个参数没有的话，则从头开始，第二个参数没有的话则获取到结尾//[1, 2, 3, 4, 5,6, 7, 8, 9]</span><br><span class=\"line\">console.log(a.slice())</span><br><span class=\"line\">//获取倒数第三个到倒数第一个不包括倒数第一个元素//[ 7, 8 ]</span><br><span class=\"line\">console.log(a.slice(-3,-1))</span><br><span class=\"line\">let fun= ()=&gt;&#123;return 1&#125;</span><br><span class=\"line\">let obj =&#123;a,b&#125;</span><br><span class=\"line\">a.splice(2,4,obj,fun,...b)//从删除下标2以及之后的3的元素并在2后插入对象函数等元素</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"2查找数组中某一元素的位置\"><a class=\"markdownIt-Anchor\" href=\"#2查找数组中某一元素的位置\">#</a> 2. 查找数组中某一元素的位置</h3>\n<ol>\n<li>\n<p>indexOf： 获取某一元素在数组首次出现的下标。</p>\n</li>\n<li>\n<p>lastIndexOf： 获取某一元素在数组中最后一次出现的下标。</p>\n<p>这两个方法都接收两个参数，第一个参数是要找的值，第二个参数是从那一个下标开始包括此下标（indexOf 向后，lastIndexOf 向前）找，如果没有第二个参数就默认 indexO 从头开始找，lastIndexOf 从最后向前开始找。如果没有找到该元素则返回 - 1</p>\n</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let a =1</span><br><span class=\"line\">const b = [1,2,3,1,2,3,2,1,2,1]</span><br><span class=\"line\"></span><br><span class=\"line\">console.log(b.indexOf(a)) //0</span><br><span class=\"line\">console.log(b.lastIndexOf(a)) //9</span><br><span class=\"line\"></span><br><span class=\"line\">console.log(b.indexOf(a,1)) //3</span><br><span class=\"line\">console.log(b.lastIndexOf(a,8)) //7</span><br><span class=\"line\"></span><br><span class=\"line\">console.log(b.indexOf(a,b.indexOf(a)+1)) 获取第二个出现此元素下标</span><br><span class=\"line\">console.log(b.lastIndexOf(a,b.lastIndexOf(a)-1)) 获取倒数第二个出现此元素下标</span><br><span class=\"line\"></span><br><span class=\"line\">console.log(b.indexOf(4) //-1</span><br><span class=\"line\">console.log(b.lastIndexOf(4) //-1</span><br></pre></td></tr></table></figure>\n<h3 id=\"3查找数组中满足条件的元素或者下标\"><a class=\"markdownIt-Anchor\" href=\"#3查找数组中满足条件的元素或者下标\">#</a> 3. 查找数组中满足条件的元素或者下标</h3>\n<ol>\n<li>\n<p>find：获取数组中满足条件的元素</p>\n</li>\n<li>\n<p>findIndex：获取数组中满足条件的元素的下标</p>\n<p>这两个方法都接收一个函数做参数，函数有三个参数，第一个为数组的值，第二个为该值在数组中所在的下标，第三个为该数组。其中 find 返回元素，如果没有发现满足条件的元素则返回 undefined，如果有多个元素满足也只会返回第一个满足条件的元素。findIn 返回下标，如果没有发现满足条件的元素则返回 - 1，如果有多个元素满足也只会返回第一个满足条件的下标。</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let a = [1,2,3,4]</span><br><span class=\"line\">console.log(a.find((val)=&gt;val&gt;1)) //2</span><br><span class=\"line\">console.log(a.findIndex((val)=&gt;val&gt;1)) //1 </span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"4检查数组中的元素是否存在或者都满足某一条件\"><a class=\"markdownIt-Anchor\" href=\"#4检查数组中的元素是否存在或者都满足某一条件\">#</a> 4. 检查数组中的元素是否存在或者都满足某一条件</h3>\n<ol>\n<li>\n<p>every：检查数组中的元素是否都满足某一条件</p>\n</li>\n<li>\n<p>some：检查数组中的元素是否存在满足某一条件</p>\n<p>这两个方法都接收一个函数做参数，函数有三个参数，第一个为数组的值，第二个为该值在数组中所在的下标，第三个为该数组。返回值均为布尔值。</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let a = [1,2,3]</span><br><span class=\"line\">console.log(a.every((val)=&gt;val&gt;0)) //true</span><br><span class=\"line\">console.log(a.every((val)=&gt;val&gt;1)) //false</span><br><span class=\"line\">console.log(a.some((val)=&gt;val&gt;3)) //false</span><br><span class=\"line\">console.log(a.some((val)=&gt;val&gt;1)) //true</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"5将数组转化为字符串\"><a class=\"markdownIt-Anchor\" href=\"#5将数组转化为字符串\">#</a> 5. 将数组转化为字符串</h3>\n<ol>\n<li>\n<p>join：获取参数作为分割符，如果没有则默认用‘,’(逗号) 并返回字符串。</p>\n</li>\n<li>\n<p>toString： 将数组转化为字符串并用‘,’(逗号) 分割并返回字符串。</p>\n<p>这两个方法都不会改变原数组</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let a = [1,2,3]</span><br><span class=\"line\">console.log(a.toString())//1,2,3</span><br><span class=\"line\">console.log(a.join())//1,2,3</span><br><span class=\"line\">console.log(a.join(&#x27;&#x27;))//123</span><br><span class=\"line\">console.log(a.join(&#x27;-&#x27;))//1-2-3</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"6在数组开头或者结尾删除或者添加元素\"><a class=\"markdownIt-Anchor\" href=\"#6在数组开头或者结尾删除或者添加元素\">#</a> 6. 在数组开头或者结尾删除或者添加元素</h3>\n<ol>\n<li>push：向数组末尾添加一个或多个元素，并返回新的长度。</li>\n<li>pop：从数组末尾删除一个元素，并返回被删除的元素。</li>\n<li>shift：从数组开头删除一个元素，并返回被删除的元素。</li>\n<li>unshift：向数组开头添加一个或多个元素，并返回新的长度。</li>\n</ol>\n<h2 id=\"二-字符串\"><a class=\"markdownIt-Anchor\" href=\"#二-字符串\">#</a> 二、字符串</h2>\n<h3 id=\"1字符串转化为数组\"><a class=\"markdownIt-Anchor\" href=\"#1字符串转化为数组\">#</a> 1. 字符串转化为数组</h3>\n<ol>\n<li>\n<p>split：将字符串以某种方式分割成数组。</p>\n<p>split 传入一个参数可以是正则表达式并匹配数组中的元素将其分割为数组，返回一个数组不改变字符串。</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let str = &#x27;1,3 4&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">console.log(str.split()) // 如果不传参数则会将返回一个数组第一个元素为整个字符串</span><br><span class=\"line\">[ &#x27;1,3 4&#x27; ]</span><br><span class=\"line\"></span><br><span class=\"line\">console.log(str.split(&#x27;&#x27;)) // 如果参数为空字符串的话，则会将字符串每一个元素传入数组中并返回这个数组</span><br><span class=\"line\">[ &#x27;1&#x27;, &#x27;,&#x27;, &#x27;3&#x27;, &#x27; &#x27;, &#x27;4&#x27; ]</span><br><span class=\"line\"></span><br><span class=\"line\">console.log(str.split(&#x27; &#x27;))// 参数可以是空格，将空格作为分割符并传入数组并返回这个数组</span><br><span class=\"line\">[ &#x27;1,3&#x27;, &#x27;4&#x27; ]</span><br><span class=\"line\"></span><br><span class=\"line\">console.log(str.split(&#x27;,&#x27;))</span><br><span class=\"line\">[ &#x27;1&#x27;, &#x27;3 4&#x27; ]</span><br><span class=\"line\"></span><br><span class=\"line\">console.log(str.split(/[0-9]/))// 参数可以是正则表达式</span><br><span class=\"line\">[ &#x27;&#x27;, &#x27;,&#x27;, &#x27; &#x27;, &#x27;&#x27; ]</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h3 id=\"2-查找字符串中某个值的位置\"><a class=\"markdownIt-Anchor\" href=\"#2-查找字符串中某个值的位置\">#</a> 2. 查找字符串中某个值的位置</h3>\n<p>1.indexOf：查找某个值在字符串的位置，这个值可以是字符串。</p>\n<p>2.lastIndexOf：查找某个值在字符串的位置，同样这个值可以是字符串。</p>\n<p>用法与数组的方法一致，不过这个方法可以很方便的求两个字符串的子串。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let str1 = &#x27;abc&#x27;,str2=&#x27;abccbabc&#x27;</span><br><span class=\"line\">console.log(str2.indexOf(str1))//0</span><br><span class=\"line\">console.log(str2.lastIndexOf(str1))//5</span><br><span class=\"line\">只要返回值不是-1就说明str是str2的子串。</span><br></pre></td></tr></table></figure>\n<h2 id=\"三-哈希表\"><a class=\"markdownIt-Anchor\" href=\"#三-哈希表\">#</a> 三、哈希表</h2>\n<ol>\n<li>\n<p>set (key,value): 设置键值对，如果某一键已经存在则会覆盖。第一个参数可以是数字，字符串，布尔值，数组，对象，函数等等值。</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let arr1 =[1,2],obj1=&#123;a:1&#125;,arr2 =[1,2],obj2=&#123;a:1&#125;,map = new Map(),fun1 =()=&gt;&#123;&#125;,fun2=()=&gt;&#123;&#125;</span><br><span class=\"line\">map.set(arr1,1)</span><br><span class=\"line\">map.set(obj1,1)</span><br><span class=\"line\">map.set(arr2,1)</span><br><span class=\"line\">map.set(obj2,1)</span><br><span class=\"line\">map.set(fun1,1)</span><br><span class=\"line\">map.set(fun2,1)</span><br><span class=\"line\">console.log(map.size)//6</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">let arr1 =[1,2],arr2 =arr1,map = new Map()</span><br><span class=\"line\">map.set(arr1,1)</span><br><span class=\"line\">map.set(arr2,1)</span><br><span class=\"line\">console.log(map.size)//1</span><br><span class=\"line\"></span><br><span class=\"line\">可以发现像数组，对象，函数尽管一模一样，但是其变量储存的地址不同所以看做是不同的键，但是如果是浅拷贝储存变量的地址一致就视作是同一个键</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>get (key): 获取某一键值在哈希表中的值。</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let map = new Map()</span><br><span class=\"line\">map.set(1,2)</span><br><span class=\"line\">map.get(1)//2</span><br><span class=\"line\">map.get(2)//undefined 如果找不到就会返回undefined</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>has (key): 判断某个键是否存在，并返回布尔值。</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let map = new Map()</span><br><span class=\"line\">map.set(1,2)</span><br><span class=\"line\">console.log(map.has(1))//true</span><br><span class=\"line\">console.log(map.has(2))//false</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>clear (): 清除哈希表所有键值对。</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let map = new Map()</span><br><span class=\"line\">map.set(1,2)</span><br><span class=\"line\">console.log(map.has(1))//true</span><br><span class=\"line\">map.clear()</span><br><span class=\"line\">console.log(map.has(1))//false</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>delete (key): 删除某键。</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let map = new Map()</span><br><span class=\"line\">map.set(1,2)</span><br><span class=\"line\">console.log(map.has(1))//true</span><br><span class=\"line\">map.delete()</span><br><span class=\"line\">console.log(map.has(1))//false</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>keys (): 返回一个包含哈希表所有键的迭代器。</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let arr1 =[1,2],obj1=&#123;a:1&#125;,arr2 =[1,2],obj2=&#123;a:1&#125;,map = new Map(),fun1 =()=&gt;&#123;&#125;,fun2=()=&gt;&#123;&#125;</span><br><span class=\"line\">map.set(arr1,1)</span><br><span class=\"line\">map.set(obj1,1)</span><br><span class=\"line\">map.set(arr2,1)</span><br><span class=\"line\">map.set(obj2,1)</span><br><span class=\"line\">map.set(fun1,1)</span><br><span class=\"line\">map.set(fun2,1)</span><br><span class=\"line\">let key = map.keys()</span><br><span class=\"line\">for(let i of key)&#123;</span><br><span class=\"line\">    console.log(i) //[ 1, 2 ] &#123; a: 1 &#125; [ 1, 2 ] &#123; a: 1 &#125; [Function: fun1] [Function: fun2]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li>\n<p>values (): 返回一个包含哈希表所有值的迭代器。</p>\n <figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let arr1 =[1,2],obj1=&#123;a:1&#125;,arr2 =[1,2],obj2=&#123;a:1&#125;,map = new Map(),fun1 =()=&gt;&#123;&#125;,fun2=()=&gt;&#123;&#125;</span><br><span class=\"line\">map.set(arr1,1)</span><br><span class=\"line\">map.set(obj1,1)</span><br><span class=\"line\">map.set(arr2,1)</span><br><span class=\"line\">map.set(obj2,1)</span><br><span class=\"line\">map.set(fun1,1)</span><br><span class=\"line\">map.set(fun2,1)</span><br><span class=\"line\">let val = map.values()</span><br><span class=\"line\">for(let i of val)&#123;</span><br><span class=\"line\">    console.log(i) // 1 1 1 1 1 1</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n",
            "tags": [
                "学习记录",
                "JavaScript"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/07/17/algorithm/%E9%93%BE%E8%A1%A8%E5%9F%BA%E7%A1%80/",
            "url": "https://seele-exzzz.github.io/2023/07/17/algorithm/%E9%93%BE%E8%A1%A8%E5%9F%BA%E7%A1%80/",
            "title": "链表基础",
            "date_published": "2023-07-17T07:45:02.445Z",
            "content_html": "<p>[toc]</p>\n<h1 id=\"链表基础\"><a class=\"markdownIt-Anchor\" href=\"#链表基础\">#</a> 链表基础</h1>\n<h2 id=\"一-链表操作\"><a class=\"markdownIt-Anchor\" href=\"#一-链表操作\">#</a> 一、链表操作</h2>\n<h3 id=\"1力扣上的链表构造函数\"><a class=\"markdownIt-Anchor\" href=\"#1力扣上的链表构造函数\">#</a> 1. 力扣上的链表构造函数</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//注意这是力扣上的构造函数不是JavaScript内置函数</span><br><span class=\"line\">function ListNode(val, next) &#123;</span><br><span class=\"line\">    this.val = (val===undefined ? 0 : val)</span><br><span class=\"line\">    this.next = (next===undefined ? null : next)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">let node = new ListNode(0,head)</span><br><span class=\"line\">//通常用来给链表加上虚拟头结点方便对链表进行操作，第一个形参传值，第二形参传链表</span><br><span class=\"line\">//另外如果用const定义变量再赋予链表，这个变量就无法操作了，原因应该是在操作链表时，链表所储存的变量的地址发生变化。</span><br></pre></td></tr></table></figure>\n<h3 id=\"2链表移动和删除\"><a class=\"markdownIt-Anchor\" href=\"#2链表移动和删除\">#</a> 2. 链表移动和删除</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">let cur = head </span><br><span class=\"line\">/*</span><br><span class=\"line\">将head赋给变量cur，如果直接操作head然后再return的话会是null，由于这是浅拷贝，在操作cur时head也会发生改变，所以操作完cur再return head就行。</span><br><span class=\"line\">*/</span><br><span class=\"line\"></span><br><span class=\"line\">cur = cur.next //让将cur下一位赋给cur就完成了一次移动。</span><br><span class=\"line\"></span><br><span class=\"line\">while(cur)&#123;</span><br><span class=\"line\">\t...\t//对cur操作</span><br><span class=\"line\">\tcur = cur.next</span><br><span class=\"line\">&#125; //这就完成了一次遍历，这时cur是null，head已操作</span><br><span class=\"line\"></span><br><span class=\"line\">cur.netx = cur.next.next //想删除那个节点需找到那个节点的前面一个节点，将前面那个节点的指针指向删除节点后面那个节点。</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">//力扣上203. 移除链表元素</span><br><span class=\"line\"></span><br><span class=\"line\">//方法一，增加虚拟节点</span><br><span class=\"line\">var removeElements = function(head, val) &#123;</span><br><span class=\"line\">    const cur = new ListNode(0,head)</span><br><span class=\"line\">    let a = cur</span><br><span class=\"line\">    while(a.next)&#123;</span><br><span class=\"line\">        if(a.next.val==val)&#123;</span><br><span class=\"line\">            a.next = a.next.next</span><br><span class=\"line\">        &#125;else&#123;</span><br><span class=\"line\">            a = a.next </span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return cur.next</span><br><span class=\"line\">&#125;;//增加虚拟头节点的好处在于，处理原链表的头节点与其他节点的方式一致，无需在额外考虑头节点如何处理，最后只要return cur.next就行。</span><br><span class=\"line\"></span><br><span class=\"line\">//方法二，在不增加虚拟头节点的情况下删除指定节点</span><br><span class=\"line\">var removeElements = function(head, val) &#123;</span><br><span class=\"line\">    let cur = head</span><br><span class=\"line\">    /*先用while将头节点中值等于val删除，之后就和方法一差不多，需要注意的是，删除后有可能是null或者传来的链表就是null，这是需要if条件判断一下，方法一无需判断是因为加了头节点所以不可能是null*/</span><br><span class=\"line\">    while(cur&amp;&amp;cur.val==val)&#123;</span><br><span class=\"line\">        cur = cur.next</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if(!cur) return cur</span><br><span class=\"line\">    head = cur //将处理好的cur赋值给head，如果不赋值，前面的操作就没有用了。</span><br><span class=\"line\">    while(cur.next)&#123;</span><br><span class=\"line\">        if(cur.next.val==val)&#123;</span><br><span class=\"line\">            cur.next = cur.next.next</span><br><span class=\"line\">        &#125;else&#123;</span><br><span class=\"line\">            cur = cur.next</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    return head</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h3 id=\"3链表的插入\"><a class=\"markdownIt-Anchor\" href=\"#3链表的插入\">#</a> 3. 链表的插入</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//假设需要往链表head中的第n个节点插入val值，注意链表与数组一样下标从0开始</span><br><span class=\"line\">//首先声明一个变量并将head赋值给这个变量</span><br><span class=\"line\">let cur = head</span><br><span class=\"line\"></span><br><span class=\"line\">方法一：不使用虚拟节点</span><br><span class=\"line\"></span><br><span class=\"line\">//如果不使用虚拟节点的话，得分两种情况，第一种删除头节点，第二种删除后面的节点</span><br><span class=\"line\"></span><br><span class=\"line\">//插入头节点</span><br><span class=\"line\">if(n==0)&#123;</span><br><span class=\"line\">\thead = new ListNode(val,head)</span><br><span class=\"line\">&#125;else&#123;</span><br><span class=\"line\">\t//移动到第n-1个节点前</span><br><span class=\"line\">    while(n&gt;1)&#123; //从n减到1，这时cur到n-1节点前，如果加了虚拟头节点，这时的判断条件为0</span><br><span class=\"line\">\t  cur = cur.next</span><br><span class=\"line\">\t  n --</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">   let node = new ListNode(val) </span><br><span class=\"line\">   /*注意这里先把cur.next先赋给node.next，如果反过来先让cur.next变成node.next，再让cur.next赋给node.next，这时cur.next已经是node，相当于自己指向自己。这里有点像两个变量交换。假设有a,b两个变量，交换a,b两个变量的值，不用解构赋值的话</span><br><span class=\"line\">   \t let c = a</span><br><span class=\"line\">   \t a = b</span><br><span class=\"line\">   \t b = c</span><br><span class=\"line\">   */</span><br><span class=\"line\">   node.next = cur.next</span><br><span class=\"line\">   cur.next = node</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">方法二：使用虚拟头节点</span><br><span class=\"line\">let cur = new ListNode(0,head)</span><br><span class=\"line\">let head = cur</span><br><span class=\"line\">while(n)&#123;</span><br><span class=\"line\">\tcur = cur.next</span><br><span class=\"line\">\tn--</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">let node = new ListNode(val)</span><br><span class=\"line\">node.next = cur.next</span><br><span class=\"line\">cur.next = node</span><br><span class=\"line\">head = head.next //最后注意去除虚拟头节点</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "算法",
                "算法",
                "链表"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/07/14/algorithm/%E4%BA%8C%E5%8F%89%E6%A0%91%E5%9F%BA%E7%A1%80/",
            "url": "https://seele-exzzz.github.io/2023/07/14/algorithm/%E4%BA%8C%E5%8F%89%E6%A0%91%E5%9F%BA%E7%A1%80/",
            "title": "二叉树基础",
            "date_published": "2023-07-14T14:04:41.779Z",
            "content_html": "<p>[toc]</p>\n<h1 id=\"二叉树基础\"><a class=\"markdownIt-Anchor\" href=\"#二叉树基础\">#</a> 二叉树基础</h1>\n<h2 id=\"一-二叉树种类\"><a class=\"markdownIt-Anchor\" href=\"#一-二叉树种类\">#</a> 一、二叉树种类</h2>\n<h3 id=\"1满二叉树\"><a class=\"markdownIt-Anchor\" href=\"#1满二叉树\">#</a> 1. 满二叉树</h3>\n<p>除最后一层有两个子节点外，最后一层没有子节点，如果某个满二叉树有 k 层则该满二叉树有 2 的 k 次方 - 1 个节点。</p>\n<h3 id=\"2-完全二叉树\"><a class=\"markdownIt-Anchor\" href=\"#2-完全二叉树\">#</a> 2. 完全二叉树</h3>\n<p>最后一层如果有缺的子节点则该子节点为右侧的子节点。如果某个完全二叉树有 k 层，则该完全二叉树则有 2 的 k-1 次方到 2 的 k 次方 - 1 个节点。满二叉树是特殊的完全二叉树</p>\n<p><img data-src=\"https://typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com/img/algorithm/binary_tree/%E6%BB%A1%E4%BA%8C%E5%8F%89%E6%A0%91%E5%92%8C%E5%AE%8C%E5%85%A8%E4%BA%8C%E5%8F%89%E6%A0%91.png\" alt=\"\"></p>\n<h3 id=\"3-二叉搜索树\"><a class=\"markdownIt-Anchor\" href=\"#3-二叉搜索树\">#</a> 3. 二叉搜索树</h3>\n<p>二叉搜索树中某个节点的左节点值小于该节点，右节点值大于该节点</p>\n<h3 id=\"4-二叉平衡树\"><a class=\"markdownIt-Anchor\" href=\"#4-二叉平衡树\">#</a> 4. 二叉平衡树</h3>\n<p>在二叉搜索树的条件下，每一个节点的左子树与右子树的高度差不大于一，二叉平衡树是特殊的二叉搜索树。另外二叉树的高度从下往上数，深度从上往下数。</p>\n<p><img data-src=\"https://typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com/img/algorithm/binary_tree/%E4%BA%8C%E5%8F%89%E5%B9%B3%E8%A1%A1%E6%A0%91.png\" alt=\"\"></p>\n<h2 id=\"二-二叉树的构建\"><a class=\"markdownIt-Anchor\" href=\"#二-二叉树的构建\">#</a> 二、 二叉树的构建</h2>\n<h3 id=\"1-构建力扣上的二叉树\"><a class=\"markdownIt-Anchor\" href=\"#1-构建力扣上的二叉树\">#</a> 1. 构建力扣上的二叉树</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">在做力扣上102. 二叉树的层序遍历的时候，好奇试了一下console.dir(root)</span><br><span class=\"line\">TreeNode &#123;</span><br><span class=\"line\">  val: 3,</span><br><span class=\"line\">  left: TreeNode &#123; val: 9, left: null, right: null &#125;,</span><br><span class=\"line\">  right: TreeNode &#123;</span><br><span class=\"line\">    val: 20,</span><br><span class=\"line\">    left: TreeNode &#123; val: 15, left: null, right: null &#125;,</span><br><span class=\"line\">    right: TreeNode &#123; val: 7, left: null, right: null &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;// 结果是这个，根据这个我试着构建了一下二叉树，当然后面看别人的文章发现二叉树远不止这些属性和方法</span><br><span class=\"line\">class TreeNode &#123;</span><br><span class=\"line\">    constructor(val) &#123;</span><br><span class=\"line\">      this.val = val;</span><br><span class=\"line\">      this.left = null;</span><br><span class=\"line\">      this.right = null;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    addleft(left)&#123;</span><br><span class=\"line\">        this.left = left</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    addright(right)&#123;</span><br><span class=\"line\">        this.right = right</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">const root = new TreeNode(3)</span><br><span class=\"line\">root.addleft(new TreeNode(9))</span><br><span class=\"line\">root.addright(new TreeNode(20))</span><br><span class=\"line\">root.right.addleft(new TreeNode(15))</span><br><span class=\"line\">root.right.addright(new TreeNode(7))</span><br></pre></td></tr></table></figure>\n<h2 id=\"三-二叉树的遍历\"><a class=\"markdownIt-Anchor\" href=\"#三-二叉树的遍历\">#</a> 三、二叉树的遍历</h2>\n<p><img data-src=\"https://typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com/img/cover/algorithm/binary_tree/%E4%BA%8C%E5%8F%89%E6%A0%91%E5%89%8D%E4%B8%AD%E5%90%8E%E5%BA%8F%E9%81%8D%E5%8E%86.png\" alt=\"\"></p>\n<h3 id=\"1-深度优先算法\"><a class=\"markdownIt-Anchor\" href=\"#1-深度优先算法\">#</a> 1. 深度优先算法</h3>\n<h4 id=\"1-递归法\"><a class=\"markdownIt-Anchor\" href=\"#1-递归法\">#</a> 1. 递归法</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//root为二叉树</span><br><span class=\"line\">const result =[]</span><br><span class=\"line\">const dfs = (root)=&gt;&#123;</span><br><span class=\"line\">    if(root==null) return</span><br><span class=\"line\">    //前序遍历</span><br><span class=\"line\">    result.push(root.val)</span><br><span class=\"line\">    dfs(root.left)</span><br><span class=\"line\">    dfs(root.right)</span><br><span class=\"line\">    //中序遍历</span><br><span class=\"line\">    dfs(root.left)</span><br><span class=\"line\">    result.push(root.val)</span><br><span class=\"line\">    dfs(root.right)</span><br><span class=\"line\">    //后序遍历</span><br><span class=\"line\">    dfs(root.left)</span><br><span class=\"line\">    dfs(root.right)</span><br><span class=\"line\">    result.push(root.val)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">dfs(root)</span><br><span class=\"line\">return result</span><br></pre></td></tr></table></figure>\n<h4 id=\"2-迭代法\"><a class=\"markdownIt-Anchor\" href=\"#2-迭代法\">#</a> 2. 迭代法</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//前序遍历</span><br><span class=\"line\">const result =[],arr=[root]</span><br><span class=\"line\">while(arr.length&gt;0)&#123;</span><br><span class=\"line\">    let tree = arr.pop()</span><br><span class=\"line\">    if(tree==null) continue</span><br><span class=\"line\">    result.push(tree.val)</span><br><span class=\"line\">\tarr.push(tree.right)</span><br><span class=\"line\">    arr.push(tree.left)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">return result</span><br><span class=\"line\">//后序遍历 在前序遍历的情况下调换调换传入arr的两个子节点，同时将最后的数组反转。</span><br><span class=\"line\">const result =[],arr=[root]</span><br><span class=\"line\">while(arr.length&gt;0)&#123;</span><br><span class=\"line\">    let tree = arr.pop()</span><br><span class=\"line\">    if(tree==null) continue</span><br><span class=\"line\">    result.push(tree.val)</span><br><span class=\"line\">    arr.push(tree.left)</span><br><span class=\"line\">    arr.push(tree.right)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">return result.reverse()</span><br><span class=\"line\">//中序遍历</span><br><span class=\"line\">const result =[],stack=[]</span><br><span class=\"line\">let tree = root</span><br><span class=\"line\">while(stack.length&gt;0||tree)&#123;</span><br><span class=\"line\">\tif(tree)&#123;</span><br><span class=\"line\">\t\tstack.push(tree)</span><br><span class=\"line\">\t\ttree = tree.left</span><br><span class=\"line\">\t&#125;else&#123;</span><br><span class=\"line\">\t\tlet rootTree = stack.pop()</span><br><span class=\"line\">\t\tresult.push(rootTree.val)</span><br><span class=\"line\">\t\ttree = rootTree.right</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">return result</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-广度优先搜索span-stylefont-size16px层序遍历span\"><a class=\"markdownIt-Anchor\" href=\"#2-广度优先搜索span-stylefont-size16px层序遍历span\">#</a> 2. 广度优先搜索<span style=\"font-size:16px\">(层序遍历)</span></h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//力扣上的层序遍历最后的输出结果似乎都是二维数组，需要将每一层的值用数组储存然后将其储存进一个数组输出出去。</span><br><span class=\"line\">const result = [],arr=[root]</span><br><span class=\"line\">let res=[]</span><br><span class=\"line\">while(arr.length&gt;0)&#123;</span><br><span class=\"line\">    let len = arr.length //相当于快照用于储存当前层数的长度。</span><br><span class=\"line\">    while(len&gt;0)&#123; //当len为零时，说明当前层的值已全部弹出，这时应该用result储存当前层所有数组</span><br><span class=\"line\">        let tree = arr.shift() </span><br><span class=\"line\">        len -- </span><br><span class=\"line\">        if(tree!=null)&#123;</span><br><span class=\"line\">            res.push(tree.val)</span><br><span class=\"line\">            arr.push(tree.left)</span><br><span class=\"line\">            arr.push(tree.right)  </span><br><span class=\"line\">        &#125;     </span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    if(res.length==0) break </span><br><span class=\"line\">    result.push(res) </span><br><span class=\"line\">    res = [] //清空当前层用于记录下一层的值</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">return result</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "算法",
                "二叉树",
                "算法"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/07/12/Learning-record/%E6%AD%A3%E5%88%99%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/",
            "url": "https://seele-exzzz.github.io/2023/07/12/Learning-record/%E6%AD%A3%E5%88%99%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/",
            "title": "正则学习记录",
            "date_published": "2023-07-12T05:31:15.886Z",
            "content_html": "<h1 id=\"正则学习记录\"><a class=\"markdownIt-Anchor\" href=\"#正则学习记录\">#</a> 正则学习记录</h1>\n<p>[toc]</p>\n<h2 id=\"一-正则表达式的创建\"><a class=\"markdownIt-Anchor\" href=\"#一-正则表达式的创建\">#</a> 一、正则表达式的创建</h2>\n<h3 id=\"1-字面量创建\"><a class=\"markdownIt-Anchor\" href=\"#1-字面量创建\">#</a> 1. 字面量创建</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const a = /a/igm //i表示忽略大小写，g表示全局匹配，m表示多行匹配</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-构造函数创建\"><a class=\"markdownIt-Anchor\" href=\"#2-构造函数创建\">#</a> 2. 构造函数创建</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cosnt a = &#x27;a&#x27;</span><br><span class=\"line\">const b = new RegExp(&#x27;a&#x27;) 或者 b = new RegExp(a)//这里的b打印结果与上面字面量创建的a一致</span><br><span class=\"line\">// RegExp有两个参数，第一个参数传入一个字符串表示正则表达式，第二个参数有g全局匹配，i忽略大小写，m多行匹配</span><br></pre></td></tr></table></figure>\n<h2 id=\"二-javascript中正则方法\"><a class=\"markdownIt-Anchor\" href=\"#二-javascript中正则方法\">#</a> 二、JavaScript 中正则方法</h2>\n<h3 id=\"1-test方法\"><a class=\"markdownIt-Anchor\" href=\"#1-test方法\">#</a> 1. test 方法</h3>\n<p>用于测试某一字符串是否满足某一正则表达式，返回一个布尔值。正则表达式的方法</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const reg = /a/</span><br><span class=\"line\">const str = &#x27;abc&#x27;</span><br><span class=\"line\">reg.test(str)</span><br></pre></td></tr></table></figure>\n<h3 id=\"2-exec方法\"><a class=\"markdownIt-Anchor\" href=\"#2-exec方法\">#</a> 2. exec 方法</h3>\n<p>用于匹配某一字符串中满足正则表达式的内容，返回一个数组，第一项为匹配到的内容，第二项 index 为匹配到内容第一个字符所在的索引，input 为匹配的字符串，groups 为命名的捕获组。正则表达式的方法</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const reg = /a/</span><br><span class=\"line\">const str = &#x27;abcabcaa&#x27;</span><br><span class=\"line\">const result = reg.exec(str)</span><br><span class=\"line\">console.log(result) //[ &#x27;a&#x27;, index: 0, input: &#x27;abcabcaa&#x27;, groups: undefined ]</span><br><span class=\"line\">/*</span><br><span class=\"line\">\t如果正则表达式是全局匹配的话，exec会改变的lastindex，如果exec没匹配上，这时lastindexhi变为0</span><br><span class=\"line\">*/</span><br><span class=\"line\">const reg = /a/g</span><br><span class=\"line\">const str = &#x27;abac&#x27;</span><br><span class=\"line\">for(let i=0;i&lt;3;i++)&#123;</span><br><span class=\"line\">\tconsole.log(reg.lastIndex)</span><br><span class=\"line\">    reg.exec(str)</span><br><span class=\"line\">    console.log(reg.lastIndex)</span><br><span class=\"line\">&#125;// 0,1,1,3,3,0</span><br><span class=\"line\">//可以用?&lt;name&gt;给捕获组命名。这时如果成功匹配返回的对象中groups不再是undefined而是一个属性为捕获组名字，值为匹配到的内容的对象。</span><br><span class=\"line\">const reg = /(?&lt;year&gt;[0-9]+)-(?&lt;month&gt;[0-9]+)-(?&lt;day&gt;[0-9]&#123;2&#125;)/</span><br><span class=\"line\">const str = &#x27;2023-07-13&#x27;</span><br><span class=\"line\">const result = reg.exec(str)</span><br><span class=\"line\">console.log(result)</span><br><span class=\"line\">/*</span><br><span class=\"line\">[</span><br><span class=\"line\">  &#x27;2023-07-13&#x27;,</span><br><span class=\"line\">  &#x27;2023&#x27;,</span><br><span class=\"line\">  &#x27;07&#x27;,</span><br><span class=\"line\">  &#x27;13&#x27;,</span><br><span class=\"line\">  index: 0,</span><br><span class=\"line\">  input: &#x27;2023-07-13&#x27;,</span><br><span class=\"line\">  groups: [Object: null prototype] &#123; year: \t &#x27;2023&#x27;, month: &#x27;07&#x27;, day: &#x27;13&#x27; &#125;</span><br><span class=\"line\">]</span><br><span class=\"line\">*/</span><br><span class=\"line\">const reg = /(?&lt;year&gt;[0-9]+)-(?&lt;month&gt;[0-9]+)-(?&lt;day&gt;[0-9]&#123;2&#125;)/g</span><br><span class=\"line\">const str = &#x27;2023-07-13 1145-14-15&#x27;</span><br><span class=\"line\">reg.exec(str).groups</span><br><span class=\"line\">const &#123;year,month,day&#125; = reg.exec(str).groups</span><br><span class=\"line\">console.log(year,month,day) // 1145 14 15</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-match方法\"><a class=\"markdownIt-Anchor\" href=\"#3-match方法\">#</a> 3. match 方法</h3>\n<p>匹配字符串中满足正则表达式的内容并返回一个数组，注意 match 是字符串的方法不是正则表达式的方法。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const reg = /a/</span><br><span class=\"line\">const regG = /a/g</span><br><span class=\"line\">const str = &#x27;abcabcaa&#x27;</span><br><span class=\"line\">const result = str.match(reg) // 如果正则表达式不是全局匹配这时match返回值与exec一致</span><br><span class=\"line\">console.log(result)//[ &#x27;a&#x27;, index: 0, input: &#x27;abcabcaa&#x27;, groups: undefined ]</span><br><span class=\"line\">const resultG = str.match(regG)// 这时会返回一个数组，数组中每一项为满足字符串中满足正则表达式中匹配规则的部分。</span><br><span class=\"line\">console.log(resultG)//[ &#x27;a&#x27;, &#x27;a&#x27;, &#x27;a&#x27;, &#x27;a&#x27; ]</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-search方法\"><a class=\"markdownIt-Anchor\" href=\"#4-search方法\">#</a> 4. search 方法</h3>\n<p>匹配字符串中满足正则表达式的内容并返回第一个匹配到字符的索引。同样这也是字符串方法</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const reg = /a/</span><br><span class=\"line\">const regG = /a/g</span><br><span class=\"line\">const str = &#x27;babcabcaa&#x27;</span><br><span class=\"line\">const result = str.search(reg) </span><br><span class=\"line\">const resultG = str.search(regG)// 全局匹配一样只返回匹配到第一个满足条件的字符的索引</span><br><span class=\"line\">console.log(result)//1</span><br><span class=\"line\">console.log(resultG)//1</span><br></pre></td></tr></table></figure>\n<h3 id=\"5-replace方法\"><a class=\"markdownIt-Anchor\" href=\"#5-replace方法\">#</a> 5. replace () 方法</h3>\n<p>匹配字符串中满足某字符串或者正则表达式的内容并进行替换，同样也是字符串方法</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const reg = /a/</span><br><span class=\"line\">const regG = /a/g</span><br><span class=\"line\">const str = &#x27;babcabcaa&#x27;</span><br><span class=\"line\">const result = str.replace(reg,&#x27;*&#x27;) //没有全局匹配只匹配第一个满足条件的</span><br><span class=\"line\">const resultG = str.replace(regG,&#x27;*&#x27;)</span><br><span class=\"line\">console.log(result) //b*bcabcaa</span><br><span class=\"line\">console.log(resultG) //b*bc*bc**</span><br><span class=\"line\">/*</span><br><span class=\"line\">\treplace的第二个参数可以传递一个函数，函数的参数为匹配到的内容，如果正则表达式是全局匹配的话且能匹配到多个字符，则每匹配到一个就会调用一次函数，形参为匹配到的内容</span><br><span class=\"line\">*/</span><br><span class=\"line\">const result = str.replace(reg,(data)=&gt;&#123;</span><br><span class=\"line\">    console.log(data) // a </span><br><span class=\"line\">&#125;) </span><br><span class=\"line\">const resultG = str.replace(regG,(data)=&gt;&#123;</span><br><span class=\"line\">    console.log(data) // a</span><br><span class=\"line\">&#125;) //回调函数调用了3次</span><br></pre></td></tr></table></figure>\n<h3 id=\"6-split方法\"><a class=\"markdownIt-Anchor\" href=\"#6-split方法\">#</a> 6. split 方法</h3>\n<p>用字符串分割数组，分割方式可以为一个正则表达式并返回一个数组，数组每一项为分割后的字符串。</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">const str = &#x27;abc&#x27;</span><br><span class=\"line\">const newstr = str.split(&#x27;&#x27;)</span><br><span class=\"line\">console.log(newstr) //[ &#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27; ]</span><br><span class=\"line\">/*</span><br><span class=\"line\">\tJavaScript中字符串的方法有限，如果想要反转字符串，简单的办法是用split(&#x27;&#x27;)转化为数\t组然后调用reverse方法反转数组并调用join(&#x27;&#x27;)转回字符串</span><br><span class=\"line\">*/</span><br><span class=\"line\">const reStr = str.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;) </span><br><span class=\"line\">console.log(reStr) // cba</span><br><span class=\"line\"></span><br><span class=\"line\">const str = &#x27;2023-7-12&#x27; //如果想要这个字符串中的数字</span><br><span class=\"line\">const newstr = str.split(/-/)</span><br><span class=\"line\">console.log(newstr) [ &#x27;2023&#x27;, &#x27;7&#x27;, &#x27;12&#x27; ]</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "学习记录",
                "正则"
            ]
        },
        {
            "id": "https://seele-exzzz.github.io/2023/07/08/Learning-record/Typescript%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/",
            "url": "https://seele-exzzz.github.io/2023/07/08/Learning-record/Typescript%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/",
            "title": "Typescript学习记录",
            "date_published": "2023-07-08T10:22:13.494Z",
            "content_html": "<h1 id=\"typescript学习记录\"><a class=\"markdownIt-Anchor\" href=\"#typescript学习记录\">#</a> Typescript 学习记录</h1>\n<p>[toc]</p>\n<h2 id=\"一-基本类型\"><a class=\"markdownIt-Anchor\" href=\"#一-基本类型\">#</a> 一、基本类型</h2>\n<h3 id=\"1-基本数据类型span-stylefont-size14px-type代表类型span\"><a class=\"markdownIt-Anchor\" href=\"#1-基本数据类型span-stylefont-size14px-type代表类型span\">#</a> 1. 基本数据类型<span style='font-size:14px' >(type 代表类型)</span></h3>\n<ul>\n<li>any: 任意类型</li>\n<li>string: 字符串类型</li>\n<li>boolean: 布尔类型</li>\n<li>type[]，Array<type>: 数组类型两种表示方法</li>\n<li>[type] : 元组，如果要储存类似经纬度这类需要两个数字的数据则可以用 [number,number]</li>\n<li>void : 表示函数无返回值</li>\n<li>null : null 类型</li>\n<li>undefined : undefined 类型</li>\n<li>never : 表示从来不会出现的值</li>\n</ul>\n<h3 id=\"2-函数形参和返回值的类型\"><a class=\"markdownIt-Anchor\" href=\"#2-函数形参和返回值的类型\">#</a> 2. 函数形参和返回值的类型</h3>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> f = (<span class=\"attr\">a</span>:<span class=\"built_in\">number</span>,<span class=\"attr\">b</span>:<span class=\"built_in\">string</span>):<span class=\"function\"><span class=\"params\">string</span>=&gt;</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a+b</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> f = (<span class=\"attr\">a</span>:<span class=\"built_in\">number</span>,<span class=\"attr\">b</span>:<span class=\"built_in\">string</span>):<span class=\"function\"><span class=\"params\">void</span>=&gt;</span>&#123;&#125;<span class=\"comment\">//void 表示无返回值</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"3-类型推断\"><a class=\"markdownIt-Anchor\" href=\"#3-类型推断\">#</a> 3. 类型推断</h3>\n<p>ide 在编译文件时会对变量的类型进行判断，所以在声明一个变量后立马赋值，声明一个对象并对其中的属性赋值又或者函数的返回值与形参有关可以推断出来等等，这些可以推断出来的就无需加上类型。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> a = <span class=\"number\">1</span> <span class=\"comment\">//ide会推断这个变量a的类型为number类型</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> obj = &#123;</span><br><span class=\"line\">    a : <span class=\"number\">1</span> <span class=\"comment\">//同样ide会推断这个a属性为number类型</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> fun = (<span class=\"attr\">a</span>:<span class=\"built_in\">number</span>,<span class=\"attr\">b</span>:<span class=\"built_in\">string</span>)&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a+b <span class=\"comment\">//ide会推断这里的返回值为string</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"4-关键字type和联合类型\"><a class=\"markdownIt-Anchor\" href=\"#4-关键字type和联合类型\">#</a> 4. 关键字 type 和联合类型</h3>\n<p>利用 type 给类型取一个别名，type 可以与联合类型一起使用</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">type</span> str1 = <span class=\"built_in\">string</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">a</span>:str1</span><br><span class=\"line\"><span class=\"keyword\">type</span> t = <span class=\"built_in\">number</span> | str1</span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"attr\">b</span>:t</span><br><span class=\"line\"><span class=\"keyword\">type</span> funType = <span class=\"built_in\">number</span> | <span class=\"built_in\">string</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> <span class=\"title function_\">fun</span> = (<span class=\"params\">a:funType</span>)=&gt;&#123;&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"二-接口\"><a class=\"markdownIt-Anchor\" href=\"#二-接口\">#</a> 二、接口</h2>\n<p>如果一个对象会重复使用，则可以使用将其抽出写成接口。</p>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Iobj</span>&#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>:<span class=\"built_in\">number</span></span><br><span class=\"line\">    <span class=\"attr\">b</span>:<span class=\"built_in\">string</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//接口与对象不同，属性之间可不加逗号</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> fun=(<span class=\"attr\">b</span>:<span class=\"title class_\">Iobj</span>):<span class=\"function\"><span class=\"params\">void</span>=&gt;</span>&#123;&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"1-接口属性\"><a class=\"markdownIt-Anchor\" href=\"#1-接口属性\">#</a> 1. 接口属性</h3>\n<ul>\n<li>可选属性：如果函数的形参对象中的某些属性是可选的。比如在使用 axios 时，传入的配置对象中 method 属性是可选属性如果不传默认是 get。</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Iobj</span>&#123;</span><br><span class=\"line\">    a?:<span class=\"built_in\">number</span></span><br><span class=\"line\">    <span class=\"attr\">b</span>:<span class=\"built_in\">string</span></span><br><span class=\"line\">&#125; <span class=\"comment\">//a是可选属性，可不传。</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> fun=(<span class=\"attr\">b</span>:<span class=\"title class_\">Iobj</span>):<span class=\"function\"><span class=\"params\">void</span>=&gt;</span>&#123;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> fun=(&#123;a=<span class=\"number\">1</span>,b&#125;:<span class=\"title class_\">Iobj</span>):<span class=\"function\"><span class=\"params\">void</span>=&gt;</span>&#123;&#125; <span class=\"comment\">//如果想给a一个默认值，如果没传就使用默认值的话</span></span><br></pre></td></tr></table></figure>\n<ul>\n<li>只读属性：如果接口中的某些属性不可修改，只读的话则可以使用只读属性</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Iobj</span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">readonly</span> <span class=\"attr\">a</span>:<span class=\"built_in\">number</span></span><br><span class=\"line\">   <span class=\"keyword\">readonly</span> <span class=\"attr\">b</span>:<span class=\"built_in\">string</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> fun=(&#123;a,b&#125;:<span class=\"title class_\">Iobj</span>):<span class=\"function\"><span class=\"params\">void</span>=&gt;</span>&#123;&#125;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>索引类型：索引签名允许我们定义一个可以包含不同属性名称的动态对象并且固定属性的类型必须与索引类型相同或是其子级。</li>\n</ul>\n<figure class=\"highlight typescript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">interface</span> <span class=\"title class_\">Iobj</span>&#123;</span><br><span class=\"line\">    <span class=\"attr\">a</span>:<span class=\"built_in\">number</span></span><br><span class=\"line\">    <span class=\"attr\">b</span>:<span class=\"built_in\">string</span></span><br><span class=\"line\">    [<span class=\"attr\">propName</span>: <span class=\"built_in\">string</span>]: <span class=\"built_in\">any</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">let</span> fun=(<span class=\"attr\">abc</span>:<span class=\"title class_\">Iobj</span>):<span class=\"function\"><span class=\"params\">void</span>=&gt;</span>&#123;&#125;</span><br></pre></td></tr></table></figure>\n",
            "tags": [
                "学习记录",
                "typescript"
            ]
        }
    ]
}