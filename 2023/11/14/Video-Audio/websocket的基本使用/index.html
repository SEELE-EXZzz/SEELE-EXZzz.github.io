<!-- build time: Fri Feb 23 2024 15:17:06 GMT+0800 (中国标准时间) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-COMPATIBLE" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><link rel="icon" type="image/ico" sizes="32x32" href="/assets/favicon.ico"><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="alternate" href="/rss.xml" title="个人博客" type="application/rss+xml"><link rel="alternate" href="/atom.xml" title="个人博客" type="application/atom+xml"><link rel="alternate" type="application/json" title="个人博客" href="https://seele-exzzz.github.io/feed.json"><link rel="preconnect" href="https://lf9-cdn-tos.bytecdntp.com"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://unpkg.com"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.10"><script src="https://cdn.staticfile.org/vue/3.2.45/vue.global.prod.js"></script><meta name="keywords" content="webrtc"><link rel="canonical" href="https://seele-exzzz.github.io/2023/11/14/Video-Audio/websocket%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"><title>websocket的基本使用</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">websocket的基本使用</h1><div class="meta"><span class="item" title="创建时间：2023-11-14 15:48:00"><span class="icon"><i class="ic i-calendar"></i></span><span class="text">发表于</span><time itemprop="dateCreated datePublished" datetime="2023-11-14T15:48:00+08:00">2023-11-14</time></span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i></span><span class="text">本文字数</span><span>16k</span><span class="text">字</span></span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i></span><span class="text">阅读时长</span><span>14 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span><span class="line"></span><span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">testName</a></li></ul><ul class="right" id="rightNav"><li class="item theme" @click="changeThemeByBtn"><i class="ic" :class="{'i-sun': !themeStatus,'i-moon': themeStatus}"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div class="pjax" id="imgs"><ul><li class="item" data-background-image="https://typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com/img/coverv2-45d40afcc29e334480daa6c0860b7317_720w.webp"></li><li class="item" data-background-image="https://typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com/img/cover/4440c7ccdd32d41726b5070ebbe83b12_3889824641741254187.jpg"></li><li class="item" data-background-image="https://typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com/img/cover/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20230717194834.png"></li><li class="item" data-background-image="https://typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com/img/cover1311796.png"></li><li class="item" data-background-image="https://typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com/img/coverv2-b0134090723fe0b1454cecdc483e1fe4_720w.webp"></li><li class="item" data-background-image="https://typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com/img/cover/93a689ac41217d9d524f83e809cdd3b1_8169942929963098157.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"></path></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"></use><use xlink:href="#gentle-wave" x="48" y="3"></use><use xlink:href="#gentle-wave" x="48" y="5"></use><use xlink:href="#gentle-wave" x="48" y="7"></use></g></svg></div><main><div class="inner"><div class="pjax" id="main"><div class="article wrap"><div class="breadcrumb" itemlistelement itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i><span><a href="/">首页</a></span><i class="ic i-angle-right"></i><span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Video-Audio/" itemprop="item" rel="index" title="分类于音视频开发"><span itemprop="name">音视频开发<meta itemprop="position" content="0"></span></a></span></div><article class="post block" itemscope itemtype="http://schema.org/Article" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://seele-exzzz.github.io/2023/11/14/Video-Audio/websocket%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/assets/avatar.jpg"><meta itemprop="name" content="SEELE-EXZzz(纯希)"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="个人博客"></span><div class="body md" itemprop="articleBody"><h3 id="websocket的基本使用"><a class="markdownIt-Anchor" href="#websocket的基本使用">#</a> websocket 的基本使用</h3><p>websocket 是全双工，可以做到客户端与服务端的实时连接，在直播，即时通讯，等要求实时传输的场景下有广泛的运用。</p><h3 id="一-基本使用"><a class="markdownIt-Anchor" href="#一-基本使用">#</a> 一、基本使用</h3><h4 id="1-引用"><a class="markdownIt-Anchor" href="#1-引用">#</a> 1. 引用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.前端</span><br><span class="line">let socket = new WebSocket(url) //注意url以ws或者wss开头，而不是http或者https,当调用这个构造函数的时候会连接一下。</span><br><span class="line">socket实例对象上的方法与事件:</span><br><span class="line">onclose:连接关闭事件</span><br><span class="line">onerror:连接失败事件</span><br><span class="line">onopen:连接成功事件</span><br><span class="line">onmessage:从服务器上获取数据时的事件</span><br><span class="line">close:断开连接</span><br><span class="line">send:发送数据</span><br><span class="line">2.后端</span><br><span class="line">npm install ws // 下载ws，一个支持websocket的第三方库</span><br><span class="line">const WebSocket = require(&#x27;ws&#x27;) //引入构造函数websocket</span><br><span class="line">const ws = new WebSocket.Server(&#123;port:3000&#125;) //调用websocket的server方法并传入port参数确定监听的端口号</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-连接断连发送接收"><a class="markdownIt-Anchor" href="#2-连接断连发送接收">#</a> 2. 连接，断连，发送，接收</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">1.前端</span><br><span class="line">socket.onopen=()=&gt;&#123;</span><br><span class="line">	socket.send(&#x27;hello，world&#x27;) //向服务器发送消息</span><br><span class="line">	socket.close() //断开连接</span><br><span class="line">&#125; //连接成功后的事件。</span><br><span class="line">socket.onmessage=(data)=&gt;&#123;</span><br><span class="line">	console.log(data)</span><br><span class="line">&#125;//当服务器向客户端发送消息后的事件。</span><br><span class="line">2.后端</span><br><span class="line">ws.on(&#x27;connection&#x27;,(server)=&gt;&#123;</span><br><span class="line">	//后端两种方法接收数据</span><br><span class="line">	server.on(&#x27;message&#x27;,(data)=&gt;&#123;</span><br><span class="line">		console.log(data)</span><br><span class="line">		console.log(data.toString(&#x27;utf8&#x27;)) //可以使用toString将buffer转化为字符串</span><br><span class="line">	&#125;) //这时传来的数据是buffer二进制格式</span><br><span class="line">	server.onmessage=(data)=&gt;&#123;</span><br><span class="line">		console.log(data)</span><br><span class="line">	&#125; //这时传来的数据是json格式</span><br><span class="line">	server.on(&#x27;close&#x27;,()=&gt;&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;)连接断开后的事件。</span><br><span class="line">&#125;)// ws为实例对象，其中有connection的事件，每有一次连接就会调用一次，客户端可以有多次连接。同时，回调函数上有一个参数，之后的连接关闭，以及发送，接受事件都在这个参数上而不在实例对象上</span><br></pre></td></tr></table></figure><h4 id="3心跳机制"><a class="markdownIt-Anchor" href="#3心跳机制">#</a> 3. 心跳机制</h4><p>​	当客户端与服务端断开连接时，是没有事件回调的，这时如果客户端往服务端发送消息时，会触发 onclose 事件，如果在 onclose 重连，那么之前发送的消息就没了。为了保障客户端与服务端一直维持连接，客户端应该时不时发送消息给服务端，如果某次消息没有回应或者说回应的时间超过了设置超时的时间便发起重新连接直至连接成功。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">前端</span><br><span class="line">let url = &#x27;ws://localhost:3000&#x27;</span><br><span class="line">let socket,heart,localConnection = false</span><br><span class="line">const createWebSocket=(url)=&gt;&#123;</span><br><span class="line">    try&#123;</span><br><span class="line">        socket = new WebSocket(url)</span><br><span class="line">    &#125;catch&#123;</span><br><span class="line">        connection(url)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">const connection=(url)=&gt;&#123;</span><br><span class="line">    if(heart&amp;&amp;heart.live) return //如果有心脏且在跳动就没有必要连接了</span><br><span class="line">    if(localConnection) return //类似节流的写法，一段时间内连接一次，避免重复连接</span><br><span class="line">    localConnection = true</span><br><span class="line">    createWebSocket(url)</span><br><span class="line">    setTimeout(()=&gt;&#123;</span><br><span class="line">        localConnection = false</span><br><span class="line">    &#125;,2000)</span><br><span class="line">&#125;</span><br><span class="line">createWebSocket(url)</span><br><span class="line">class Heart&#123;</span><br><span class="line">    constructor(time,timeOut)&#123;</span><br><span class="line">        this.time = time</span><br><span class="line">        this.timeOut = timeOut</span><br><span class="line">        this.live = false</span><br><span class="line">        this.startTime = null</span><br><span class="line">        this.connectionTime = null</span><br><span class="line">    &#125;</span><br><span class="line">    start()&#123;</span><br><span class="line">        let self = this</span><br><span class="line">        this.startTime = setTimeout(()=&gt;&#123;</span><br><span class="line">            socket.send(&#x27;ping&#x27;)</span><br><span class="line">            self.connectionTime = setTimeout(()=&gt;&#123;</span><br><span class="line">                connection(url)</span><br><span class="line">            &#125;,self.timeOut) //如果在设置超时时间内有回应便会在onmessage处重置心跳将这个定时器清除，如果这个定时器触发了说明了超时，连接可能失败。这时重新连接</span><br><span class="line">        &#125;,this.time) //每次接收到消息都会重置心跳重新启动，这里使用setTimeout，而不是setInterval。</span><br><span class="line">    &#125;</span><br><span class="line">    reset(time1,time2)&#123;</span><br><span class="line">        let time3 = time1?time1:this.time</span><br><span class="line">        let time4 = time2?time2:this.timeOut</span><br><span class="line">        clearTimeout(this.connectionTime)</span><br><span class="line">        clearTimeout(this.timer)</span><br><span class="line">        return new Heart(time3,time4)</span><br><span class="line">    &#125; //重置，将定时器清除同时可以更改心跳间隔以及超时时间。</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">socket.onopen=()=&gt;&#123;</span><br><span class="line">    heart = new Heart(30000,1000) //每隔30秒跳动一次，超时时间为1秒</span><br><span class="line">    heart.start() //开始跳动</span><br><span class="line">&#125;//连接上后开始跳动心脏</span><br><span class="line">socket.onclose=()=&gt;&#123;</span><br><span class="line">    console.log(&#x27;连接断开&#x27;)</span><br><span class="line">    heart.live = false</span><br><span class="line">    connection(url)</span><br><span class="line">&#125;//连接断开时重新连接</span><br><span class="line">socket.onmessage=(message)=&gt;&#123;</span><br><span class="line">    heart = heart.reset() </span><br><span class="line">    heart.start()</span><br><span class="line">    heart.live = true</span><br><span class="line">    if(message==&#x27;pong&#x27;) return </span><br><span class="line">&#125;//收到消息，说明连接还在，将心脏的live改为true同时重置心脏的跳动，类似防抖的写法。</span><br></pre></td></tr></table></figure><p>相关资料</p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuamlhbnNodS5jb20vcC8xMTQxZGNmNmRlM2U=">WebSocket 加入心跳包防止自动断开连接 - 简书 (jianshu.com)</span></p><p><span class="exturl" data-url="aHR0cDovL3d3dy5ucG1kb2Mub3JnL3dzemhvbmd3ZW53ZW5kYW5nd3MtanN6aG9uZ3dlbmppYW9jaGVuZ2ppZXhpLmh0bWwjaG93LXRvLWRldGVjdC1hbmQtY2xvc2UtYnJva2VuLWNvbm5lY3Rpb25z">ws 中文文档 | ws js 中文教程 | 解析 | npm 中文文档 (npmdoc.org)</span></p><h3 id="二-socketio的基本使用"><a class="markdownIt-Anchor" href="#二-socketio的基本使用">#</a> 二、socket.io 的基本使用</h3><p>​	socket.io 是一个第三方库，集成了 websocket, 如果客户端不支持 websocket 的话，会转为 http。同时 websocket 客户端无法访问使用 socket.io 的服务端，socket.io 的客户端也无法访问 websocket 的服务端，即如果使用 socket.io 的话，<span class="exturl" data-url="aHR0cDovL3huLS1zb2NrZXQtdnQ5aXo3c2p3ZWs5dnU3cW12bm52OGJxNXFkYTQ5NzBkdnUwYS5pbw==">服务端和客户端都要使用 socket.io</span>。其中还有 room 和断开重连，在制作直播间以及即时通讯软件的群聊的功能的时候会很方便。重新连接，内置心跳机制。注意，websocket 支持跨域，所以 websocket 并不是一个安全的连接方式，但是 socket.io 不支持跨域，所以在后端使用 socket.io 的时候要使用 cors 解决跨域问题。</p><h4 id="1引用"><a class="markdownIt-Anchor" href="#1引用">#</a> 1. 引用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">前端</span><br><span class="line"></span><br><span class="line">&lt;script src=&quot;https://cdn.socket.io/4.7.2/socket.io.min.js&quot;&gt;&lt;/script&gt; //使用cdn引用，也可以下载到本地直接引用</span><br><span class="line">&lt;script&gt;</span><br><span class="line">	主要这里的url是http或者https，如果是ws或者wss则无法连接。如果不传参数，默认请求地址与客户端同域，另外如果没有设置autoConnect为false，调用则会连接。</span><br><span class="line">    const socket = io(url,options)</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">后端</span><br><span class="line"></span><br><span class="line">npm install socket.io //安装最新版本</span><br><span class="line">npm install socket.io@version //安装指定版本</span><br><span class="line">//纯socket写法</span><br><span class="line">const &#123;Server&#125; = require(&#x27;socket.io&#x27;)</span><br><span class="line">const io = new Server(&#123;port,&#123;option&#125;&#125;) //port端口号，options配置对象</span><br><span class="line">io.on(&#x27;connection&#x27;,(socket)=&gt;&#123;</span><br><span class="line"> </span><br><span class="line">&#125;)</span><br><span class="line">//使用express框架写法</span><br><span class="line">const express = require(&quot;express&quot;);</span><br><span class="line">const &#123; createServer &#125; = require(&quot;http&quot;);</span><br><span class="line">const &#123; Server &#125; = require(&quot;socket.io&quot;);</span><br><span class="line"></span><br><span class="line">const app = express();</span><br><span class="line">const httpServer = createServer(app);</span><br><span class="line">const io = new Server(httpServer, &#123; /* options */ &#125;);</span><br><span class="line"></span><br><span class="line">io.on(&quot;connection&quot;, (socket) =&gt; &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">httpServer.listen(3000);</span><br><span class="line">//处理跨域</span><br><span class="line">const io = new Server(httpServer,&#123;</span><br><span class="line">	cors : url //允许请求的地址 </span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="2-基本使用"><a class="markdownIt-Anchor" href="#2-基本使用">#</a> 2. 基本使用</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">前端</span><br><span class="line">const socket = io(url)</span><br><span class="line">console.log(socket.id) //undefined</span><br><span class="line">socket.on(&#x27;connect&#x27;,()=&gt;&#123;</span><br><span class="line">	console.log(socket.id) //在建立连接之后socket上有一个由20个字符串组成的id值</span><br><span class="line">	socket.on(&#x27;connect&#x27;,()=&gt;&#123;</span><br><span class="line">	</span><br><span class="line">	&#125;)//连接事件</span><br><span class="line">	socket.on(&#x27;disconnect&#x27;,()=&gt;&#123;</span><br><span class="line">		socket.connect()</span><br><span class="line">	&#125;)//断连事件，如果触发了可以重新连接</span><br><span class="line">	socket.emit(eventName,args)//发送，第一个参数是事件名称，后面可以传入多个参数，参数也可以是回调函数</span><br><span class="line">	socket.emit(&#x27;1&#x27;,(res)=&gt;&#123;</span><br><span class="line">		console.log(res) //res为后端调用时传入的参数</span><br><span class="line">	&#125;)</span><br><span class="line">	socket.on(&#x27;1&#x27;,(cb)=&gt;&#123;</span><br><span class="line">		cb(&#x27;hello,world&#x27;)</span><br><span class="line">	&#125;)//这边前端传了一个函数，后端获取后可以调用</span><br><span class="line">	注意这时会在前端打印这个消息，而不是后端，本质上是前端给后端传一个函数，后端把参数传过去，前端接收到后端的参数后调用。</span><br><span class="line">	socket.on(eventName,()=&gt;&#123;&#125;)//监听，第一个参数是事件名称，后面是回调函数。</span><br><span class="line">	socket.io的接收和发送的写法与electron和vue的eventBus一致。</span><br><span class="line">	socket.once(eventName,()=&gt;&#123;&#125;)//与on不同的是这个调用一次就寄了，</span><br><span class="line">	socket.off(eventName，function) //删除某个监听事件,第二个参数可选，如果不传参就删除所有监听事件。</span><br><span class="line">	socket.listeners(eventName) //获取某一个事件的回调函数</span><br><span class="line">	socket,timeout(time).emit(eventName,()=&gt;&#123;&#125;) //给事件设置一个时间，如果超时则触发后面的回调函数，与心跳机制的超时类似。</span><br><span class="line">	socket.close() //断连</span><br><span class="line">	socket.connet() //连接</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="3广播房间"><a class="markdownIt-Anchor" href="#3广播房间">#</a> 3. 广播，房间</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">后端</span><br><span class="line">io.on(&#x27;connection&#x27;,(socket)=&gt;&#123;</span><br><span class="line">	socket.emit(eventName，args) //向本次与服务端相连的客户端发送消息</span><br><span class="line">	socket.broadcast.emit() //除了本次连接外的其他连接发送消息。</span><br><span class="line">	socket.join(room) //加入房间</span><br><span class="line">	socket.leave(room) //离开房间</span><br><span class="line">	socket.to(room).emit() //给某个房间广播</span><br><span class="line">	socket.to(room1).to(room2) //同时给多个房间发消息</span><br><span class="line">	socket.to(socket.id) //每个连接都会生成一个id值，给某个客户端发送消息。实现私人消息。</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>相关资料</p><p><span class="exturl" data-url="aHR0cHM6Ly9zb2NrZXQuaW8vemgtQ04v">Socket.IO</span></p><h3 id="多人聊天室"><a class="markdownIt-Anchor" href="#多人聊天室">#</a> 多人聊天室</h3><p>实现功能，用户可以选择一个创建或者加入一个聊天室，聊天室会展示该房间的所有用户。用户可以发送消息以及文件。因为时间紧做的比较粗糙，页面简陋且还有一些功能比如给用户加头像，用户名唯一。同时还有一些 bug 比如图片在接收的时候，拿到的 url 有点问题。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br></pre></td><td class="code"><pre><span class="line">前端</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">    &lt;script src=&quot;https://cdn.socket.io/4.7.2/socket.io.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        #user&#123;</span><br><span class="line">            position: absolute;</span><br><span class="line">            background-image: linear-gradient(to top, #fad0c4 0%, #fad0c4 1%, #ffd1ff 100%);</span><br><span class="line">            width: 600px;</span><br><span class="line">            height: 300px;</span><br><span class="line">            left: 50%;</span><br><span class="line">            top: 50%;</span><br><span class="line">            margin-left: -300px;</span><br><span class="line">            margin-top: -150px;</span><br><span class="line">        &#125;</span><br><span class="line">        #roomList&#123;</span><br><span class="line">            width: 300px;</span><br><span class="line">            margin: 40px;</span><br><span class="line">        &#125;</span><br><span class="line">        #userData&#123;</span><br><span class="line">            width: 300px;</span><br><span class="line">            margin: 0 auto;</span><br><span class="line">        &#125;</span><br><span class="line">        #join&#123;</span><br><span class="line">            display: block;</span><br><span class="line">            width: 200px;</span><br><span class="line">            background-image: linear-gradient(120deg, #a1c4fd 0%, #c2e9fb 100%);</span><br><span class="line">            height: 50px;</span><br><span class="line">            margin: 40px auto;</span><br><span class="line">        &#125;</span><br><span class="line">        input&#123;</span><br><span class="line">            margin: 4px;</span><br><span class="line">            padding: 4px;</span><br><span class="line">        &#125;</span><br><span class="line">        #ul&#123;</span><br><span class="line">            display: flex;</span><br><span class="line">        &#125;</span><br><span class="line">        ul&#123;</span><br><span class="line">            </span><br><span class="line">            list-style: none;</span><br><span class="line">        &#125;</span><br><span class="line">        li&#123;</span><br><span class="line">            list-style: none;</span><br><span class="line">            margin: 0 4px;</span><br><span class="line">        &#125;</span><br><span class="line">        #chat&#123;</span><br><span class="line">            position: relative;</span><br><span class="line">            background-color: #a1c4fd;</span><br><span class="line">            top: 100px;</span><br><span class="line">            left: 200px;</span><br><span class="line">            width: 1600px;</span><br><span class="line">            height: 800px;</span><br><span class="line">        &#125;</span><br><span class="line">        #left&#123;</span><br><span class="line">            position: absolute;</span><br><span class="line">            background-color: #c2e9fb;</span><br><span class="line">            width: 60%;</span><br><span class="line">            height: 90%;</span><br><span class="line">            left: 5%;</span><br><span class="line">            top: 5%;</span><br><span class="line">        &#125;</span><br><span class="line">        #right&#123;</span><br><span class="line">            position: absolute;</span><br><span class="line">            background-color: #ffd1ff;</span><br><span class="line">            width: 25%;</span><br><span class="line">            height: 80%;</span><br><span class="line">            left: 70%;</span><br><span class="line">            top: 10%;</span><br><span class="line">        &#125;</span><br><span class="line">        #textarea&#123;</span><br><span class="line">            position: absolute;</span><br><span class="line">            top: 95%;</span><br><span class="line">            width: 80%;</span><br><span class="line">            left: 12%;</span><br><span class="line">            resize: none;</span><br><span class="line">            overflow: hidden;</span><br><span class="line">        &#125;</span><br><span class="line">        #sendFile&#123;</span><br><span class="line">            position: absolute;</span><br><span class="line">            top: 95%;</span><br><span class="line">            width: 10%;</span><br><span class="line">            text-align: center;</span><br><span class="line">            margin: 10px;</span><br><span class="line">            background-color: #ffd1ff;</span><br><span class="line">        &#125;</span><br><span class="line">        #sendmsg&#123;</span><br><span class="line">            position: absolute;</span><br><span class="line">            top: 95%;</span><br><span class="line">            left: 90%;</span><br><span class="line">            width: 10%;</span><br><span class="line">            text-align: center;</span><br><span class="line">            margin: 10px;</span><br><span class="line">        &#125;</span><br><span class="line">        #webchat&#123;</span><br><span class="line">            position: absolute;</span><br><span class="line">            background-color: antiquewhite;</span><br><span class="line">            top: 4%;</span><br><span class="line">            width: 100%;</span><br><span class="line">            height: 90%;</span><br><span class="line">        &#125;</span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=&quot;user&quot; &gt;</span><br><span class="line">        &lt;div id=&quot;roomList&quot;&gt;</span><br><span class="line">            &lt;ul id=&quot;list&quot;&gt;房间列表:&lt;/ul&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div id=&quot;userData&quot;&gt;</span><br><span class="line">            &lt;div &gt;用户名:&lt;input id=&quot;userName&quot;/&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div &gt;房间号:&lt;input id=&quot;roomName&quot;/&gt;&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div&gt;&lt;button id=&quot;join&quot;&gt;加入&lt;/button&gt;&lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div id=&quot;chat&quot; style=&quot;display: none;&quot;&gt;</span><br><span class="line">        &lt;div id=&quot;left&quot;&gt;</span><br><span class="line">            房间号:&lt;span id=&quot;roomNumber&quot;&gt;&lt;/span&gt;</span><br><span class="line">            &lt;div id=&quot;webchat&quot;&gt;&lt;/div&gt;</span><br><span class="line">            &lt;div id=&quot;sendFile&quot;&gt;发送文件&lt;/div&gt;</span><br><span class="line">            &lt;textarea name=&quot;&quot; id=&quot;textarea&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">            &lt;div id=&quot;sendmsg&quot;&gt;发送&lt;/div&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">        &lt;div id=&quot;right&quot;&gt;</span><br><span class="line">            &lt;ul id=&quot;userList&quot;&gt;用户列表&lt;/ul&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">    let userName = document.querySelector(&#x27;#userName&#x27;)</span><br><span class="line">    let roomName = document.querySelector(&#x27;#roomName&#x27;)  </span><br><span class="line">    let join = document.querySelector(&#x27;#join&#x27;)</span><br><span class="line">    let sendmsg = document.querySelector(&#x27;#sendmsg&#x27;)</span><br><span class="line">    let webchat = document.querySelector(&#x27;#webchat&#x27;)</span><br><span class="line">    let name,room</span><br><span class="line">    /*</span><br><span class="line">        加入后，登录页面消失，聊天页面显示，同时展示房间号，该房间的用户。</span><br><span class="line">    */</span><br><span class="line">    function addmsg(value,name)&#123;</span><br><span class="line">        let div = document.createElement(&#x27;div&#x27;)</span><br><span class="line">        let user = document.createElement(&#x27;span&#x27;)</span><br><span class="line">        user.innerHTML = name+&#x27;:&#x27;+value</span><br><span class="line">        div.appendChild(user)</span><br><span class="line">        webchat.appendChild(div)</span><br><span class="line">    &#125;</span><br><span class="line">    join.addEventListener(&#x27;click&#x27;,()=&gt;&#123;</span><br><span class="line">        let user =&#123;</span><br><span class="line">            userName:userName.value,</span><br><span class="line">            roomName:roomName.value</span><br><span class="line">        &#125; //获取用户的名字以及房间号</span><br><span class="line">        name = user.userName</span><br><span class="line">        room = user.roomName</span><br><span class="line">        socket.emit(&#x27;joinRoom&#x27;,user) //告知服务器是哪个用户加入了那个房间</span><br><span class="line">        document.querySelector(&#x27;#user&#x27;).style.display = &#x27;none&#x27; //登录页面消失</span><br><span class="line">        document.querySelector(&#x27;#chat&#x27;).style.display = &#x27;block&#x27; //聊天页面显示</span><br><span class="line">        let li = document.createElement(&#x27;li&#x27;)</span><br><span class="line">        let ul = document.querySelector(&#x27;#userList&#x27;) //该房间的用户列表</span><br><span class="line">        document.querySelector(&#x27;#roomNumber&#x27;).innerHTML = roomName.value</span><br><span class="line">        li.textContent = userName.value</span><br><span class="line">        ul.appendChild(li)</span><br><span class="line">    &#125;)</span><br><span class="line">    sendmsg.addEventListener(&#x27;click&#x27;,()=&gt;&#123;</span><br><span class="line">        let textarea = document.querySelector(&#x27;#textarea&#x27;)</span><br><span class="line">        let value = textarea.value</span><br><span class="line">        textarea.value = &#x27;&#x27;</span><br><span class="line">        addmsg(value,name)</span><br><span class="line">        socket.emit(&#x27;chatmsg&#x27;,value,room,name)</span><br><span class="line">    &#125;)</span><br><span class="line">    const socket = io(&#x27;http://localhost:3000&#x27;)</span><br><span class="line">    socket.on(&#x27;connect&#x27;,()=&gt;[</span><br><span class="line">    ])</span><br><span class="line">    socket.on(&#x27;disconnect&#x27;,()=&gt;&#123;</span><br><span class="line">        socket.connect() //断连后重新连接</span><br><span class="line">    &#125;)</span><br><span class="line">    socket.on(&#x27;roomUser&#x27;,(list)=&gt;&#123;</span><br><span class="line">        let ul = document.querySelector(&#x27;#userList&#x27;)//该房间的用户列表</span><br><span class="line">        if(list&amp;&amp;list.length&gt;=2)&#123;</span><br><span class="line">            </span><br><span class="line">                console.log(list)</span><br><span class="line">                if(document.querySelector(&#x27;#userList li&#x27;))&#123;</span><br><span class="line">                    document.querySelector(&#x27;#userList li&#x27;).remove()</span><br><span class="line">                &#125;</span><br><span class="line">            //说明加入了一个有用户的房间</span><br><span class="line">            list.forEach((user)=&gt;&#123;</span><br><span class="line">                let li = document.createElement(&#x27;li&#x27;)</span><br><span class="line">                li.textContent = user</span><br><span class="line">                ul.appendChild(li)</span><br><span class="line">            &#125;)    </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">    socket.on(&#x27;chat&#x27;,(msg,name)=&gt;&#123;</span><br><span class="line">        addmsg(msg,name)</span><br><span class="line">    &#125;) //该房间的用户发送的消息</span><br><span class="line">    socket.on(&#x27;roomList&#x27;,(roomList)=&gt;&#123;</span><br><span class="line">        let roomUl = document.querySelector(&#x27;#list&#x27;) //登录页面的房间列表</span><br><span class="line">        roomList.forEach((room)=&gt;&#123;</span><br><span class="line">            let roomLi = document.createElement(&#x27;li&#x27;) </span><br><span class="line">            roomLi.textContent = room</span><br><span class="line">            roomUl.appendChild(roomLi)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    socket.on(&#x27;addNewRoom&#x27;,(room)=&gt;&#123;</span><br><span class="line">        let roomUl = document.querySelector(&#x27;#list&#x27;) //登录页面的房间列表</span><br><span class="line">        let roomLi = document.createElement(&#x27;li&#x27;) </span><br><span class="line">        roomLi.textContent = room</span><br><span class="line">        roomUl.appendChild(roomLi)</span><br><span class="line">    &#125;)//有用户创建了新的房间</span><br><span class="line">    socket.on(&#x27;roomIn&#x27;,(msg,user)=&gt;&#123;</span><br><span class="line">        //当有其他用户加入房间，便会向该房间广播这个消息</span><br><span class="line">        let userLi = document.createElement(&#x27;li&#x27;)</span><br><span class="line">        let userUl = document.querySelector(&#x27;#userList&#x27;) //聊天页面的该房间下的用户列表。</span><br><span class="line">        userLi.textContent = user</span><br><span class="line">        userUl.appendChild(userLi)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">        文件上传功能实现</span><br><span class="line">    */</span><br><span class="line"></span><br><span class="line">    let drag = document.querySelector(&#x27;#sendFile&#x27;)</span><br><span class="line">    drag.ondragover=(e)=&gt;&#123;</span><br><span class="line">        e.preventDefault() //阻止事件默认行为</span><br><span class="line">    &#125;</span><br><span class="line">    drag.ondrop=(e)=&gt;&#123;</span><br><span class="line">        e.preventDefault() </span><br><span class="line">        let file = e.dataTransfer.files[0]</span><br><span class="line">        let read = new FileReader()</span><br><span class="line">        let blob = new Blob([file],&#123;type:file.type&#125;)</span><br><span class="line">        read.readAsArrayBuffer(blob)</span><br><span class="line">        read.onload=(e)=&gt;&#123;</span><br><span class="line">            let arrayBuffer = e.target.result</span><br><span class="line">            socket.emit(&quot;upload&quot;,arrayBuffer,file.type,room)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    socket.on(&#x27;sendFile&#x27;,(file,type)=&gt;&#123;</span><br><span class="line">        let div = document.createElement(&#x27;div&#x27;)</span><br><span class="line">        let blob = new Blob([file],&#123;type&#125;)</span><br><span class="line">        let read = new FileReader()</span><br><span class="line">        div.style.height = 100+&#x27;px&#x27;</span><br><span class="line">        div.style.width = 100+&#x27;px&#x27;</span><br><span class="line">        read.readAsDataURL(blob)</span><br><span class="line">        read.onload=(e)=&gt;&#123;</span><br><span class="line">            let url = e.target.result</span><br><span class="line">            console.log(url)</span><br><span class="line">            if(type.indexOf(&#x27;image&#x27;)!=-1)&#123;</span><br><span class="line">                let image = document.createElement(&#x27;image&#x27;)</span><br><span class="line">                let span = document.createElement(&#x27;span&#x27;)</span><br><span class="line">                image.src = url</span><br><span class="line">                span.innerHTML=name+&#x27;:&#x27;+&#x27;文件&#x27;</span><br><span class="line">                div.appendChild(span)</span><br><span class="line">                div.appendChild(image)</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                let a = document.createElement(&#x27;a&#x27;)</span><br><span class="line">                let span = document.createElement(&#x27;span&#x27;)</span><br><span class="line">                span.innerHTML=name+&#x27;:&#x27;+&#x27;文件&#x27;</span><br><span class="line">                a.appendChild(span)</span><br><span class="line">                a.href = url</span><br><span class="line">                a.download = true</span><br><span class="line">                div.appendChild(a)</span><br><span class="line">            &#125;    </span><br><span class="line">            webchat.appendChild(div)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line">后端</span><br><span class="line">const express = require(&#x27;express&#x27;)</span><br><span class="line">const &#123; createServer &#125; = require(&#x27;http&#x27;)</span><br><span class="line">const &#123;Server&#125; = require(&#x27;socket.io&#x27;)</span><br><span class="line"></span><br><span class="line">const app = express()</span><br><span class="line">const httpServer = createServer(app)</span><br><span class="line">const io = new Server(httpServer,&#123;</span><br><span class="line">   cors:&#x27;127.0.0.1:5500&#x27;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">let roomSet = new Set() //储存用户创建的房间</span><br><span class="line">let roomMap = new Map() //键为房间，值为这个房间下所有用户</span><br><span class="line"></span><br><span class="line">io.on(&#x27;connection&#x27;,(socket)=&gt;&#123;</span><br><span class="line">    console.log(&#x27;连接成功&#x27;)</span><br><span class="line">    //当有用户连接时，将目前已有的房间传过去</span><br><span class="line">    socket.emit(&#x27;roomList&#x27;,[...roomSet]) </span><br><span class="line">    /*</span><br><span class="line">    当有用户加入房间成功后，会向服务器发送用户以及房间名。</span><br><span class="line">    如果是新房间则向所有用户广播新房间同时给这个房间的所有用户发送消息。</span><br><span class="line">    */</span><br><span class="line">    socket.on(&#x27;joinRoom&#x27;,(data)=&gt;&#123;</span><br><span class="line">        const &#123;userName,roomName&#125; = data</span><br><span class="line">        if(!roomSet.has(roomName))&#123;</span><br><span class="line">          io.emit(&#x27;addNewRoom&#x27;,roomName)</span><br><span class="line">        &#125;//如果是新的房间,则向所有用户广播。</span><br><span class="line">        let userList</span><br><span class="line">        if(roomMap.has(roomName))&#123;</span><br><span class="line">          userList = roomMap.get(roomName)</span><br><span class="line">          let list = roomMap.get(roomName)</span><br><span class="line">          list.push(userName)</span><br><span class="line">          roomMap.set(roomName,list)</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">          let list = [userName]</span><br><span class="line">          roomMap.set(roomName,list)</span><br><span class="line">        &#125;</span><br><span class="line">        socket.join(roomName) //让该用户加入此房间</span><br><span class="line">        roomSet.add(roomName) //记录用户创建的房间</span><br><span class="line">        socket.to(roomName).emit(&#x27;roomIn&#x27;,`$&#123;userName&#125;进入$&#123;roomName&#125;房间`,userName)</span><br><span class="line">        socket.emit(&#x27;roomUser&#x27;,userList) //用户进入房间后,向用户发送该房间的所有用户</span><br><span class="line">    &#125;)</span><br><span class="line">    socket.on(&#x27;upload&#x27;,(file,type,room)=&gt;&#123;</span><br><span class="line">      socket.to(room).emit(&#x27;sendFile&#x27;,file,type)</span><br><span class="line">    &#125;) //收到文件后向该房间的用户广播</span><br><span class="line">    socket.on(&#x27;chatmsg&#x27;,(msg,room,name)=&gt;&#123;</span><br><span class="line">        socket.to(room).emit(&#x27;chat&#x27;,msg,name)</span><br><span class="line">    &#125;) //有用户发言就给该房间的所有用户发送消息</span><br><span class="line">    socket.on(&#x27;disconnect&#x27;,()=&gt;&#123;</span><br><span class="line">		console.log(&#x27;断开连接&#x27;)</span><br><span class="line">	&#125;) //本次连接断开连接</span><br><span class="line">&#125;)</span><br><span class="line">io.on(&#x27;disconnect&#x27;,()=&gt;&#123;</span><br><span class="line">  console.log(&#x27;断开连接&#x27;)</span><br><span class="line">&#125;)</span><br><span class="line">httpServer.listen(3000)</span><br></pre></td></tr></table></figure><div class="tags"><a href="/tags/webrtc/" rel="tag"><i class="ic i-tag"></i>webrtc</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i></span><span class="text">更新于</span><time title="修改时间：2024-01-20 16:46:59" itemprop="dateModified" datetime="2024-01-20T16:46:59+08:00">2024-01-20</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i>赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/assets/wechatpay.png" alt="SEELE-EXZzz(纯希) 微信支付"><p>微信支付</p></div><div><img data-src="/assets/alipay.png" alt="SEELE-EXZzz(纯希) 支付宝"><p>支付宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者：</strong>SEELE-EXZzz(纯希)<i class="ic i-at"><em>@</em></i>个人博客</li><li class="link"><strong>本文链接：</strong><a href="https://seele-exzzz.github.io/2023/11/14/Video-Audio/websocket%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" title="websocket的基本使用">https://seele-exzzz.github.io/2023/11/14/Video-Audio/websocket的基本使用/</a></li><li class="license"><strong>版权声明：</strong>本站所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" rel="noopener" target="_blank"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</a> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2023/11/13/Video-Audio/canvas%E5%AF%B9%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/" rel="prev" itemprop="url" data-background-image="https:&#x2F;&#x2F;typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com&#x2F;img&#x2F;coverv2-9ace9b7fc6f8042005a013f0e9194f1c_720w.webp" title="canvas对视频处理"><span class="type">上一篇</span><span class="category"><i class="ic i-flag"></i>音视频开发</span><h3>canvas对视频处理</h3></a></div><div class="item right"><a href="/2023/11/22/Video-Audio/%E5%B9%BB%E5%BD%B1%E5%9D%A6%E5%85%8B%E5%88%B6%E5%A4%87/" rel="next" itemprop="url" data-background-image="https:&#x2F;&#x2F;typora-seele-exzzz.oss-cn-guangzhou.aliyuncs.com&#x2F;img&#x2F;coverv2-85ed8bed82356bc42302df4685eb4667_720w.webp" title="幻影坦克制备"><span class="type">下一篇</span><span class="category"><i class="ic i-flag"></i>音视频开发</span><h3>幻影坦克制备</h3></a></div></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#websocket%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">websocket 的基本使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">2.</span> <span class="toc-text">一、基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-%E5%BC%95%E7%94%A8"><span class="toc-number">2.1.</span> <span class="toc-text">1. 引用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E8%BF%9E%E6%8E%A5%E6%96%AD%E8%BF%9E%E5%8F%91%E9%80%81%E6%8E%A5%E6%94%B6"><span class="toc-number">2.2.</span> <span class="toc-text">2. 连接，断连，发送，接收</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E5%BF%83%E8%B7%B3%E6%9C%BA%E5%88%B6"><span class="toc-number">2.3.</span> <span class="toc-text">3. 心跳机制</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%8C-socketio%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">二、socket.io 的基本使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%E5%BC%95%E7%94%A8"><span class="toc-number">3.1.</span> <span class="toc-text">1. 引用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-number">3.2.</span> <span class="toc-text">2. 基本使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%E5%B9%BF%E6%92%AD%E6%88%BF%E9%97%B4"><span class="toc-number">3.3.</span> <span class="toc-text">3. 广播，房间</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%BA%BA%E8%81%8A%E5%A4%A9%E5%AE%A4"><span class="toc-number">4.</span> <span class="toc-text">多人聊天室</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2023/11/07/Video-Audio/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%9F%BA%E7%A1%80/" rel="bookmark" title="二进制基础">二进制基础</a></li><li><a href="/2023/11/09/Video-Audio/webrtc%E5%9F%BA%E7%A1%80/" rel="bookmark" title="webrtc基础">webrtc基础</a></li><li><a href="/2023/11/11/Video-Audio/canvas%E5%AF%B9%E5%9B%BE%E7%89%87%E5%A4%84%E7%90%86/" rel="bookmark" title="canvas对图片处理">canvas对图片处理</a></li><li><a href="/2023/11/13/Video-Audio/canvas%E5%AF%B9%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/" rel="bookmark" title="canvas对视频处理">canvas对视频处理</a></li><li class="active"><a href="/2023/11/14/Video-Audio/websocket%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" rel="bookmark" title="websocket的基本使用">websocket的基本使用</a></li><li><a href="/2023/11/22/Video-Audio/%E5%B9%BB%E5%BD%B1%E5%9D%A6%E5%85%8B%E5%88%B6%E5%A4%87/" rel="bookmark" title="幻影坦克制备">幻影坦克制备</a></li><li><a href="/2023/11/27/Video-Audio/%E7%AB%AF%E5%AF%B9%E7%AB%AF%E8%BF%9E%E6%8E%A5%E5%88%9D%E4%BD%93%E9%AA%8C/" rel="bookmark" title="端对端连接初体验">端对端连接初体验</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="SEELE-EXZzz(纯希)" data-src="/assets/avatar.jpg"><p class="name" itemprop="name">SEELE-EXZzz(纯希)</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">29</span><span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">5</span><span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">18</span><span class="name">标签</span></a></div></nav><div class="social"><a href="https://github.com/SEELE-EXZzz" class="item github" rel="noopener" title="https:&#x2F;&#x2F;github.com&#x2F;SEELE-EXZzz" target="_blank"><i class="ic i-github"></i></a></div><div class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-user"></i>关于</a><ul class="submenu"><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于本站</a></li><li class="item"><a href="/admiration/" rel="section"><i class="ic i-coffee"></i>赞赏博主</a></li></ul></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>友链</a></li><li class="item dropdown"><a href="/page/" rel="section"><i class="ic i-user"></i>submenu</a><ul class="submenu"><li class="item"><a href="/page1/" rel="section"><i class="ic i-cloud"></i>link</a></li></ul></li><li class="item"><a href="/page2/" rel="section"><i class="ic i-coffee"></i>link2</a></li></div></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2023/11/22/Video-Audio/%E5%B9%BB%E5%BD%B1%E5%9D%A6%E5%85%8B%E5%88%B6%E5%A4%87/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2023/11/13/Video-Audio/canvas%E5%AF%B9%E8%A7%86%E9%A2%91%E5%A4%84%E7%90%86/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Learning-record/" title="分类于学习记录">学习记录</a></div><span><a href="/2023/07/12/Learning-record/%E6%AD%A3%E5%88%99%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/">正则学习记录</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Video-Audio/" title="分类于音视频开发">音视频开发</a></div><span><a href="/2023/11/07/Video-Audio/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%9F%BA%E7%A1%80/">二进制基础</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/3d-modeling/" title="分类于计算机图形学">计算机图形学</a></div><span><a href="/2024/01/28/3d-modeling/%E5%85%89%E7%85%A7%E9%98%B4%E5%BD%B1/">光照阴影</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Video-Audio/" title="分类于音视频开发">音视频开发</a></div><span><a href="/2023/11/09/Video-Audio/webrtc%E5%9F%BA%E7%A1%80/">webrtc基础</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/3d-modeling/" title="分类于计算机图形学">计算机图形学</a></div><span><a href="/2024/01/15/3d-modeling/webgl%E7%BB%98%E5%88%B6%E5%9F%BA%E6%9C%AC%E5%9B%BE%E5%BD%A2/">webgl绘制基本图形</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/project/" title="分类于项目">项目</a></div><span><a href="/2023/08/03/project/electron-%E4%BB%8E%E9%9B%B6%E6%90%AD%E5%BB%BA%E4%B8%80%E4%B8%AAelectron%E9%A1%B9%E7%9B%AE/">electron配置</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/3d-modeling/" title="分类于计算机图形学">计算机图形学</a></div><span><a href="/2024/01/21/3d-modeling/%E7%9B%B8%E6%9C%BA%EF%BC%8C%E6%8A%95%E5%BD%B1/">相机，投影</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Video-Audio/" title="分类于音视频开发">音视频开发</a></div><span><a href="/2023/11/22/Video-Audio/%E5%B9%BB%E5%BD%B1%E5%9D%A6%E5%85%8B%E5%88%B6%E5%A4%87/">幻影坦克制备</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/3d-modeling/" title="分类于计算机图形学">计算机图形学</a></div><span><a href="/2024/01/18/3d-modeling/%E5%9B%BE%E5%BD%A2%E6%97%8B%E8%BD%AC/">图形运动</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/algorithm/" title="分类于算法">算法</a></div><span><a href="/2023/10/04/algorithm/%E5%A0%86%20%E4%BC%98%E5%85%88%E9%98%9F%E5%88%97/">堆 优先队列</a></span></li></ul></div><div class="rpost pjax"><h2>最新评论</h2><ul class="leancloud-recent-comment" id="new-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2022 -<span itemprop="copyrightYear">2024</span><span class="with-love"><i class="ic i-sakura rotate"></i></span><span class="author" itemprop="copyrightHolder">SEELE-EXZzz(纯希) @ testName</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i></span><span title="站点总字数">148k 字</span><span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="ic i-coffee"></i></span><span title="站点阅读时长">2:14</span></div><div class="powered-by">基于 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & Theme.<a href="https://github.com/theme-shoka-x/hexo-theme-shokaX/" rel="noopener" target="_blank">ShokaX</a></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2023/11/14/Video-Audio/websocket的基本使用/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,chart:!1,copy_tex:!1,katex:!1,mermaid:!1,audio:"",fancybox:!0,nocopy:!1,outime:!0,template:"&lt;div class=&quot;note warning&quot;&gt;&lt;p&gt;&lt;span class=&quot;label warning&quot;&gt;文章时效性提示&lt;/span&gt;&lt;br&gt;这是一篇发布于 {{publish}} 天前，最后一次更新在 {{updated}} 天前的文章，部分信息可能已经发生改变，请注意甄别。&lt;/p&gt;&lt;/div&gt;",quiz:{choice:"单选题",multiple:"多选题",true_false:"判断题",essay:"问答题",gap_fill:"填空题",mistake:"错题备注"},ignores:[t=>t.includes("#"),t=>new RegExp(LOCAL.path+"$").test(t),[]]}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=default,fetch"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/pace/1.0.2/pace.min.js"></script><script src="https://unpkg.com/theme-shokax-pjax@latest/pjax.shokax.min.js"></script><script src="https://unpkg.com/theme-shokax-anime@latest/anime.shokax.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/algoliasearch/4.12.1/algoliasearch-lite.umd.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/instantsearch.js/4.39.0/instantsearch.production.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/lozad.js/1.16.0/lozad.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/quicklink/2.2.0/quicklink.umd.min.js"></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/??jquery/3.5.1/jquery.min.js,fancybox/3.5.7/jquery.fancybox.min.js,justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js" async></script><script src="https://lf9-cdn-tos.bytecdntp.com/cdn/expire-6-M/KaTeX/0.12.0/contrib/copy-tex.min.js" async></script><script src="https://unpkg.com/frappe-charts@1.5.0/dist/frappe-charts.min.iife.js"></script><script src="/js/app.js?v=0.2.10"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/assets/koharu.model.json"},"display":{"position":"right","width":300,"height":600},"mobile":{"show":false},"log":false});</script></body></html><!-- rebuild by hexo-renderer-multi-next-markdown-it -->